var _jsxFileName="/home/anton/Projects/epub-js-rn_my/src/Rendition.js";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require("react");var _react2=_interopRequireDefault(_react);

var _reactNative=require("react-native");











var _reactNativeWkwebviewRebornFchasen=require("react-native-wkwebview-reborn-fchasen");var _reactNativeWkwebviewRebornFchasen2=_interopRequireDefault(_reactNativeWkwebviewRebornFchasen);

var _eventEmitter=require("event-emitter");var _eventEmitter2=_interopRequireDefault(_eventEmitter);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}



var URL=require("epubjs/libs/url/url-polyfill.js");

var EPUBJS="(function(p,v){'object'==typeof exports&&'object'==typeof module?module.exports=v(require('xmldom'),function(){try{return require('JSZip')}catch(_){}}()):'function'==typeof define&&define.amd?define(['xmldom','JSZip'],v):'object'==typeof exports?exports.ePub=v(require('xmldom'),function(){try{return require('JSZip')}catch(_){}}()):p.ePub=v(p.xmldom,p.JSZip)})(this,function(s,p){return function(v){function k(C){if(_[C])return _[C].exports;var S=_[C]={i:C,l:!1,exports:{}};return v[C].call(S.exports,S,S.exports,k),S.l=!0,S.exports}var _={};return k.m=v,k.c=_,k.i=function(C){return C},k.d=function(C,S,E){k.o(C,S)||Object.defineProperty(C,S,{configurable:!1,enumerable:!0,get:E})},k.n=function(C){var S=C&&C.__esModule?function(){return C['default']}:function(){return C};return k.d(S,'a',S),S},k.o=function(C,S){return Object.prototype.hasOwnProperty.call(C,S)},k.p='/dist/',k(k.s=30)}([function(v,k,_){'use strict';function C(ge,me){if(!(ge instanceof me))throw new TypeError('Cannot call a class as a function')}function E(){var ge=new Date().getTime(),me='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(ye){var ve=0|(ge+16*Math.random())%16;return ge=Math.floor(ge/16),('x'==ye?ve:8|7&ve).toString(16)});return me}function P(ge){return!isNaN(parseFloat(ge))&&isFinite(ge)}function B(ge,me,ye,ve,be){var ke=ve||0,xe=be||me.length,_e=parseInt(ke+(xe-ke)/2),we;return(ye||(ye=function(Se,Ee){return Se>Ee?1:Se<Ee?-1:Se==Ee?0:void 0}),0>=xe-ke)?_e:(we=ye(me[_e],ge),1==xe-ke?0<=we?_e:_e+1:0===we?_e:-1===we?B(ge,me,ye,_e,xe):B(ge,me,ye,ke,_e))}function A(ge,me,ye,ve,be){var ke=ve||0,xe=be||me.length,_e=parseInt(ke+(xe-ke)/2),we;return(ye||(ye=function(Se,Ee){return Se>Ee?1:Se<Ee?-1:Se==Ee?0:void 0}),0>=xe-ke)?-1:(we=ye(me[_e],ge),1==xe-ke?0===we?_e:-1:0===we?_e:-1===we?A(ge,me,ye,_e,xe):A(ge,me,ye,ke,_e))}function F(ge,me){for(var ye=ge.parentNode,ve=ye.childNodes,ke=-1,xe=0,be;xe<ve.length&&(be=ve[xe],be.nodeType===me&&ke++,be!=ge);xe++);return ke}function X(ge,me){return new Blob([ge],{type:me})}function G(ge,me){return'undefined'==typeof ge.querySelector?ge.getElementsByTagName(me):ge.querySelectorAll(me)}function te(ge,me,ye){for(var ve=document.createTreeWalker(ge,ye,null,!1),be;be=ve.nextNode();)me(be)}function ne(ge,me){if(me(ge))return!0;if(ge=ge.firstChild,ge)do{var ye=ne(ge,me);if(ye)return!0;ge=ge.nextSibling}while(ge)}function oe(ge){for(var me=[ge];ge;ge=ge.parentNode)me.unshift(ge);return me}Object.defineProperty(k,'__esModule',{value:!0});var le=function(){function ge(me,ye){for(var ve=0,be;ve<ye.length;ve++)be=ye[ve],be.enumerable=be.enumerable||!1,be.configurable=!0,'value'in be&&(be.writable=!0),Object.defineProperty(me,be.key,be)}return function(me,ye,ve){return ye&&ge(me.prototype,ye),ve&&ge(me,ve),me}}();k.isElement=function(ge){return!!(ge&&1==ge.nodeType)},k.uuid=E,k.documentHeight=function(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},k.isNumber=P,k.isFloat=function(ge){return P(ge)&&Math.floor(ge)!==ge},k.prefixed=function(ge){var me=['Webkit','webkit','Moz','O','ms'],ye=['-webkit-','-webkit-','-moz-','-o-','-ms-'],ve=ge[0].toUpperCase()+ge.slice(1),be=me.length;if('undefined'==typeof document||'undefined'!=typeof document.body.style[ge])return ge;for(var ke=0;ke<be;ke++)if('undefined'!=typeof document.body.style[me[ke]+ve])return ye[ke]+ge;return ge},k.defaults=function(ge){for(var me=1,ye=arguments.length,ve;me<ye;me++)for(var be in ve=arguments[me],ve)void 0===ge[be]&&(ge[be]=ve[be]);return ge},k.extend=function(ge){var me=[].slice.call(arguments,1);return me.forEach(function(ye){ye&&Object.getOwnPropertyNames(ye).forEach(function(ve){Object.defineProperty(ge,ve,Object.getOwnPropertyDescriptor(ye,ve))})}),ge},k.insert=function(ge,me,ye){var ve=B(ge,me,ye);return me.splice(ve,0,ge),ve},k.locationOf=B,k.indexOfSorted=A,k.bounds=function(ge){var me=window.getComputedStyle(ge),be=0,ke=0;return['width','paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(xe){be+=parseFloat(me[xe])||0}),['height','paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(xe){ke+=parseFloat(me[xe])||0}),{height:ke,width:be}},k.borders=function(ge){var me=window.getComputedStyle(ge),be=0,ke=0;return['paddingRight','paddingLeft','marginRight','marginLeft','borderRightWidth','borderLeftWidth'].forEach(function(xe){be+=parseFloat(me[xe])||0}),['paddingTop','paddingBottom','marginTop','marginBottom','borderTopWidth','borderBottomWidth'].forEach(function(xe){ke+=parseFloat(me[xe])||0}),{height:ke,width:be}},k.windowBounds=function(){var ge=window.innerWidth,me=window.innerHeight;return{top:0,left:0,right:ge,bottom:me,width:ge,height:me}},k.cleanStringForXpath=function(ge){var me=ge.match(/[^'\"]+|['\"]/g);return me=me.map(function(ye){return'\\''===ye?'\"\\'\"':'\"'===ye?'\\'\"\\'':'\\''+ye+'\\''}),'concat(\\'\\','+me.join(',')+')'},k.indexOfNode=F,k.indexOfTextNode=function(ge){return F(ge,ce)},k.indexOfElementNode=function(ge){return F(ge,ue)},k.isXml=function(ge){return-1<['xml','opf','ncx'].indexOf(ge)},k.createBlob=X,k.createBlobUrl=function(ge,me){var ye=window.URL||window.webkitURL||window.mozURL,be=X(ge,me),ve;return ve=ye.createObjectURL(be),ve},k.createBase64Url=function(ge,me){var ye,ve;if('string'==typeof ge)return ye=btoa(ge),ve='data:'+me+';base64,'+ye,ve},k.type=function(ge){return Object.prototype.toString.call(ge).slice(8,-1)},k.parse=function(ge,me,ye){var ve,be;return be='undefined'==typeof DOMParser||ye?_(19).DOMParser:DOMParser,65279===ge.charCodeAt(0)&&(ge=ge.slice(1)),ve=new be().parseFromString(ge,me),ve},k.qs=function(ge,me){var ye;if(!ge)throw new Error('No Element Provided');return'undefined'==typeof ge.querySelector?(ye=ge.getElementsByTagName(me),ye.length)?ye[0]:void 0:ge.querySelector(me)},k.qsa=G,k.qsp=function(ge,me,ye){var ve,be;if('undefined'!=typeof ge.querySelector){for(var ke in me+='[',ye)me+=ke+'=\\''+ye[ke]+'\\'';return me+=']',ge.querySelector(me)}return(ve=ge.getElementsByTagName(me),be=Array.prototype.slice.call(ve,0).filter(function(xe){for(var _e in ye)if(xe.getAttribute(_e)===ye[_e])return!0;return!1}),be)?be[0]:void 0},k.sprint=function(ge,me){var ye=ge.ownerDocument||ge;'undefined'==typeof ye.createTreeWalker?ne(ge,function(ve){ve&&3===ve.nodeType&&me(ve)},!0):te(ge,me,NodeFilter.SHOW_TEXT)},k.treeWalker=te,k.walk=ne,k.blob2base64=function(ge){return new Promise(function(me){var ve=new FileReader;ve.readAsDataURL(ge),ve.onloadend=function(){me(ve.result)}})},k.defer=function(){var ge=this;this.resolve=null,this.reject=null,this.id=E(),this.promise=new Promise(function(me,ye){ge.resolve=me,ge.reject=ye}),Object.freeze(this)},k.querySelectorByType=function(ge,me,ye){var ve;if('undefined'!=typeof ge.querySelector&&(ve=ge.querySelector(me+'[*|type=\"'+ye+'\"]')),!ve||0===ve.length){ve=G(ge,me);for(var be=0;be<ve.length;be++)if(ve[be].getAttributeNS('http://www.idpf.org/2007/ops','type')===ye||ve[be].getAttribute('epub:type')===ye)return ve[be]}else return ve},k.findChildren=function(ge){for(var me=[],ye=ge.childNodes,ve=0,be;ve<ye.length;ve++)be=ye[ve],1===be.nodeType&&me.push(be);return me},k.parents=oe;var de=k.requestAnimationFrame='undefined'!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),ue=1,ce=3,fe=k.RangeObject=function(){function ge(){C(this,ge),this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}return le(ge,[{key:'setStart',value:function(ye,ve){this.startContainer=ye,this.startOffset=ve,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}},{key:'setEnd',value:function(ye,ve){this.endContainer=ye,this.endOffset=ve,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}},{key:'collapse',value:function(ye){this.collapsed=!0,ye?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}},{key:'selectNode',value:function(ye){var ve=ye.parentNode,be=Array.prototype.indexOf.call(ve.childNodes,ye);this.setStart(ve,be),this.setEnd(ve,be+1)}},{key:'selectNodeContents',value:function(ye){var ve=ye.childNodes[ye.childNodes-1],be=3===ye.nodeType?ye.textContent.length:parent.childNodes.length;this.setStart(ye,0),this.setEnd(ye,be)}},{key:'_commonAncestorContainer',value:function(ye,ve){var be=oe(ye||this.startContainer),ke=oe(ve||this.endContainer);if(be[0]==ke[0])for(var xe=0;xe<be.length;xe++)if(be[xe]!=ke[xe])return be[xe-1]}},{key:'_checkCollapsed',value:function(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}},{key:'toString',value:function(){}}]),ge}()},function(v,k,_){'use strict';function C(N,O){if(!(N instanceof O))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(N){return typeof N}:function(N){return N&&'function'==typeof Symbol&&N.constructor===Symbol&&N!==Symbol.prototype?'symbol':typeof N},E=function(){function N(O,B){for(var A=0,I;A<B.length;A++)I=B[A],I.enumerable=I.enumerable||!1,I.configurable=!0,'value'in I&&(I.writable=!0),Object.defineProperty(O,I.key,I)}return function(O,B,A){return B&&N(O.prototype,B),A&&N(O,A),O}}(),L=_(0),P=1,R=3,z=function(){function N(O,B,A){C(this,N);var I;if(this.str='',this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof N))return new N(O,B,A);if('string'==typeof B?this.base=this.parseComponent(B):'object'===('undefined'==typeof B?'undefined':S(B))&&B.steps&&(this.base=B),I=this.checkType(O),'string'===I)return this.str=O,(0,L.extend)(this,this.parse(O));if('range'===I)return(0,L.extend)(this,this.fromRange(O,this.base,A));if('node'===I)return(0,L.extend)(this,this.fromNode(O,this.base,A));if('EpubCFI'===I&&O.path)return O;if(!O)return this;throw new TypeError('not a valid argument for EpubCFI')}return E(N,[{key:'checkType',value:function(B){return this.isCfiString(B)?'string':'object'===('undefined'==typeof B?'undefined':S(B))&&('Range'===(0,L.type)(B)||'undefined'!=typeof B.startContainer)?'range':'object'===('undefined'==typeof B?'undefined':S(B))&&'undefined'!=typeof B.nodeType?'node':'object'===('undefined'==typeof B?'undefined':S(B))&&B instanceof N&&'EpubCFI'}},{key:'parse',value:function(B){var A={spinePos:-1,range:!1,base:{},path:{},start:null,end:null},I,M,W;return'string'==typeof B?(0===B.indexOf('epubcfi(')&&')'===B[B.length-1]&&(B=B.slice(8,B.length-1)),I=this.getChapterComponent(B),!I)?{spinePos:-1}:(A.base=this.parseComponent(I),M=this.getPathComponent(B),A.path=this.parseComponent(M),W=this.getRange(B),W&&(A.range=!0,A.start=this.parseComponent(W[0]),A.end=this.parseComponent(W[1])),A.spinePos=A.base.steps[1].index,A):{spinePos:-1}}},{key:'parseComponent',value:function(B){var A={steps:[],terminal:{offset:null,assertion:null}},I=B.split(':'),M=I[0].split('/'),W;return 1<I.length&&(W=I[1],A.terminal=this.parseTerminal(W)),''===M[0]&&M.shift(),A.steps=M.map(function(U){return this.parseStep(U)}.bind(this)),A}},{key:'parseStep',value:function(B){var A,I,M,W,U;if(W=B.match(/\\[(.*)\\]/),W&&W[1]&&(U=W[1]),I=parseInt(B),!isNaN(I))return 0==I%2?(A='element',M=I/2-1):(A='text',M=(I-1)/2),{type:A,index:M,id:U||null}}},{key:'parseTerminal',value:function(B){var M=B.match(/\\[(.*)\\]/),A,I;return M&&M[1]?(A=parseInt(B.split('[')[0]),I=M[1]):A=parseInt(B),(0,L.isNumber)(A)||(A=null),{offset:A,assertion:I}}},{key:'getChapterComponent',value:function(B){var A=B.split('!');return A[0]}},{key:'getPathComponent',value:function(B){var A=B.split('!');if(A[1]){var I=A[1].split(',');return I[0]}}},{key:'getRange',value:function(B){var A=B.split(',');return 3===A.length&&[A[1],A[2]]}},{key:'getCharecterOffsetComponent',value:function(B){var A=B.split(':');return A[1]||''}},{key:'joinSteps',value:function(B){return B?B.map(function(A){var I='';return'element'===A.type&&(I+=2*(A.index+1)),'text'===A.type&&(I+=1+2*A.index),A.id&&(I+='['+A.id+']'),I}).join('/'):''}},{key:'segmentString',value:function(B){var O='/';return O+=this.joinSteps(B.steps),B.terminal&&null!=B.terminal.offset&&(O+=':'+B.terminal.offset),B.terminal&&null!=B.terminal.assertion&&(O+='['+B.terminal.assertion+']'),O}},{key:'toString',value:function(){var B='epubcfi(';return B+=this.segmentString(this.base),B+='!',B+=this.segmentString(this.path),this.range&&this.start&&(B+=',',B+=this.segmentString(this.start)),this.range&&this.end&&(B+=',',B+=this.segmentString(this.end)),B+=')',B}},{key:'compare',value:function(B,A){var I,M,W,U,H,H;if('string'==typeof B&&(B=new N(B)),'string'==typeof A&&(A=new N(A)),B.spinePos>A.spinePos)return 1;if(B.spinePos<A.spinePos)return-1;B.range?(I=B.path.steps.concat(B.start.steps),W=B.start.terminal):(I=B.path.steps,W=B.path.terminal),A.range?(M=A.path.steps.concat(A.start.steps),U=A.start.terminal):(M=A.path.steps,U=A.path.terminal);for(var Z=0;Z<I.length;Z++){if(!I[Z])return-1;if(!M[Z])return 1;if(I[Z].index>M[Z].index)return 1;if(I[Z].index<M[Z].index)return-1}return I.length<M.length?1:W.offset>U.offset?1:W.offset<U.offset?-1:0}},{key:'step',value:function(B){var A=B.nodeType===R?'text':'element';return{id:B.id,tagName:B.tagName,type:A,index:this.position(B)}}},{key:'filteredStep',value:function(B,A){var I=this.filter(B,A),M;if(I)return M=I.nodeType===R?'text':'element',{id:I.id,tagName:I.tagName,type:M,index:this.filteredPosition(I,A)}}},{key:'pathTo',value:function(B,A,I){for(var M={steps:[],terminal:{offset:null,assertion:null}},W=B,U;W&&W.parentNode&&W.parentNode.nodeType!=9;)U=I?this.filteredStep(W,I):this.step(W),U&&M.steps.unshift(U),W=W.parentNode;return null!=A&&0<=A&&(M.terminal.offset=A,'text'!=M.steps[M.steps.length-1].type&&M.steps.push({type:'text',index:0})),M}},{key:'equalStep',value:function(B,A){return B&&A&&B.index===A.index&&B.id===A.id&&B.type===A.type}},{key:'fromRange',value:function(B,A,I){var M={range:!1,base:{},path:{},start:null,end:null},W=B.startContainer,U=B.endContainer,F=B.startOffset,D=B.endOffset,H=!1;if(I&&(H=null!=W.ownerDocument.querySelector('.'+I)),'string'==typeof A?(M.base=this.parseComponent(A),M.spinePos=M.base.steps[1].index):'object'===('undefined'==typeof A?'undefined':S(A))&&(M.base=A),B.collapsed)H&&(F=this.patchOffset(W,F,I)),M.path=this.pathTo(W,F,I);else{M.range=!0,H&&(F=this.patchOffset(W,F,I)),M.start=this.pathTo(W,F,I),H&&(D=this.patchOffset(U,D,I)),M.end=this.pathTo(U,D,I),M.path={steps:[],terminal:null};var V=M.start.steps.length,X;for(X=0;X<V&&this.equalStep(M.start.steps[X],M.end.steps[X]);X++)X===V-1?M.start.terminal===M.end.terminal&&(M.path.steps.push(M.start.steps[X]),M.range=!1):M.path.steps.push(M.start.steps[X]);M.start.steps=M.start.steps.slice(M.path.steps.length),M.end.steps=M.end.steps.slice(M.path.steps.length)}return M}},{key:'fromNode',value:function(B,A,I){var M={range:!1,base:{},path:{},start:null,end:null};return'string'==typeof A?(M.base=this.parseComponent(A),M.spinePos=M.base.steps[1].index):'object'===('undefined'==typeof A?'undefined':S(A))&&(M.base=A),M.path=this.pathTo(B,null,I),M}},{key:'filter',value:function(B,A){var D=!1,I,M,W,U,F;return B.nodeType===R?(D=!0,W=B.parentNode,I=B.parentNode.classList.contains(A)):(D=!1,I=B.classList.contains(A)),I&&D?(U=W.previousSibling,F=W.nextSibling,U&&U.nodeType===R?M=U:F&&F.nodeType===R&&(M=F),M?M:B):I&&!D?!1:B}},{key:'patchOffset',value:function(B,A,I){if(B.nodeType!=R)throw new Error('Anchor must be a text node');var M=B,W=A;for(B.parentNode.classList.contains(I)&&(M=B.parentNode);M.previousSibling;){if(M.previousSibling.nodeType!==P)W+=M.previousSibling.textContent.length;else if(M.previousSibling.classList.contains(I))W+=M.previousSibling.textContent.length;else break;M=M.previousSibling}return W}},{key:'normalizedMap',value:function(B,A,I){var M={},W=-1,F=B.length,U,D,H;for(U=0;U<F;U++)D=B[U].nodeType,D===P&&B[U].classList.contains(I)&&(D=R),0<U&&D===R&&H===R?M[U]=W:A===D&&(++W,M[U]=W),H=D;return M}},{key:'position',value:function(B){var A,I;return B.nodeType===P?(A=B.parentNode.children,!A&&(A=(0,L.findChildren)(B.parentNode)),I=Array.prototype.indexOf.call(A,B)):(A=this.textNodes(B.parentNode),I=A.indexOf(B)),I}},{key:'filteredPosition',value:function(B,A){var I,M,W;return B.nodeType===P?(I=B.parentNode.children,W=this.normalizedMap(I,P,A)):(I=B.parentNode.childNodes,B.parentNode.classList.contains(A)&&(B=B.parentNode,I=B.parentNode.childNodes),W=this.normalizedMap(I,R,A)),M=Array.prototype.indexOf.call(I,B),W[M]}},{key:'stepsToXpath',value:function(B){var A=['.','*'];return B.forEach(function(I){var M=I.index+1;I.id?A.push('*[position()='+M+' and @id=\\''+I.id+'\\']'):'text'===I.type?A.push('text()['+M+']'):A.push('*['+M+']')}),A.join('/')}},{key:'stepsToQuerySelector',value:function(B){var A=['html'];return B.forEach(function(I){var M=I.index+1;I.id?A.push('#'+I.id):'text'===I.type||A.push('*:nth-child('+M+')')}),A.join('>')}},{key:'textNodes',value:function(B,A){return Array.prototype.slice.call(B.childNodes).filter(function(I){return I.nodeType===R||A&&I.classList.contains(A)})}},{key:'walkToNode',value:function(B,A,I){var M=A||document,W=M.documentElement,D=B.length,U,F,H;for(H=0;H<D&&(F=B[H],'element'===F.type?F.id?W=M.getElementById(F.id):(U=W.children||(0,L.findChildren)(W),W=U[F.index]):'text'===F.type&&(W=this.textNodes(W,I)[F.index]),!!W);H++);return W}},{key:'findNode',value:function(B,A,I){var M=A||document,W,U;return I||'undefined'==typeof M.evaluate?I?W=this.walkToNode(B,M,I):W=this.walkToNode(B,M):(U=this.stepsToXpath(B),W=M.evaluate(U,M,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),W}},{key:'fixMiss',value:function(B,A,I,M){var W=this.findNode(B.slice(0,-1),I,M),U=W.childNodes,F=this.normalizedMap(U,R,M),V=B[B.length-1].index,D,H;for(var X in F){if(!F.hasOwnProperty(X))return;if(F[X]===V)if(D=U[X],H=D.textContent.length,A>H)A-=H;else{W=D.nodeType===P?D.childNodes[0]:D;break}}return{container:W,offset:A}}},{key:'toRange',value:function(B,A){var I=B||document,H=this,Y=!!A&&null!=I.querySelector('.'+A),M,W,U,F,D,V,X,J;if(M='undefined'==typeof I.createRange?new L.RangeObject:I.createRange(),H.range?(W=H.start,V=H.path.steps.concat(W.steps),F=this.findNode(V,I,Y?A:null),U=H.end,X=H.path.steps.concat(U.steps),D=this.findNode(X,I,Y?A:null)):(W=H.path,V=H.path.steps,F=this.findNode(H.path.steps,I,Y?A:null)),F)try{null==W.terminal.offset?M.setStart(F,0):M.setStart(F,W.terminal.offset)}catch(Z){J=this.fixMiss(V,W.terminal.offset,I,Y?A:null),M.setStart(J.container,J.offset)}else return console.log('NO START'),null;if(D)try{null==U.terminal.offset?M.setEnd(D,0):M.setEnd(D,U.terminal.offset)}catch(Z){J=this.fixMiss(X,H.end.terminal.offset,I,Y?A:null),M.setEnd(J.container,J.offset)}return M}},{key:'isCfiString',value:function(B){return'string'==typeof B&&0===B.indexOf('epubcfi(')&&')'===B[B.length-1]}},{key:'generateChapterComponent',value:function(B,A,I){var M=parseInt(A),U='/'+2*(B+1)+'/';return U+=2*(M+1),I&&(U+='['+I+']'),U}},{key:'collapse',value:function(B){this.range&&(this.range=!1,B?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}]),N}();k.default=z,v.exports=k['default']},function(v,k,_){'use strict';var C=_(42),S=_(51),E=Function.prototype.apply,L=Function.prototype.call,P=Object.create,R=Object.defineProperty,T=Object.defineProperties,z=Object.prototype.hasOwnProperty,N={configurable:!0,enumerable:!1,writable:!0},O,B,A,I,M,W,U;O=function(F,D){var H;return S(D),z.call(this,'__ee__')?H=this.__ee__:(H=N.value=P(null),R(this,'__ee__',N),N.value=null),H[F]?'object'==typeof H[F]?H[F].push(D):H[F]=[H[F],D]:H[F]=D,this},B=function(F,D){var H,V;return S(D),V=this,O.call(this,F,H=function(){A.call(V,F,H),E.call(D,this,arguments)}),H.__eeOnceListener__=D,this},A=function(F,D){var H,V,X,Y;if(S(D),!z.call(this,'__ee__'))return this;if(H=this.__ee__,!H[F])return this;if(V=H[F],'object'==typeof V)for(Y=0;X=V[Y];++Y)(X===D||X.__eeOnceListener__===D)&&(2===V.length?H[F]=V[Y?0:1]:V.splice(Y,1));else(V===D||V.__eeOnceListener__===D)&&delete H[F];return this},I=function(F){var D,H,V,X,Y;if(z.call(this,'__ee__')&&(X=this.__ee__[F],!!X))if('object'==typeof X){for(H=arguments.length,Y=Array(H-1),D=1;D<H;++D)Y[D-1]=arguments[D];for(X=X.slice(),D=0;V=X[D];++D)E.call(V,this,Y)}else switch(arguments.length){case 1:L.call(X,this);break;case 2:L.call(X,this,arguments[1]);break;case 3:L.call(X,this,arguments[1],arguments[2]);break;default:for(H=arguments.length,Y=Array(H-1),D=1;D<H;++D)Y[D-1]=arguments[D];E.call(X,this,Y);}},M={on:O,once:B,off:A,emit:I},W={on:C(O),once:C(B),off:C(A),emit:C(I)},U=T({},W),v.exports=k=function(F){return null==F?P(U):T(Object(F),W)},k.methods=M},function(v,k,_){'use strict';function S(T,z){if(!(T instanceof z))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function T(z,N){for(var O=0,B;O<N.length;O++)B=N[O],B.enumerable=B.enumerable||!1,B.configurable=!0,'value'in B&&(B.writable=!0),Object.defineProperty(z,B.key,B)}return function(z,N,O){return N&&T(z.prototype,N),O&&T(z,O),z}}(),L=_(6),P=function(T){return T&&T.__esModule?T:{default:T}}(L),R=function(){function T(z){S(this,T);var N,O;N=z.indexOf('://'),-1<N&&(z=new URL(z).pathname),O=this.parse(z),this.path=z,this.directory=this.isDirectory(z)?z:O.dir+'/',this.filename=O.base,this.extension=O.ext.slice(1)}return E(T,[{key:'parse',value:function(N){return P.default.parse(N)}},{key:'isAbsolute',value:function(N){return P.default.isAbsolute(N||this.path)}},{key:'isDirectory',value:function(N){return'/'===N.charAt(N.length-1)}},{key:'resolve',value:function(N){return P.default.resolve(this.directory,N)}},{key:'relative',value:function(N){return P.default.relative(this.directory,N)}},{key:'splitPath',value:function(N){return this.splitPathRe.exec(N).slice(1)}},{key:'toString',value:function(){return this.path}}]),T}();k.default=R,v.exports=k['default']},function(v,k,_){'use strict';function C(A){return A&&A.__esModule?A:{default:A}}Object.defineProperty(k,'__esModule',{value:!0}),k.replaceBase=function(A,I){var M,W;A&&(W=(0,T.qs)(A,'head'),M=(0,T.qs)(W,'base'),!M&&(M=A.createElement('base'),W.insertBefore(M,W.firstChild)),M.setAttribute('href',I.url))},k.replaceCanonical=function(A,I){var M,W,U=I.url;A&&(M=(0,T.qs)(A,'head'),W=(0,T.qs)(M,'link[rel=\\'canonical\\']'),W?W.setAttribute('href',U):(W=A.createElement('link'),W.setAttribute('rel','canonical'),W.setAttribute('href',U),M.appendChild(W)))},k.replaceMeta=function(A,I){var M,W,U=I.idref;A&&(M=(0,T.qs)(A,'head'),W=(0,T.qs)(M,'link[property=\\'dc:identifier\\']'),W?W.setAttribute('content',U):(W=A.createElement('meta'),W.setAttribute('property','dc:identifier'),W.setAttribute('content',U),M.appendChild(W)))},k.replaceLinks=function(A,I){var M=A.querySelectorAll('a[href]');if(M.length)for(var W=(0,T.qs)(A.ownerDocument,'base'),U=W?W.getAttribute('href'):void 0,F=function(H){var V=H.getAttribute('href');if(0!==V.indexOf('mailto:')){var X=-1<V.indexOf('://'),Y=new N.default(V,U);X?H.setAttribute('target','_blank'):H.onclick=function(){return Y&&Y.hash?I(Y.Path.path+Y.hash):Y?I(Y.Path.path):I(V),!1}}}.bind(this),D=0;D<M.length;D++)F(M[D])},k.substitute=function(A,I,M){return I.forEach(function(W,U){W&&M[U]&&(A=A.replace(new RegExp(W,'g'),M[U]))}),A};var T=_(0),z=_(5),N=C(z),O=_(3),B=C(O)},function(v,k,_){'use strict';function C(N){return N&&N.__esModule?N:{default:N}}function S(N,O){if(!(N instanceof O))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function N(O,B){for(var A=0,I;A<B.length;A++)I=B[A],I.enumerable=I.enumerable||!1,I.configurable=!0,'value'in I&&(I.writable=!0),Object.defineProperty(O,I.key,I)}return function(O,B,A){return B&&N(O.prototype,B),A&&N(O,A),O}}(),L=_(3),P=C(L),R=_(6),T=C(R),z=function(){function N(O,B){S(this,N);var A=-1<O.indexOf('://'),I=O,M;if(this.Url=void 0,this.href=O,this.protocol='',this.origin='',this.hash='',this.hash='',this.search='',this.base=B,!A&&!1!==B&&'string'!=typeof B&&window&&window.location&&(this.base=window.location.href),A||this.base)try{this.Url=this.base?new URL(O,this.base):new URL(O),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,I=this.Url.pathname}catch(W){this.Url=void 0,this.base&&(M=new P.default(this.base),I=M.resolve(I))}this.Path=new P.default(I),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return E(N,[{key:'path',value:function(){return this.Path}},{key:'resolve',value:function(B){var A=-1<B.indexOf('://'),I;return A?B:(I=T.default.resolve(this.directory,B),this.origin+I)}},{key:'relative',value:function(B){return T.default.relative(B,this.directory)}},{key:'toString',value:function(){return this.href}}]),N}();k.default=z,v.exports=k['default']},function(v){'use strict';function C(R){if('string'!=typeof R)throw new TypeError('Path must be a string. Received '+R)}function S(R,T){for(var z='',N=-1,O=0,A=0,B;A<=R.length;++A){if(A<R.length)B=R.charCodeAt(A);else if(47===B)break;else B=47;if(47===B){if(N==A-1||1==O);else if(N!=A-1&&2==O){if(2>z.length||46!==z.charCodeAt(z.length-1)||46!==z.charCodeAt(z.length-2))if(2<z.length){for(var I=z.length-1,M=I;0<=M&&47!==z.charCodeAt(M);--M);if(M!=I){z=-1==M?'':z.slice(0,M),N=A,O=0;continue}}else if(2===z.length||1===z.length){z='',N=A,O=0;continue}T&&(0<z.length?z+='/..':z='..')}else 0<z.length?z+='/'+R.slice(N+1,A):z=R.slice(N+1,A);N=A,O=0}else 46===B&&-1!=O?++O:O=-1}return z}function E(R,T){var z=T.dir||T.root,N=T.base||(T.name||'')+(T.ext||'');return z?z===T.root?z+N:z+R+N:N}if(!L)var L={cwd:function(){return'/'}};var P={resolve:function(){for(var T='',z=!1,O=arguments.length-1,N;-1<=O&&!z;O--){var B;(0<=O?B=arguments[O]:(void 0==N&&(N=L.cwd()),B=N),C(B),0!==B.length)&&(T=B+'/'+T,z=47===B.charCodeAt(0))}return T=S(T,!z),z?0<T.length?'/'+T:'/':0<T.length?T:'.'},normalize:function(T){if(C(T),0===T.length)return'.';var z=47===T.charCodeAt(0),N=47===T.charCodeAt(T.length-1);return T=S(T,!z),0!==T.length||z||(T='.'),0<T.length&&N&&(T+='/'),z?'/'+T:T},isAbsolute:function(T){return C(T),0<T.length&&47===T.charCodeAt(0)},join:function(){if(0===arguments.length)return'.';for(var z=0,T,N;z<arguments.length;++z)N=arguments[z],C(N),0<N.length&&(void 0==T?T=N:T+='/'+N);return void 0===T?'.':P.normalize(T)},relative:function(T,z){if(C(T),C(z),T===z)return'';if(T=P.resolve(T),z=P.resolve(z),T===z)return'';for(var N=1;N<T.length&&47===T.charCodeAt(N);++N);for(var O=T.length,B=O-N,A=1;A<z.length&&47===z.charCodeAt(A);++A);for(var I=z.length,M=I-A,W=B<M?B:M,U=-1,F=0;F<=W;++F){if(F==W){if(M>W){if(47===z.charCodeAt(A+F))return z.slice(A+F+1);if(0==F)return z.slice(A+F)}else B>W&&(47===T.charCodeAt(N+F)?U=F:0==F&&(U=0));break}var D=T.charCodeAt(N+F),H=z.charCodeAt(A+F);if(D!==H)break;else 47===D&&(U=F)}var V='';for(F=N+U+1;F<=O;++F)(F===O||47===T.charCodeAt(F))&&(V+=0===V.length?'..':'/..');return 0<V.length?V+z.slice(A+U):(A+=U,47===z.charCodeAt(A)&&++A,z.slice(A))},_makeLong:function(T){return T},dirname:function(T){if(C(T),0===T.length)return'.';for(var z=T.charCodeAt(0),N=47===z,O=-1,B=!0,A=T.length-1;1<=A;--A)if(z=T.charCodeAt(A),47!==z)B=!1;else if(!B){O=A;break}return-1===O?N?'/':'.':N&&1===O?'//':T.slice(0,O)},basename:function(T,z){if(z!==void 0&&'string'!=typeof z)throw new TypeError('\"ext\" argument must be a string');C(T);var N=0,O=-1,B=!0,A;if(void 0!==z&&0<z.length&&z.length<=T.length){if(z.length===T.length&&z===T)return'';var I=z.length-1,M=-1;for(A=T.length-1;0<=A;--A){var W=T.charCodeAt(A);if(47!==W)-1==M&&(B=!1,M=A+1),0<=I&&(W===z.charCodeAt(I)?-1==--I&&(O=A):(I=-1,O=M));else if(!B){N=A+1;break}}return N===O?O=M:-1===O&&(O=T.length),T.slice(N,O)}for(A=T.length-1;0<=A;--A)if(47!==T.charCodeAt(A))-1==O&&(B=!1,O=A+1);else if(!B){N=A+1;break}return-1===O?'':T.slice(N,O)},extname:function(T){C(T);for(var z=-1,N=0,O=-1,B=!0,A=0,I=T.length-1,M;0<=I;--I){if(M=T.charCodeAt(I),47===M){if(!B){N=I+1;break}continue}-1==O&&(B=!1,O=I+1),46===M?-1==z?z=I:1!=A&&(A=1):-1!==z&&(A=-1)}return-1===z||-1===O||0==A||1==A&&z===O-1&&z===N+1?'':T.slice(z,O)},format:function(T){if(null===T||'object'!=typeof T)throw new TypeError('Parameter \"pathObject\" must be an object, not '+typeof T);return E('/',T)},parse:function(T){C(T);var z={root:'',dir:'',base:'',ext:'',name:''};if(0===T.length)return z;var N=T.charCodeAt(0),O=47===N,B;O?(z.root='/',B=1):B=0;for(var A=-1,I=0,M=-1,W=!0,U=T.length-1,F=0;U>=B;--U){if(N=T.charCodeAt(U),47===N){if(!W){I=U+1;break}continue}-1==M&&(W=!1,M=U+1),46===N?-1==A?A=U:1!=F&&(F=1):-1!=A&&(F=-1)}return-1==A||-1==M||0==F||1==F&&A==M-1&&A==I+1?-1!=M&&(0==I&&O?z.base=z.name=T.slice(1,M):z.base=z.name=T.slice(I,M)):(0==I&&O?(z.name=T.slice(1,A),z.base=T.slice(1,M)):(z.name=T.slice(I,A),z.base=T.slice(I,M)),z.ext=T.slice(A,M)),0<I?z.dir=T.slice(0,I-1):O&&(z.dir='/'),z},sep:'/',delimiter:':',posix:null};v.exports=P},function(v,k,_){'use strict';function C(W){return W&&W.__esModule?W:{default:W}}function S(W,U){if(!(W instanceof U))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function W(U,F){for(var D=0,H;D<F.length;D++)H=F[D],H.enumerable=H.enumerable||!1,H.configurable=!0,'value'in H&&(H.writable=!0),Object.defineProperty(U,H.key,H)}return function(U,F,D){return F&&W(U.prototype,F),D&&W(U,D),U}}(),L=_(2),P=C(L),R=_(0),T=_(1),z=C(T),N=_(9),O=C(N),B=_(4),A=_(25),I=['keydown','keyup','keypressed','mouseup','mousedown','click','touchend','touchstart'],M=function(){function W(U,F,D,H){S(this,W),this.epubcfi=new z.default,this.document=U,this.documentElement=this.document.documentElement,this.content=F||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=H||0,this.cfiBase=D||'',this.pane=void 0,this.highlights={},this.underlines={},this.marks={},this.listeners()}return E(W,[{key:'width',value:function(F){var D=this.content;return F&&(0,R.isNumber)(F)&&(F+='px'),F&&(D.style.width=F),this.window.getComputedStyle(D).width}},{key:'height',value:function(F){var D=this.content;return F&&(0,R.isNumber)(F)&&(F+='px'),F&&(D.style.height=F),this.window.getComputedStyle(D).height}},{key:'contentWidth',value:function(F){var D=this.content||this.document.body;return F&&(0,R.isNumber)(F)&&(F+='px'),F&&(D.style.width=F),this.window.getComputedStyle(D).width}},{key:'contentHeight',value:function(F){var D=this.content||this.document.body;return F&&(0,R.isNumber)(F)&&(F+='px'),F&&(D.style.height=F),this.window.getComputedStyle(D).height}},{key:'textWidth',value:function(){var D=this.document.createRange(),H=this.content||this.document.body,F;return D.selectNodeContents(H),F=D.getBoundingClientRect().width,F}},{key:'textHeight',value:function(){var D=this.document.createRange(),H=this.content||this.document.body,F;return D.selectNodeContents(H),F=D.getBoundingClientRect().height,F}},{key:'scrollWidth',value:function(){var F=this.documentElement.scrollWidth;return F}},{key:'scrollHeight',value:function(){var F=this.documentElement.scrollHeight;return F}},{key:'overflow',value:function(F){return F&&(this.documentElement.style.overflow=F),this.window.getComputedStyle(this.documentElement).overflow}},{key:'overflowX',value:function(F){return F&&(this.documentElement.style.overflowX=F),this.window.getComputedStyle(this.documentElement).overflowX}},{key:'overflowY',value:function(F){return F&&(this.documentElement.style.overflowY=F),this.window.getComputedStyle(this.documentElement).overflowY}},{key:'css',value:function(F,D,H){var V=this.content||this.document.body;return D&&V.style.setProperty(F,D,H?'important':''),this.window.getComputedStyle(V)[F]}},{key:'viewport',value:function(F){var te=this.document.querySelector('meta[name=\\'viewport\\']'),ne={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},ae=[],Z,Q;if(te&&te.hasAttribute('content')){var ie=te.getAttribute('content'),se=ie.match(/width\\s*=\\s*([^,]*)/g),re=ie.match(/height\\s*=\\s*([^,]*)/g),oe=ie.match(/initial-scale\\s*=\\s*([^,]*)/g),le=ie.match(/minimum-scale\\s*=\\s*([^,]*)/g),de=ie.match(/maximum-scale\\s*=\\s*([^,]*)/g),ue=ie.match(/user-scalable\\s*=\\s*([^,]*)/g);se&&se.length&&'undefined'!=typeof se[1]&&(ne.width=se[1]),re&&re.length&&'undefined'!=typeof re[1]&&(ne.height=re[1]),oe&&oe.length&&'undefined'!=typeof oe[1]&&(ne.scale=oe[1]),le&&le.length&&'undefined'!=typeof le[1]&&(ne.minimum=le[1]),de&&de.length&&'undefined'!=typeof de[1]&&(ne.maximum=de[1]),ue&&ue.length&&'undefined'!=typeof ue[1]&&(ne.scalable=ue[1])}return F&&((F.width||ne.width)&&ae.push('width='+(F.width||ne.width)),(F.height||ne.height)&&ae.push('height='+(F.height||ne.height)),(F.scale||ne.scale)&&ae.push('initial-scale='+(F.scale||ne.scale)),(F.scalable||ne.scalable)&&(ae.push('minimum-scale='+(F.scale||ne.minimum)),ae.push('maximum-scale='+(F.scale||ne.maximum)),ae.push('user-scalable='+(F.scalable||ne.scalable))),!te&&(te=this.document.createElement('meta'),te.setAttribute('name','viewport'),this.document.querySelector('head').appendChild(te)),te.setAttribute('content',ae.join(', ')),this.window.scrollTo(0,0)),{width:parseInt(Z),height:parseInt(Q)}}},{key:'expand',value:function(){this.emit('expand')}},{key:'listeners',value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}},{key:'removeListeners',value:function(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}},{key:'resizeCheck',value:function(){var F=this.textWidth(),D=this.textHeight();(F!=this._size.width||D!=this._size.height)&&(this._size={width:F,height:D},this.pane&&this.pane.render(),this.onResize&&this.onResize(this._size),this.emit('resize',this._size))}},{key:'resizeListeners',value:function(){var F,D;clearTimeout(this.expanding),F=this.textWidth(),D=this.textHeight(),this.resizeCheck(),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:'transitionListeners',value:function(){var F=this.content;F.style.transitionProperty='font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height',F.style.transitionDuration='0.001ms',F.style.transitionTimingFunction='linear',F.style.transitionDelay='0',this.document.addEventListener('transitionend',this.resizeCheck.bind(this))}},{key:'mediaQueryListeners',value:function(){for(var F=this.document.styleSheets,D=function(J){J.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),H=0;H<F.length;H+=1){var V;try{V=F[H].cssRules}catch(J){return}if(!V)return;for(var X=0;X<V.length;X+=1)if(V[X].media){var Y=this.window.matchMedia(V[X].media.mediaText);Y.addListener(D)}}}},{key:'resizeObservers',value:function(){var F=this;this.observer=new MutationObserver(function(){F.resizeCheck()});this.observer.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}},{key:'imageLoadListeners',value:function(){for(var D=this.document.querySelectorAll('img'),V=0,H;V<D.length;V++)H=D[V],'undefined'!=typeof H.naturalWidth&&0===H.naturalWidth&&(H.onload=this.expand.bind(this))}},{key:'fontLoadListeners',value:function(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.expand()}.bind(this))}},{key:'root',value:function(){return this.document?this.document.documentElement:null}},{key:'locationOf',value:function(F,D){var V={left:0,top:0},H;if(this.document){if(this.epubcfi.isCfiString(F)){var X=new z.default(F).toRange(this.document,D);X&&(X.startContainer.nodeType===Node.ELEMENT_NODE?(H=X.startContainer.getBoundingClientRect(),V.left=H.left,V.top=H.top):X.collapsed?H=X.getClientRects()[0]:H=X.getBoundingClientRect())}else if('string'==typeof F&&-1<F.indexOf('#')){var Y=F.substring(F.indexOf('#')+1),J=this.document.getElementById(Y);J&&(H=J.getBoundingClientRect())}return H&&(V.left=H.left,V.top=H.top),V}}},{key:'addStylesheet',value:function(F){return new Promise(function(D){var X=!1,V;return this.document?(V=this.document.querySelector('link[href=\\''+F+'\\']'),V?void D(!0):void(V=this.document.createElement('link'),V.type='text/css',V.rel='stylesheet',V.href=F,V.onload=V.onreadystatechange=function(){var Y=this;X||this.readyState&&'complete'!=this.readyState||(X=!0,setTimeout(function(){Y.pane&&Y.pane.render(),D(!0)},1))},this.document.head.appendChild(V))):void D(!1)}.bind(this))}},{key:'addStylesheetRules',value:function(F){var V='epubjs-inserted-css',D,H;if(this.document&&F&&0!==F.length){if(D=this.document.getElementById('#'+V),D||(D=this.document.createElement('style'),D.id=V),this.document.head.appendChild(D),H=D.sheet,'[object Array]'===Object.prototype.toString.call(F))for(var X=0,Y=F.length;X<Y;X++){var J=1,Z=F[X],Q=F[X][0],K='';'[object Array]'===Object.prototype.toString.call(Z[1][0])&&(Z=Z[1],J=0);for(var G=Z.length,$;J<G;J++)$=Z[J],K+=$[0]+':'+$[1]+($[2]?' !important':'')+';\\n';H.insertRule(Q+'{'+K+'}',H.cssRules.length)}else{var ee=Object.keys(F);ee.forEach(function(te){var ne=F[te];if(Array.isArray(ne))ne.forEach(function(se){var re=Object.keys(se),oe=re.map(function(le){return le+':'+se[le]}).join(';');H.insertRule(te+'{'+oe+'}',H.cssRules.length)});else{var ae=Object.keys(ne),ie=ae.map(function(se){return se+':'+ne[se]}).join(';');H.insertRule(te+'{'+ie+'}',H.cssRules.length)}})}this.pane&&this.pane.render()}}},{key:'addScript',value:function(F){return new Promise(function(D){var X=!1,V;return this.document?void(V=this.document.createElement('script'),V.type='text/javascript',V.async=!0,V.src=F,V.onload=V.onreadystatechange=function(){X||this.readyState&&'complete'!=this.readyState||(X=!0,setTimeout(function(){D(!0)},1))},this.document.head.appendChild(V)):void D(!1)}.bind(this))}},{key:'addClass',value:function(F){var D;this.document&&(D=this.content||this.document.body,D&&D.classList.add(F))}},{key:'removeClass',value:function(F){var D;this.document&&(D=this.content||this.document.body,D&&D.classList.remove(F))}},{key:'addEventListeners',value:function(){this.document&&I.forEach(function(F){this.document.addEventListener(F,this.triggerEvent.bind(this),!1)},this)}},{key:'removeEventListeners',value:function(){this.document&&I.forEach(function(F){this.document.removeEventListener(F,this.triggerEvent,!1)},this)}},{key:'triggerEvent',value:function(F){this.emit(F.type,F)}},{key:'addSelectionListeners',value:function(){this.document&&this.document.addEventListener('selectionchange',this.onSelectionChange.bind(this),!1)}},{key:'removeSelectionListeners',value:function(){this.document&&this.document.removeEventListener('selectionchange',this.onSelectionChange,!1)}},{key:'onSelectionChange',value:function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var D=this.window.getSelection();this.triggerSelectedEvent(D)}.bind(this),250)}},{key:'triggerSelectedEvent',value:function(F){var D,H;F&&0<F.rangeCount&&(D=F.getRangeAt(0),!D.collapsed&&(H=new z.default(D,this.cfiBase).toString(),this.emit('selected',H),this.emit('selectedRange',D)))}},{key:'range',value:function(F,D){var H=new z.default(F);return H.toRange(this.document,D)}},{key:'cfiFromRange',value:function(F,D){return new z.default(F,this.cfiBase,D).toString()}},{key:'cfiFromNode',value:function(F,D){return new z.default(F,this.cfiBase,D).toString()}},{key:'map',value:function(F){var U=new O.default(F);return U.section()}},{key:'size',value:function(F,D){var H={scale:1,scalable:'no'};0<=F&&(this.width(F),H.width=F,this.css('padding','0 '+F/12+'px',!0)),0<=D&&(this.height(D),H.height=D),this.css('margin','0'),this.css('box-sizing','border-box'),this.viewport(H)}},{key:'columns',value:function(F,D,H,V){var X=(0,R.prefixed)('column-axis'),Y=(0,R.prefixed)('column-gap'),J=(0,R.prefixed)('column-width'),Z=(0,R.prefixed)('column-fill');this.width(F),this.height(D),this.viewport({width:F,height:D,scale:1,scalable:'no'}),this.css('display','inline-block'),this.css('overflow-y','hidden'),this.css('margin','0',!0),this.css('padding','20px '+V/2+'px',!0),this.css('box-sizing','border-box'),this.css('max-width','inherit'),this.css(X,'horizontal'),this.css(Z,'auto'),this.css(Y,V+'px'),this.css(J,H+'px')}},{key:'scaler',value:function(F,D,H){var X='';this.css('transform-origin','top left'),(0<=D||0<=H)&&(X=' translate('+(D||0)+'px, '+(H||0)+'px )'),this.css('transform','scale('+F+')'+X)}},{key:'fit',value:function(F,D){var H=this.viewport(),V=F/H.width,X=D/H.height,Y=V<X?V:X,J=(D-H.height*Y)/2;this.width(F),this.height(D),this.overflow('hidden'),this.viewport({width:F,height:D,scale:1}),this.scaler(Y,0,J),this.css('background-color','transparent')}},{key:'mapPage',value:function(F,D,H,V,X){var Y=new O.default(D,X);return Y.page(this,F,H,V)}},{key:'linksHandler',value:function(){var F=this;(0,B.replaceLinks)(this.content,function(D){F.emit('linkClicked',D)})}},{key:'highlight',value:function(F){var D=this,H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},V=arguments[2],X=this.range(F),Y=function(){D.emit('markClicked',F,H)};H.epubcfi=F,this.pane||(this.pane=new A.Pane(this.content,this.document.body));var J=new A.Highlight(X,'epubjs-hl',H,{fill:'yellow',\"fill-opacity\":'0.3',\"mix-blend-mode\":'multiply'}),Z=this.pane.addMark(J);return this.highlights[F]={mark:Z,element:Z.element,listeners:[Y,V]},Z.element.addEventListener('click',Y),V&&Z.element.addEventListener('click',V),Z}},{key:'underline',value:function(F){var D=this,H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},V=arguments[2],X=this.range(F),Y=function(){D.emit('markClicked',F,H)};H.epubcfi=F,this.pane||(this.pane=new A.Pane(this.content,this.document.body));var J=new A.Underline(X,'epubjs-ul',H,{stroke:'black',\"stroke-opacity\":'0.3',\"mix-blend-mode\":'multiply'}),Z=this.pane.addMark(J);return this.underlines[F]={mark:Z,element:Z.element,listeners:[Y,V]},Z.element.addEventListener('click',Y),V&&Z.element.addEventListener('click',V),Z}},{key:'mark',value:function(F){var D=this,H=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},V=arguments[2];if(F in this.marks){var X=this.marks[F];return X}var Y=this.range(F),J=Y.commonAncestorContainer,Z=1===J.nodeType?J:J.parentNode,Q=function(){D.emit('markClicked',F,H)},K=Z.getBoundingClientRect(),U=this.document.createElement('a');return U.setAttribute('ref','epubjs-mk'),U.style.position='absolute',U.style.top=K.top+'px',U.style.left=K.right+'px',U.dataset.epubcfi=F,H&&Object.keys(H).forEach(function(G){U.dataset[G]=H[G]}),V&&U.addEventListener('click',V),U.addEventListener('click',Q),this.content.appendChild(U),this.marks[F]={element:U,listeners:[Q,V]},Z}},{key:'unhighlight',value:function(F){var D;F in this.highlights&&(D=this.highlights[F],this.pane.removeMark(D.mark),D.listeners.forEach(function(H){H&&D.element.removeEventListener('click',H)}),delete this.highlights[F])}},{key:'ununderline',value:function(F){var D;F in this.underlines&&(D=this.underlines[F],this.pane.removeMark(D.mark),D.listeners.forEach(function(H){H&&D.element.removeEventListener('click',H)}),delete this.underlines[F])}},{key:'unmark',value:function(F){var D;F in this.marks&&(D=this.marks[F],this.content.removeChild(D.element),D.listeners.forEach(function(H){H&&D.element.removeEventListener('click',H)}),delete this.marks[F])}},{key:'destroy',value:function(){this.observer&&this.observer.disconnect(),this.document.removeEventListener('transitionend',this.resizeCheck),this.removeListeners()}}],[{key:'listenedEvents',get:function(){return I}}]),W}();(0,P.default)(M.prototype),k.default=M,v.exports=k['default']},function(v){var _=function(){return this}();try{_=_||Function('return this')()||(1,eval)('this')}catch(C){'object'==typeof window&&(_=window)}v.exports=_},function(v,k,_){'use strict';function S(T,z){if(!(T instanceof z))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function T(z,N){for(var O=0,B;O<N.length;O++)B=N[O],B.enumerable=B.enumerable||!1,B.configurable=!0,'value'in B&&(B.writable=!0),Object.defineProperty(z,B.key,B)}return function(z,N,O){return N&&T(z.prototype,N),O&&T(z,O),z}}(),L=_(1),P=function(T){return T&&T.__esModule?T:{default:T}}(L),R=function(){function T(z,N){S(this,T),this.layout=z,this.horizontal='paginated'===this.layout.flow,this._dev=N}return E(T,[{key:'section',value:function(N){var O=this.findRanges(N),B=this.rangeListToCfiList(N.section.cfiBase,O);return B}},{key:'page',value:function(N,O,B,A){var I=N&&N.document&&N.document.body,M;if(I){if(M=this.rangePairToCfiPair(O,{start:this.findStart(I,B,A),end:this.findEnd(I,B,A)}),!0===this._dev){var W=N.document,U=new P.default(M.start).toRange(W),F=new P.default(M.end).toRange(W),D=W.defaultView.getSelection(),H=W.createRange();D.removeAllRanges(),H.setStart(U.startContainer,U.startOffset),H.setEnd(F.endContainer,F.endOffset),D.addRange(H)}return M}}},{key:'walk',value:function(N,O){if(!(N&&N.nodeType===Node.TEXT_NODE)){var B={acceptNode:function(F){return 0<F.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},A=B.acceptNode;A.acceptNode=B.acceptNode;for(var I=document.createTreeWalker(N,NodeFilter.SHOW_TEXT,A,!1),M,W;(M=I.nextNode())&&(W=O(M),!W););return W}}},{key:'findRanges',value:function(N){for(var O=[],B=N.contents.scrollWidth(),A=Math.ceil(B/this.layout.spreadWidth),I=A*this.layout.divisor,M=this.layout.columnWidth,W=this.layout.gap,D=0,U,F;D<I.pages;D++)U=(M+W)*D,F=M*(D+1)+W*D,O.push({start:this.findStart(N.document.body,U,F),end:this.findEnd(N.document.body,U,F)});return O}},{key:'findStart',value:function(N,O,B){for(var A=this,I=[N],U=N,M,W;I.length;)if(M=I.shift(),W=this.walk(M,function(F){var D,H,V,X;return(F.nodeType==Node.TEXT_NODE?(X=document.createRange(),X.selectNodeContents(F),V=X.getBoundingClientRect()):V=F.getBoundingClientRect(),D=A.horizontal?V.left:V.top,H=A.horizontal?V.right:V.bottom,D>=O&&D<=B)?F:H>O?F:void(U=F,I.push(F))}),W)return this.findTextStartRange(W,O,B);return this.findTextStartRange(U,O,B)}},{key:'findEnd',value:function(N,O,B){for(var A=this,I=[N],W=N,M,U;I.length;)if(M=I.shift(),U=this.walk(M,function(F){var D,H,V,X;return(F.nodeType==Node.TEXT_NODE?(X=document.createRange(),X.selectNodeContents(F),V=X.getBoundingClientRect()):V=F.getBoundingClientRect(),D=Math.round(A.horizontal?V.left:V.top),H=Math.round(A.horizontal?V.right:V.bottom),D>B&&W)?W:H>B?F:void(W=F,I.push(F))}),U)return this.findTextEndRange(U,O,B);return this.findTextEndRange(W,O,B)}},{key:'findTextStartRange',value:function(N,O){for(var A=this.splitTextNodeIntoRanges(N),U=0,I,M,W;U<A.length;U++)if(I=A[U],M=I.getBoundingClientRect(),W=this.horizontal?M.left:M.top,W>=O)return I;return A[0]}},{key:'findTextEndRange',value:function(N,O,B){for(var A=this.splitTextNodeIntoRanges(N),D=0,I,M,W,U,F;D<A.length;D++){if(M=A[D],W=M.getBoundingClientRect(),U=this.horizontal?W.left:W.top,F=this.horizontal?W.right:W.bottom,U>B&&I)return I;if(F>B)return M;I=M}return A[A.length-1]}},{key:'splitTextNodeIntoRanges',value:function(N,O){var B=[],A=N.textContent||'',I=A.trim(),W=N.ownerDocument,U=O||' ',F=I.indexOf(U),M;if(-1===F||N.nodeType!=Node.TEXT_NODE)return M=W.createRange(),M.selectNodeContents(N),[M];for(M=W.createRange(),M.setStart(N,0),M.setEnd(N,F),B.push(M),M=!1;-1!=F;)F=I.indexOf(U,F+1),0<F&&(M&&(M.setEnd(N,F),B.push(M)),M=W.createRange(),M.setStart(N,F+1));return M&&(M.setEnd(N,I.length),B.push(M)),B}},{key:'rangePairToCfiPair',value:function(N,O){var B=O.start,A=O.end;B.collapse(!0),A.collapse(!1);var I=new P.default(B,N).toString(),M=new P.default(A,N).toString();return{start:I,end:M}}},{key:'rangeListToCfiList',value:function(N,O){for(var B=[],I=0,A;I<O.length;I++)A=this.rangePairToCfiPair(N,O[I]),B.push(A);return B}}]),T}();k.default=R,v.exports=k['default']},function(v,k){'use strict';function C(L,P){if(!(L instanceof P))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function L(P,R){for(var T=0,z;T<R.length;T++)z=R[T],z.enumerable=z.enumerable||!1,z.configurable=!0,'value'in z&&(z.writable=!0),Object.defineProperty(P,z.key,z)}return function(P,R,T){return R&&L(P.prototype,R),T&&L(P,T),P}}(),E=function(){function L(P){C(this,L),this.context=P||this,this.hooks=[]}return S(L,[{key:'register',value:function(){for(var R=0;R<arguments.length;++R)if('function'==typeof arguments[R])this.hooks.push(arguments[R]);else for(var T=0;T<arguments[R].length;++T)this.hooks.push(arguments[R][T])}},{key:'trigger',value:function(){var R=arguments,T=this.context,z=[];return this.hooks.forEach(function(N){var O=N.apply(T,R);O&&'function'==typeof O.then&&z.push(O)}),Promise.all(z)}},{key:'list',value:function(){return this.hooks}},{key:'clear',value:function(){return this.hooks=[]}}]),L}();k.default=E,v.exports=k['default']},function(v,k,_){'use strict';function C(R,T){if(!(R instanceof T))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0}),k.Task=void 0;var S=function(){function R(T,z){for(var N=0,O;N<z.length;N++)O=z[N],O.enumerable=O.enumerable||!1,O.configurable=!0,'value'in O&&(O.writable=!0),Object.defineProperty(T,O.key,O)}return function(T,z,N){return z&&R(T.prototype,z),N&&R(T,N),T}}(),E=_(0),L=function(){function R(T){C(this,R),this._q=[],this.context=T,this.tick=E.requestAnimationFrame,this.running=!1,this.paused=!1}return S(R,[{key:'enqueue',value:function(){var B=[].shift.call(arguments),A=arguments,z,N,O;if(!B)throw new Error('No Task Provided');return'function'==typeof B?(z=new E.defer,N=z.promise,O={task:B,args:A,deferred:z,promise:N}):O={promise:B},this._q.push(O),!1!=this.paused||this.running||this.run(),O.promise}},{key:'dequeue',value:function(){var z,N,O;if(this._q.length&&!this.paused){if(z=this._q.shift(),N=z.task,N)return O=N.apply(this.context,z.args),O&&'function'==typeof O.then?O.then(function(){z.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){z.deferred.reject.apply(this.context,arguments)}.bind(this)):(z.deferred.resolve.apply(this.context,O),z.promise);if(z.promise)return z.promise}else return z=new E.defer,z.deferred.resolve(),z.promise}},{key:'dump',value:function(){for(;this._q.length;)this.dequeue()}},{key:'run',value:function(){var z=this;return this.running||(this.running=!0,this.defered=new E.defer),this.tick.call(window,function(){z._q.length?z.dequeue().then(function(){this.run()}.bind(z)):(z.defered.resolve(),z.running=void 0)}),!0==this.paused&&(this.paused=!1),this.defered.promise}},{key:'flush',value:function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}},{key:'clear',value:function(){this._q=[]}},{key:'length',value:function(){return this._q.length}},{key:'pause',value:function(){this.paused=!0}},{key:'stop',value:function(){this._q=[],this.running=!1,this.paused=!0}}]),R}();k.default=L,k.Task=function R(T,z,N){return C(this,R),function(){var O=this,B=arguments||[];return new Promise(function(A,I){B.push(function(U,F){!U&&F?I(F):A(U)}),T.apply(N||O,B)})}}},function(v,k,_){'use strict';Object.defineProperty(k,'__esModule',{value:!0});var E=_(0),L=_(3),P=function(R){return R&&R.__esModule?R:{default:R}}(L);k.default=function(R,T,z,N){function O(D){M.reject(D)}function B(){if(this.readyState===XMLHttpRequest.DONE){var D=!1;if((''===this.responseType||'document'===this.responseType)&&(D=this.responseXML),200===this.status||D){var H;if(!this.response&&!D)return M.reject({status:this.status,message:'Empty Response',stack:new Error().stack}),M.promise;if(403===this.status)return M.reject({status:this.status,response:this.response,message:'Forbidden',stack:new Error().stack}),M.promise;H=D?this.responseXML:(0,E.isXml)(T)?(0,E.parse)(this.response,'text/xml'):'xhtml'==T?(0,E.parse)(this.response,'application/xhtml+xml'):'html'==T||'htm'==T?(0,E.parse)(this.response,'text/html'):'json'==T?JSON.parse(this.response):'blob'==T?A?this.response:new Blob([this.response]):this.response,M.resolve(H)}else M.reject({status:this.status,message:this.response,stack:new Error().stack})}}var A='undefined'!=typeof window&&window.URL,I=A?'blob':'arraybuffer',M=new E.defer,W=new XMLHttpRequest,U=XMLHttpRequest.prototype,F;for(F in'overrideMimeType'in U||Object.defineProperty(U,'overrideMimeType',{value:function(){}}),z&&(W.withCredentials=!0),W.onreadystatechange=B,W.onerror=O,W.open('GET',R,!0),N)W.setRequestHeader(F,N[F]);return'json'==T&&W.setRequestHeader('Accept','application/json'),T||(T=new P.default(R).extension),'blob'==T&&(W.responseType=I),(0,E.isXml)(T)&&W.overrideMimeType('text/xml'),'xhtml'==T,'html'!=T&&'htm'!=T,'binary'==T&&(W.responseType='arraybuffer'),W.send(),M.promise},v.exports=k['default']},function(v,k,_){'use strict';function C(U){return U&&U.__esModule?U:{default:U}}function S(U,F){if(!(U instanceof F))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function U(F,D){for(var H=0,V;H<D.length;H++)V=D[H],V.enumerable=V.enumerable||!1,V.configurable=!0,'value'in V&&(V.writable=!0),Object.defineProperty(F,V.key,V)}return function(F,D,H){return D&&U(F.prototype,D),H&&U(F,H),F}}(),L=_(2),P=C(L),R=_(0),T=_(9),z=C(T),N=_(11),O=C(N),B=_(33),A=C(B),I=_(34),M=C(I),W=function(){function U(F){S(this,U),this.name='default',this.View=F.view,this.request=F.request,this.renditionQueue=F.queue,this.q=new O.default(this),this.settings=(0,R.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:'vertical',ignoreClass:''}),(0,R.extend)(this.settings,F.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,layout:this.layout,width:0,height:0}}return E(U,[{key:'render',value:function(D,H){var V=D.tagName;V&&('body'==V.toLowerCase()||'html'==V.toLowerCase())&&(this.fullsize=!0),this.fullsize&&(this.settings.overflow='visible',this.overflow=this.settings.overflow),this.settings.size=H,this.stage=new A.default({width:H.width,height:H.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.fullsize}),this.stage.attachTo(D),this.container=this.stage.getContainer(),this.views=new M.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout()}},{key:'addEventListeners',value:function(){var D;window.addEventListener('unload',function(){this.destroy()}.bind(this)),D=this.fullsize?window:this.container,D.addEventListener('scroll',this.onScroll.bind(this))}},{key:'removeEventListeners',value:function(){var D;D=this.fullsize?window:this.container,D.removeEventListener('scroll',this.onScroll.bind(this))}},{key:'destroy',value:function(){this.removeEventListeners(),this.views.each(function(D){D.destroy()}),this.stage.destroy()}},{key:'onOrientationChange',value:function(){var H=window,V=H.orientation;this._stageSize=this.stage.size(),this._bounds=this.bounds(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit('orientationChange',V)}},{key:'onResized',value:function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)}},{key:'resize',value:function(D,H){this.q.clear(),this._stageSize=this.stage.size(D,H),this._bounds=this.bounds(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.clear(),this.emit('resized',{width:this._stageSize.width,height:this._stageSize.height})}},{key:'createView',value:function(D){return new this.View(D,this.viewSettings)}},{key:'display',value:function(D,H){var V=new R.defer,X=V.promise;(H===D.href||parseInt(H))&&(H=void 0);var Y=this.views.find(D);if(Y&&D){var J=Y.offset();if(this.scrollTo(J.left,J.top,!0),H){var Z=Y.locationOf(H);this.moveTo(Z)}return V.resolve(),X}return this.clear(),this.add(D).then(function(Q){if(H){var K=Q.locationOf(H);this.moveTo(K)}}.bind(this)).then(function(){var Q;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(Q=D.next(),Q))return this.add(Q)}.bind(this)).then(function(){this.views.show(),V.resolve()}.bind(this)),X}},{key:'afterDisplayed',value:function(D){this.emit('added',D)}},{key:'afterResized',value:function(D){this.emit('resize',D.section)}},{key:'moveTo',value:function(D){var H=0,V=0;'vertical'===this.settings.axis?V=D.top:(H=Math.floor(D.left/this.layout.delta)*this.layout.delta,H+this.layout.delta>this.container.scrollWidth&&(H=this.container.scrollWidth-this.layout.delta)),this.scrollTo(H,V,!0)}},{key:'add',value:function(D){var H=this.createView(D);return this.views.append(H),H.onDisplayed=this.afterDisplayed.bind(this),H.onResize=this.afterResized.bind(this),H.display(this.request)}},{key:'append',value:function(D){var H=this.createView(D);return this.views.append(H),H.onDisplayed=this.afterDisplayed.bind(this),H.onResize=this.afterResized.bind(this),H.display(this.request)}},{key:'prepend',value:function(D){var H=this.createView(D);return this.views.prepend(H),H.onDisplayed=this.afterDisplayed.bind(this),H.onResize=this.afterResized.bind(this),H.display(this.request)}},{key:'next',value:function(){var F,D;if(this.views.length)return('horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,D=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,D<this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):D-this.layout.columnWidth===this.container.scrollWidth?(this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0),F=this.views.last().section.next()):F=this.views.last().section.next()):F=this.views.last().section.next(),F)?(this.clear(),this.append(F).then(function(){var H;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(H=F.next(),H))return this.append(H)}.bind(this)).then(function(){this.views.show()}.bind(this))):void 0}},{key:'prev',value:function(){var F,D;if(this.views.length)return('horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,D=this.container.scrollLeft,0<D?this.scrollBy(-this.layout.delta,0,!0):F=this.views.first().section.prev()):F=this.views.first().section.prev(),F)?(this.clear(),this.prepend(F).then(function(){var H;if('pre-paginated'===this.layout.name&&1<this.layout.divisor&&(H=F.prev(),H))return this.prepend(H)}.bind(this)).then(function(){'horizontal'===this.settings.axis&&this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0),this.views.show()}.bind(this))):void 0}},{key:'current',value:function(){var D=this.visible();return D.length?D[D.length-1]:null}},{key:'clear',value:function(){this.q.clear(),this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}},{key:'currentLocation',value:function(){return this.location='vertical'===this.settings.axis?this.scrolledLocation():this.paginatedLocation(),this.location}},{key:'scrolledLocation',value:function(){var D=this,H=this.visible(),V=this.container.getBoundingClientRect(),X=V.height<window.innerHeight?V.height:window.innerHeight,Y=0,J=0;this.fullsize&&(Y=window.scrollY);var Z=H.map(function(Q){var K=Q.section,G=K.index,$=K.href,ee=Q.position(),te=ee.top-V.top+Y+J,ne=te+X-J;ne>ee.bottom-V.top+Y&&(ne=ee.bottom-V.top+Y,J=ne-te);var ae=D.layout.count(Q._height,X).pages,ie=Math.ceil(te/X),se=[],re=Math.ceil(ne/X);se=[ie];for(var oe=ie,le;oe<=re;oe++)le=oe,se.push(le);var de=D.mapping.page(Q.contents,Q.section.cfiBase,te,ne);return{index:G,href:$,pages:se,totalPages:ae,mapping:de}});return Z}},{key:'paginatedLocation',value:function(){var D=this,H=this.visible(),V=this.container.getBoundingClientRect(),X=0,Y=0;this.fullsize&&(X=window.scrollX);var J=H.map(function(Z){var Q=Z.section,K=Q.index,G=Q.href,$=Z.offset().left,ee=Z.position().left,te=Z.width(),ne=X+V.left-ee+Y,ae=ne+D.layout.spreadWidth-Y,ie=D.mapping.page(Z.contents,Z.section.cfiBase,ne,ae),se=X+Y,re=se+D.layout.spreadWidth-Y;re>$+te&&(re=$+te,Y=D.layout.pageWidth);var oe=D.layout.count(te).pages,le=Math.ceil((se+D.layout.gap-$)/D.layout.pageWidth),de=[],ue=Math.ceil((re-D.layout.gap-$)/D.layout.pageWidth);de=[le];for(var ce=le,pe;ce<=ue;ce++)pe=ce,de.push(pe);return{index:K,href:G,pages:de,totalPages:oe,mapping:ie}});return J}},{key:'isVisible',value:function(D,H,V,X){var Y=D.position(),J=X||this.bounds();return'horizontal'===this.settings.axis&&Y.right>J.left-H&&Y.left<J.right+V||'vertical'===this.settings.axis&&Y.bottom>J.top-H&&Y.top<J.bottom+V}},{key:'visible',value:function(){for(var D=this.bounds(),H=this.views.displayed(),V=H.length,F=[],J=0,X,Y;J<V;J++)Y=H[J],X=this.isVisible(Y,0,0,D),!0===X&&F.push(Y);return F}},{key:'scrollBy',value:function(D,H,V){V&&(this.ignore=!0),this.fullsize?window.scrollBy(D,H):(D&&(this.container.scrollLeft+=D),H&&(this.container.scrollTop+=H)),this.scrolled=!0}},{key:'scrollTo',value:function(D,H,V){V&&(this.ignore=!0),this.fullsize?window.scrollTo(D,H):(this.container.scrollLeft=D,this.container.scrollTop=H),this.scrolled=!0}},{key:'onScroll',value:function(){var D,H;this.fullsize?(D=window.scrollY,H=window.scrollX):(D=this.container.scrollTop,H=this.container.scrollLeft),this.scrollTop=D,this.scrollLeft=H,this.ignore?this.ignore=!1:(this.emit('scroll',{top:D,left:H}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit('scrolled',{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}},{key:'bounds',value:function(){var F;return F=this.stage.bounds(),F}},{key:'applyLayout',value:function(D){this.layout=D,this.updateLayout(),this.mapping=new z.default(this.layout.props)}},{key:'updateLayout',value:function(){this.stage&&(this._stageSize=this.stage.size(),'vertical'===this.settings.axis?this.layout.calculate(this._stageSize.width,this._stageSize.height):(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:'setLayout',value:function(D){this.viewSettings.layout=D,this.views&&this.views.each(function(H){H.setLayout(D)})}},{key:'updateFlow',value:function(D){var H='paginated'===D?'horizontal':'vertical';this.settings.axis=H,this.stage&&this.stage.axis(H),this.viewSettings.axis=H,this.overflow=this.settings.overflow?this.settings.overflow:'paginated'===D?'hidden':'auto',this.updateLayout()}},{key:'getContents',value:function(){var D=[];return this.views.each(function(H){D.push(H.contents)}),D}}]),U}();(0,P.default)(W.prototype),k.default=W,v.exports=k['default']},function(v,k,_){'use strict';function C(Q){return Q&&Q.__esModule?Q:{default:Q}}function S(Q,K){if(!(Q instanceof K))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(Q){return typeof Q}:function(Q){return Q&&'function'==typeof Symbol&&Q.constructor===Symbol&&Q!==Symbol.prototype?'symbol':typeof Q},L=function(){function Q(K,G){for(var $=0,ee;$<G.length;$++)ee=G[$],ee.enumerable=ee.enumerable||!1,ee.configurable=!0,'value'in ee&&(ee.writable=!0),Object.defineProperty(K,ee.key,ee)}return function(K,G,$){return G&&Q(K.prototype,G),$&&Q(K,$),K}}(),P=_(2),R=C(P),T=_(0),z=_(10),N=C(z),O=_(1),B=C(O),A=_(11),I=C(A),M=_(31),W=C(M),U=_(9),F=C(U),D=_(41),H=C(D),V=_(7),X=C(V),Y=_(27),J=C(Y),Z=function(){function Q(K,G){S(this,Q),this.settings=(0,T.extend)(this.settings||{},{width:null,height:null,ignoreClass:'',manager:'default',view:'iframe',flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,script:null}),(0,T.extend)(this.settings,G),'object'===E(this.settings.manager)&&(this.manager=this.settings.manager),this.viewSettings={ignoreClass:this.settings.ignoreClass},this.book=K,this.views=null,this.hooks={},this.hooks.display=new N.default(this),this.hooks.serialize=new N.default(this),this.hooks.content=new N.default(this),this.hooks.unloaded=new N.default(this),this.hooks.layout=new N.default(this),this.hooks.render=new N.default(this),this.hooks.show=new N.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectSource.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new H.default(this),this.annotations=new J.default(this),this.epubcfi=new B.default,this.q=new I.default(this),this.q.enqueue(this.book.opened),this.starting=new T.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}return L(Q,[{key:'setManager',value:function(G){this.manager=G}},{key:'requireManager',value:function(G){var $;return $='string'==typeof G?'undefined'==typeof ePub?void 0:ePub.ViewManagers[G]:G,$}},{key:'requireView',value:function(G){var $;return $='string'==typeof G?'undefined'==typeof ePub?void 0:ePub.Views[G]:G,$}},{key:'start',value:function(){this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on('added',this.afterDisplayed.bind(this)),this.manager.on('removed',this.afterRemoved.bind(this)),this.manager.on('resized',this.onResized.bind(this)),this.manager.on('orientationChange',this.onOrientationChange.bind(this)),this.manager.on('scrolled',this.reportLocation.bind(this)),this.emit('started'),this.starting.resolve()}},{key:'attachTo',value:function(G){return this.q.enqueue(function(){this.manager.render(G,{width:this.settings.width,height:this.settings.height}),this.emit('attached')}.bind(this))}},{key:'display',value:function(G){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,G)}},{key:'_display',value:function(G){var $=this;if(this.book){var ee=this.epubcfi.isCfiString(G),te=new T.defer,ne=te.promise,ae;return(this.displaying=te,this.book.locations.length&&((0,T.isFloat)(G)||'string'==typeof G&&G==parseFloat(G))&&(G=this.book.locations.cfiFromPercentage(parseFloat(G))),ae=this.book.spine.get(G),!ae)?(te.reject(new Error('No Section Found')),ne):(this.manager.display(ae,G).then(function(){te.resolve(ae),$.displaying=void 0,$.emit('displayed',ae),$.reportLocation()}),ne)}}},{key:'afterDisplayed',value:function(G){var $=this;G.contents?this.hooks.content.trigger(G.contents,this).then(function(){$.emit('rendered',G.section,G)}):this.emit('rendered',G.section,G)}},{key:'afterRemoved',value:function(G){var $=this;this.hooks.unloaded.trigger(G,this).then(function(){$.emit('removed',G.section,G)})}},{key:'onResized',value:function(G){this.location&&this.location.start&&this.display(this.location.start.cfi),this.emit('resized',{width:G.width,height:G.height})}},{key:'onOrientationChange',value:function(G){this.location&&(this.manager.clear(),this.display(this.location.start.cfi)),this.emit('orientationChange',G)}},{key:'moveTo',value:function(G){this.manager.moveTo(G)}},{key:'next',value:function(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:'prev',value:function(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:'determineLayoutProperties',value:function(G){var ee=this.settings.layout||G.layout||'reflowable',te=this.settings.spread||G.spread||'auto',ne=this.settings.orientation||G.orientation||'auto',ae=this.settings.flow||G.flow||'auto',ie=G.viewport||'',se=this.settings.minSpreadWidth||G.minSpreadWidth||800,$;return 0<=this.settings.width&&0<=this.settings.height&&(ie='width='+this.settings.width+', height='+this.settings.height+''),$={layout:ee,spread:te,orientation:ne,flow:ae,viewport:ie,minSpreadWidth:se},$}},{key:'flow',value:function(G){var $=G;('scrolled'===G||'scrolled-doc'===G||'scrolled-continuous'===G)&&($='scrolled'),('auto'===G||'paginated'===G)&&($='paginated'),this.settings.flow=G,this._layout&&this._layout.flow($),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow($),this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}},{key:'layout',value:function(G){return G&&(this._layout=new W.default(G),this._layout.spread(G.spread,this.settings.minSpreadWidth),this.mapping=new F.default(this._layout.props)),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}},{key:'spread',value:function(G,$){this._layout.spread(G,$),this.manager.isRendered()&&this.manager.updateLayout()}},{key:'reportLocation',value:function(){return this.q.enqueue(function(){var $=this.manager.currentLocation();if($&&$.then&&'function'==typeof $.then)$.then(function(te){var ne=this.located(te);ne&&ne.start&&ne.end&&(this.location=ne,this.emit('locationChanged',{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit('relocated',this.location))}.bind(this));else if($){var ee=this.located($);if(!ee||!ee.start||!ee.end)return;this.location=ee,this.emit('locationChanged',{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit('relocated',this.location)}}.bind(this))}},{key:'currentLocation',value:function(){var G=this.manager.currentLocation();if(G&&G.then&&'function'==typeof G.then)G.then(function(ee){var te=this.located(ee);return te}.bind(this));else if(G){var $=this.located(G);return $}}},{key:'located',value:function(G){if(!G.length)return{};var $=G[0],ee=G[G.length-1],K={start:{index:$.index,href:$.href,cfi:$.mapping.start,displayed:{page:$.pages[0]||1,total:$.totalPages}},end:{index:ee.index,href:ee.href,cfi:ee.mapping.end,displayed:{page:ee.pages[ee.pages.length-1]||1,total:ee.totalPages}}},te=this.book.locations.locationFromCfi($.mapping.start),ne=this.book.locations.locationFromCfi(ee.mapping.end);null!=te&&(K.start.location=te,K.start.percentage=this.book.locations.percentageFromLocation(te)),null!=ne&&(K.end.location=ne,K.end.percentage=this.book.locations.percentageFromLocation(ne));var ae=this.book.pageList.pageFromCfi($.mapping.start),ie=this.book.pageList.pageFromCfi(ee.mapping.end);return-1!=ae&&(K.start.page=ae),-1!=ie&&(K.end.page=ie),ee.index===this.book.spine.last().index&&K.end.displayed.page>=K.end.displayed.total&&(K.atEnd=!0),$.index===this.book.spine.first().index&&1===K.start.displayed.page&&(K.atStart=!0),K}},{key:'destroy',value:function(){this.manager&&this.manager.destroy(),this.book=void 0,this.views=null}},{key:'passEvents',value:function(G){var $=this,ee=X.default.listenedEvents;ee.forEach(function(te){G.on(te,function(ne){return $.triggerViewEvent(ne,G)})}),G.on('selected',function(te){return $.triggerSelectedEvent(te,G)}),G.on('markClicked',function(te,ne){return $.triggerMarkEvent(te,ne,G)})}},{key:'triggerViewEvent',value:function(G,$){this.emit(G.type,G,$)}},{key:'triggerSelectedEvent',value:function(G,$){this.emit('selected',G,$)}},{key:'triggerMarkEvent',value:function(G,$,ee){this.emit('markClicked',G,$,ee)}},{key:'getRange',value:function(G,$){var ee=new B.default(G),te=this.manager.visible().filter(function(ne){if(ee.spinePos===ne.index)return!0});if(te.length)return te[0].contents.range(ee,$)}},{key:'adjustImages',value:function(G){return'pre-paginated'===this._layout.name?new Promise(function($){$()}):(G.addStylesheetRules({img:{\"max-width\":(this._layout.columnWidth?this._layout.columnWidth+'px':'100%')+'!important',\"max-height\":(this._layout.height?0.6*this._layout.height+'px':'60%')+'!important',\"object-fit\":'contain',\"page-break-inside\":'avoid'}}),new Promise(function($){setTimeout(function(){$()},1)}))}},{key:'getContents',value:function(){return this.manager?this.manager.getContents():[]}},{key:'handleLinks',value:function(G){var $=this;G&&G.on('link',function(ee){var te=$.book.path.relative(ee);$.display(te)})}},{key:'injectStylesheet',value:function(G){var ee=G.createElement('link');ee.setAttribute('type','text/css'),ee.setAttribute('rel','stylesheet'),ee.setAttribute('href',this.settings.stylesheet),G.getElementsByTagName('head')[0].appendChild(ee)}},{key:'injectScript',value:function(G){var ee=G.createElement('script');ee.setAttribute('type','text/javascript'),ee.setAttribute('src',this.settings.script),ee.textContent=' ',G.getElementsByTagName('head')[0].appendChild(ee)}},{key:'injectSource',value:function(G){var ee=this.book.package.metadata.identifier,te=G.createElement('meta');te.setAttribute('property','dc:source'),ee&&te.setAttribute('contents',ee),G.getElementsByTagName('head')[0].appendChild(te)}}]),Q}();(0,R.default)(Z.prototype),k.default=Z,v.exports=k['default']},function(v){'use strict';var S={application:{ecmascript:['es','ecma'],javascript:'js',ogg:'ogx',pdf:'pdf',postscript:['ps','ai','eps','epsi','epsf','eps2','eps3'],\"rdf+xml\":'rdf',smil:['smi','smil'],\"xhtml+xml\":['xhtml','xht'],xml:['xml','xsl','xsd','opf','ncx'],zip:'zip',\"x-httpd-eruby\":'rhtml',\"x-latex\":'latex',\"x-maker\":['frm','maker','frame','fm','fb','book','fbdoc'],\"x-object\":'o',\"x-shockwave-flash\":['swf','swfl'],\"x-silverlight\":'scr',\"epub+zip\":'epub',\"font-tdpfr\":'pfr',\"inkml+xml\":['ink','inkml'],json:'json',\"jsonml+json\":'jsonml',\"mathml+xml\":'mathml',\"metalink+xml\":'metalink',mp4:'mp4s',\"omdoc+xml\":'omdoc',oxps:'oxps',\"vnd.amazon.ebook\":'azw',widget:'wgt',\"x-dtbook+xml\":'dtb',\"x-dtbresource+xml\":'res',\"x-font-bdf\":'bdf',\"x-font-ghostscript\":'gsf',\"x-font-linux-psf\":'psf',\"x-font-otf\":'otf',\"x-font-pcf\":'pcf',\"x-font-snf\":'snf',\"x-font-ttf\":['ttf','ttc'],\"x-font-type1\":['pfa','pfb','pfm','afm'],\"x-font-woff\":'woff',\"x-mobipocket-ebook\":['prc','mobi'],\"x-mspublisher\":'pub',\"x-nzb\":'nzb',\"x-tgif\":'obj',\"xaml+xml\":'xaml',\"xml-dtd\":'dtd',\"xproc+xml\":'xpl',\"xslt+xml\":'xslt',\"internet-property-stream\":'acx',\"x-compress\":'z',\"x-compressed\":'tgz',\"x-gzip\":'gz'},audio:{flac:'flac',midi:['mid','midi','kar','rmi'],mpeg:['mpga','mpega','mp2','mp3','m4a','mp2a','m2a','m3a'],mpegurl:'m3u',ogg:['oga','ogg','spx'],\"x-aiff\":['aif','aiff','aifc'],\"x-ms-wma\":'wma',\"x-wav\":'wav',adpcm:'adp',mp4:'mp4a',webm:'weba',\"x-aac\":'aac',\"x-caf\":'caf',\"x-matroska\":'mka',\"x-pn-realaudio-plugin\":'rmp',xm:'xm',mid:['mid','rmi']},image:{gif:'gif',ief:'ief',jpeg:['jpeg','jpg','jpe'],pcx:'pcx',png:'png',\"svg+xml\":['svg','svgz'],tiff:['tiff','tif'],\"x-icon\":'ico',bmp:'bmp',webp:'webp',\"x-pict\":['pic','pct'],\"x-tga\":'tga',\"cis-cod\":'cod'},text:{\"cache-manifest\":['manifest','appcache'],css:'css',csv:'csv',html:['html','htm','shtml','stm'],mathml:'mml',plain:['txt','text','brf','conf','def','list','log','in','bas'],richtext:'rtx',\"tab-separated-values\":'tsv',\"x-bibtex\":'bib'},video:{mpeg:['mpeg','mpg','mpe','m1v','m2v','mp2','mpa','mpv2'],mp4:['mp4','mp4v','mpg4'],quicktime:['qt','mov'],ogg:'ogv',\"vnd.mpegurl\":['mxu','m4u'],\"x-flv\":'flv',\"x-la-asf\":['lsf','lsx'],\"x-mng\":'mng',\"x-ms-asf\":['asf','asx','asr'],\"x-ms-wm\":'wm',\"x-ms-wmv\":'wmv',\"x-ms-wmx\":'wmx',\"x-ms-wvx\":'wvx',\"x-msvideo\":'avi',\"x-sgi-movie\":'movie',\"x-matroska\":['mpv','mkv','mk3d','mks'],\"3gpp2\":'3g2',h261:'h261',h263:'h263',h264:'h264',jpeg:'jpgv',jpm:['jpm','jpgm'],mj2:['mj2','mjp2'],\"vnd.ms-playready.media.pyv\":'pyv',\"vnd.uvvu.mp4\":['uvu','uvvu'],\"vnd.vivo\":'viv',webm:'webm',\"x-f4v\":'f4v',\"x-m4v\":'m4v',\"x-ms-vob\":'vob',\"x-smv\":'smv'}},E=function(){var N={},P,R,T,z;for(P in S)if(S.hasOwnProperty(P))for(R in S[P])if(S[P].hasOwnProperty(R))if(T=S[P][R],'string'==typeof T)N[T]=P+'/'+R;else for(z=0;z<T.length;z++)N[T[z]]=P+'/'+R;return N}();v.exports={lookup:function(P){return P&&E[P.split('.').pop().toLowerCase()]||'text/plain'}}},function(v,k,_){var C=_(17),S=C.Symbol;v.exports=S},function(v,k,_){var C=_(57),S='object'==typeof self&&self&&self.Object===Object&&self,E=C||S||Function('return this')();v.exports=E},function(v){v.exports=function(C){var S=typeof C;return null!=C&&('object'==S||'function'==S)}},function(v){v.exports=s},function(v,k,_){'use strict';(function(C,S){var E,L,P,R='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&'function'==typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?'symbol':typeof T};(function(T,z){T||(T=window||C),'object'===R(S)&&S.exports?S.exports=z(T):(L=[],E=z,P='function'==typeof E?E.apply(k,L):E,!(P!==void 0&&(S.exports=P)))})(void 0,function(T){function z(Z){return void 0!==D[Z]}function N(){M.call(this),this._isInvalid=!0}function O(Z){return''==Z&&N.call(this),Z.toLowerCase()}function B(Z){var Q=Z.charCodeAt(0);return 32<Q&&127>Q&&-1==[34,35,60,62,63,96].indexOf(Q)?Z:encodeURIComponent(Z)}function A(Z){var Q=Z.charCodeAt(0);return 32<Q&&127>Q&&-1==[34,35,60,62,96].indexOf(Q)?Z:encodeURIComponent(Z)}function I(Z,Q,K){function G(he){ie.push(he)}var $=Q||'scheme start',ee=0,te='',ne=!1,ae=!1,ie=[];loop:for(;(Z[ee-1]!=V||0==ee)&&!this._isInvalid;){var se=Z[ee];switch($){case'scheme start':if(se&&X.test(se))te+=se.toLowerCase(),$='scheme';else if(!Q){te='',$='no scheme';continue}else{G('Invalid scheme.');break loop}break;case'scheme':if(se&&Y.test(se))te+=se.toLowerCase();else if(':'==se){if(this._scheme=te,te='',Q)break loop;z(this._scheme)&&(this._isRelative=!0),$='file'==this._scheme?'relative':this._isRelative&&K&&K._scheme==this._scheme?'relative or authority':this._isRelative?'authority first slash':'scheme data'}else if(!Q){te='',ee=0,$='no scheme';continue}else if(V==se)break loop;else{G('Code point not allowed in scheme: '+se);break loop}break;case'scheme data':'?'==se?(this._query='?',$='query'):'#'==se?(this._fragment='#',$='fragment'):V!=se&&'\\t'!=se&&'\\n'!=se&&'\\r'!=se&&(this._schemeData+=B(se));break;case'no scheme':if(!K||!z(K._scheme))G('Missing scheme.'),N.call(this);else{$='relative';continue}break;case'relative or authority':if('/'==se&&'/'==Z[ee+1])$='authority ignore slashes';else{G('Expected /, got: '+se),$='relative';continue}break;case'relative':if(this._isRelative=!0,'file'!=this._scheme&&(this._scheme=K._scheme),V==se){this._host=K._host,this._port=K._port,this._path=K._path.slice(),this._query=K._query,this._username=K._username,this._password=K._password;break loop}else if('/'==se||'\\\\'==se)'\\\\'==se&&G('\\\\ is an invalid code point.'),$='relative slash';else if('?'==se)this._host=K._host,this._port=K._port,this._path=K._path.slice(),this._query='?',this._username=K._username,this._password=K._password,$='query';else if('#'==se)this._host=K._host,this._port=K._port,this._path=K._path.slice(),this._query=K._query,this._fragment='#',this._username=K._username,this._password=K._password,$='fragment';else{var re=Z[ee+1],oe=Z[ee+2];'file'==this._scheme&&X.test(se)&&(':'==re||'|'==re)&&(V==oe||'/'==oe||'\\\\'==oe||'?'==oe||'#'==oe)||(this._host=K._host,this._port=K._port,this._username=K._username,this._password=K._password,this._path=K._path.slice(),this._path.pop()),$='relative path';continue}break;case'relative slash':if('/'==se||'\\\\'==se)'\\\\'==se&&G('\\\\ is an invalid code point.'),$='file'==this._scheme?'file host':'authority ignore slashes';else{'file'!=this._scheme&&(this._host=K._host,this._port=K._port,this._username=K._username,this._password=K._password),$='relative path';continue}break;case'authority first slash':if('/'==se)$='authority second slash';else{G('Expected \\'/\\', got: '+se),$='authority ignore slashes';continue}break;case'authority second slash':if($='authority ignore slashes','/'!=se){G('Expected \\'/\\', got: '+se);continue}break;case'authority ignore slashes':if('/'!=se&&'\\\\'!=se){$='authority';continue}else G('Expected authority, got: '+se);break;case'authority':if('@'==se){ne&&(G('@ already seen.'),te+='%40'),ne=!0;for(var le=0,de;le<te.length;le++){if(de=te[le],'\\t'==de||'\\n'==de||'\\r'==de){G('Invalid whitespace in authority.');continue}if(':'==de&&null===this._password){this._password='';continue}var ue=B(de);null===this._password?this._username+=ue:this._password+=ue}te=''}else if(V==se||'/'==se||'\\\\'==se||'?'==se||'#'==se){ee-=te.length,te='',$='host';continue}else te+=se;break;case'file host':if(V==se||'/'==se||'\\\\'==se||'?'==se||'#'==se){2==te.length&&X.test(te[0])&&(':'==te[1]||'|'==te[1])?$='relative path':0==te.length?$='relative path start':(this._host=O.call(this,te),te='',$='relative path start');continue}else'\\t'==se||'\\n'==se||'\\r'==se?G('Invalid whitespace in file host.'):te+=se;break;case'host':case'hostname':if(':'==se&&!ae){if(this._host=O.call(this,te),te='',$='port','hostname'==Q)break loop;}else if(V==se||'/'==se||'\\\\'==se||'?'==se||'#'==se){if(this._host=O.call(this,te),te='',$='relative path start',Q)break loop;continue}else'\\t'!=se&&'\\n'!=se&&'\\r'!=se?('['==se?ae=!0:']'==se&&(ae=!1),te+=se):G('Invalid code point in host/hostname: '+se);break;case'port':if(/[0-9]/.test(se))te+=se;else if(V==se||'/'==se||'\\\\'==se||'?'==se||'#'==se||Q){if(''!=te){var ce=parseInt(te,10);ce!=D[this._scheme]&&(this._port=ce+''),te=''}if(Q)break loop;$='relative path start';continue}else'\\t'==se||'\\n'==se||'\\r'==se?G('Invalid code point in port: '+se):N.call(this);break;case'relative path start':if('\\\\'==se&&G('\\'\\\\\\' not allowed in path.'),$='relative path','/'!=se&&'\\\\'!=se)continue;break;case'relative path':if(V==se||'/'==se||'\\\\'==se||!Q&&('?'==se||'#'==se)){'\\\\'==se&&G('\\\\ not allowed in relative path.');var pe;(pe=H[te.toLowerCase()])&&(te=pe),'..'==te?(this._path.pop(),'/'!=se&&'\\\\'!=se&&this._path.push('')):'.'==te&&'/'!=se&&'\\\\'!=se?this._path.push(''):'.'!=te&&('file'==this._scheme&&0==this._path.length&&2==te.length&&X.test(te[0])&&'|'==te[1]&&(te=te[0]+':'),this._path.push(te)),te='','?'==se?(this._query='?',$='query'):'#'==se&&(this._fragment='#',$='fragment')}else'\\t'!=se&&'\\n'!=se&&'\\r'!=se&&(te+=B(se));break;case'query':Q||'#'!=se?V!=se&&'\\t'!=se&&'\\n'!=se&&'\\r'!=se&&(this._query+=A(se)):(this._fragment='#',$='fragment');break;case'fragment':V!=se&&'\\t'!=se&&'\\n'!=se&&'\\r'!=se&&(this._fragment+=se);}ee++}}function M(){this._scheme='',this._schemeData='',this._username='',this._password=null,this._host='',this._port='',this._path=[],this._query='',this._fragment='',this._isInvalid=!1,this._isRelative=!1}function W(Z,Q){void 0===Q||Q instanceof W||(Q=new W(Q+'')),this._url=Z,M.call(this);var K=Z.replace(/^[ \\t\\r\\n\\f]+|[ \\t\\r\\n\\f]+$/g,'');I.call(this,K,null,Q)}var U=!1;if(!T.forceJURL)try{var F=new URL('b','http://a');F.pathname='c%20d',U='http://a/c%20d'===F.href}catch(Z){}if(U)return T.URL;var D=Object.create(null);D.ftp=21,D.file=0,D.gopher=70,D.http=80,D.https=443,D.ws=80,D.wss=443;var H=Object.create(null);H['%2e']='.',H['.%2e']='..',H['%2e.']='..',H['%2e%2e']='..';var X=/[a-zA-Z]/,Y=/[a-zA-Z0-9\\+\\-\\.]/,V;W.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var Z='';return(''!=this._username||null!=this._password)&&(Z=this._username+(null==this._password?'':':'+this._password)+'@'),this.protocol+(this._isRelative?'//'+Z+this.host:'')+this.pathname+this._query+this._fragment},set href(Z){M.call(this),I.call(this,Z)},get protocol(){return this._scheme+':'},set protocol(Z){this._isInvalid||I.call(this,Z+':','scheme start')},get host(){return this._isInvalid?'':this._port?this._host+':'+this._port:this._host},set host(Z){this._isInvalid||!this._isRelative||I.call(this,Z,'host')},get hostname(){return this._host},set hostname(Z){this._isInvalid||!this._isRelative||I.call(this,Z,'hostname')},get port(){return this._port},set port(Z){this._isInvalid||!this._isRelative||I.call(this,Z,'port')},get pathname(){return this._isInvalid?'':this._isRelative?'/'+this._path.join('/'):this._schemeData},set pathname(Z){this._isInvalid||!this._isRelative||(this._path=[],I.call(this,Z,'relative path start'))},get search(){return this._isInvalid||!this._query||'?'==this._query?'':this._query},set search(Z){this._isInvalid||!this._isRelative||(this._query='?','?'==Z[0]&&(Z=Z.slice(1)),I.call(this,Z,'query'))},get hash(){return this._isInvalid||!this._fragment||'#'==this._fragment?'':this._fragment},set hash(Z){this._isInvalid||(this._fragment='#','#'==Z[0]&&(Z=Z.slice(1)),I.call(this,Z,'fragment'))},get origin(){var Z;if(this._isInvalid||!this._scheme)return'';switch(this._scheme){case'file':return'file://';case'data':case'javascript':case'mailto':return'null';}return Z=this.host,Z?this._scheme+'://'+Z:''}};var J=T.URL;return J&&(W.createObjectURL=function(){return J.createObjectURL.apply(J,arguments)},W.revokeObjectURL=function(Z){J.revokeObjectURL(Z)}),W})}).call(k,_(8),_(65)(v))},function(v,k,_){'use strict';function C(le){return le&&le.__esModule?le:{default:le}}function S(le,de){if(!(le instanceof de))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(le){return typeof le}:function(le){return le&&'function'==typeof Symbol&&le.constructor===Symbol&&le!==Symbol.prototype?'symbol':typeof le},L=function(){function le(de,ue){for(var ce=0,pe;ce<ue.length;ce++)pe=ue[ce],pe.enumerable=pe.enumerable||!1,pe.configurable=!0,'value'in pe&&(pe.writable=!0),Object.defineProperty(de,pe.key,pe)}return function(de,ue,ce){return ue&&le(de.prototype,ue),ce&&le(de,ce),de}}(),P=_(2),R=C(P),T=_(0),z=_(5),N=C(z),O=_(3),B=C(O),A=_(40),I=C(A),M=_(32),W=C(M),U=_(29),F=C(U),D=_(36),H=C(D),V=_(35),X=C(V),Y=_(38),J=C(Y),Z=_(37),Q=C(Z),K=_(14),G=C(K),$=_(28),ee=C($),te=_(12),ne=C(te),ae=_(1),ie=C(ae),se='META-INF/container.xml',oe=function(){function le(de,ue){var ce=this;S(this,le),'undefined'==typeof ue&&'object'===('undefined'==typeof de?'undefined':E(de))&&(ue=de,de=void 0),this.settings=(0,T.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0}),(0,T.extend)(this.settings,ue),this.opening=new T.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new T.defer,spine:new T.defer,metadata:new T.defer,cover:new T.defer,navigation:new T.defer,pageList:new T.defer,resources:new T.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources]),this.isRendered=!1,this.request=this.settings.requestMethod||ne.default,this.spine=new I.default,this.locations=new W.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=new Q.default,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,this.toc=void 0,de&&this.open(de).catch(function(){var he=new Error('Cannot load book at '+de);ce.emit('openFailed',he)})}return L(le,[{key:'open',value:function(ue,ce){var he=ce||this.determineType(ue),pe;return'binary'===he?(this.archived=!0,this.url=new N.default('/',''),pe=this.openEpub(ue)):'base64'===he?(this.archived=!0,this.url=new N.default('/',''),pe=this.openEpub(ue,he)):'epub'===he?(this.archived=!0,this.url=new N.default('/',''),pe=this.request(ue,'binary').then(this.openEpub.bind(this))):'opf'==he?(this.url=new N.default(ue),pe=this.openPackaging(this.url.Path.toString())):'json'==he?(this.url=new N.default(ue),pe=this.openManifest(this.url.Path.toString())):(this.url=new N.default(ue),pe=this.openContainer(se).then(this.openPackaging.bind(this))),pe}},{key:'openEpub',value:function(ue,ce){var pe=this;return this.unarchive(ue,ce||this.settings.encoding).then(function(){return pe.openContainer(se)}).then(function(he){return pe.openPackaging(he)})}},{key:'openContainer',value:function(ue){var ce=this;return this.load(ue).then(function(pe){return ce.container=new F.default(pe),ce.resolve(ce.container.packagePath)})}},{key:'openPackaging',value:function(ue){var ce=this;return this.path=new B.default(ue),this.load(ue).then(function(pe){return ce.packaging=new H.default(pe),ce.unpack(ce.packaging)})}},{key:'openManifest',value:function(ue){var ce=this;return this.path=new B.default(ue),this.load(ue).then(function(pe){return ce.packaging=new H.default,ce.packaging.load(pe),ce.unpack(ce.packaging)})}},{key:'load',value:function(ue){var ce;return this.archived?(ce=this.resolve(ue),this.archive.request(ce)):(ce=this.resolve(ue),this.request(ce,null,this.settings.requestCredentials,this.settings.requestHeaders))}},{key:'resolve',value:function(ue,ce){if(ue){var pe=ue,he=-1<ue.indexOf('://');return he?ue:(this.path&&(pe=this.path.resolve(ue)),!1!=ce&&this.url&&(pe=this.url.resolve(pe)),pe)}}},{key:'determineType',value:function(ue){var ce,pe,he;return'base64'===this.settings.encoding?'base64':'string'==typeof ue?(ce=new N.default(ue),pe=ce.path(),he=pe.extension,he?'epub'===he?'epub':'opf'===he?'opf':'json'===he?'json':void 0:'directory'):'binary'}},{key:'unpack',value:function(ue){var ce=this;this.package=ue,this.spine.unpack(this.package,this.resolve.bind(this)),this.resources=new J.default(this.package.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||'base64'}),this.loadNavigation(this.package).then(function(){ce.toc=ce.navigation.toc,ce.loading.navigation.resolve(ce.navigation)}),this.package.coverPath&&(this.cover=this.resolve(this.package.coverPath)),this.loading.manifest.resolve(this.package.manifest),this.loading.metadata.resolve(this.package.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&'none'!=this.settings.replacements?this.replacements().then(function(){ce.opening.resolve(ce)}).catch(function(pe){console.error(pe)}):this.opening.resolve(this)}},{key:'loadNavigation',value:function(ue){var ce=this,pe=ue.navPath||ue.ncxPath,he=ue.toc;return he?new Promise(function(fe){ce.navigation=new X.default(he),ce.pageList=new Q.default,fe(ce.navigation)}):pe?this.load(pe,'xml').then(function(fe){return ce.navigation=new X.default(fe),ce.pageList=new Q.default(fe),ce.navigation}):new Promise(function(fe){ce.navigation=new X.default,ce.pageList=new Q.default,fe(ce.navigation)})}},{key:'section',value:function(ue){return this.spine.get(ue)}},{key:'renderTo',value:function(ue,ce){return this.rendition=new G.default(this,ce),this.rendition.attachTo(ue),this.rendition}},{key:'setRequestCredentials',value:function(ue){this.settings.requestCredentials=ue}},{key:'setRequestHeaders',value:function(ue){this.settings.requestHeaders=ue}},{key:'unarchive',value:function(ue,ce){return this.archive=new ee.default,this.archive.open(ue,ce)}},{key:'coverUrl',value:function(){var ue=this,ce=this.loaded.cover.then(function(){return ue.archived?ue.resources.get(ue.cover):ue.cover});return ce}},{key:'replacements',value:function(){var ue=this;return this.spine.hooks.serialize.register(function(ce,pe){pe.output=ue.resources.substitute(ce,pe.url)}),this.resources.replacements().then(function(){return ue.resources.replaceCss()})}},{key:'getRange',value:function(ue){var ce=new ie.default(ue),pe=this.spine.get(ce.spinePos),he=this.load.bind(this);return pe.load(he).then(function(){var ge=ce.toRange(pe.document);return ge})}},{key:'key',value:function(ue){var ce=ue||this.package.metadata.identifier||this.url.filename;return'epubjs:'+'0.3'+':'+ce}},{key:'destroy',value:function(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.toc=void 0}}]),le}();(0,R.default)(oe.prototype),k.default=oe,v.exports=k['default']},function(v,k,_){'use strict';function C(A){return A&&A.__esModule?A:{default:A}}function S(A,I){if(!(A instanceof I))throw new TypeError('Cannot call a class as a function')}function E(A,I){if(!A)throw new ReferenceError('this hasn\\'t been initialised - super() hasn\\'t been called');return I&&('object'==typeof I||'function'==typeof I)?I:A}function L(A,I){if('function'!=typeof I&&null!==I)throw new TypeError('Super expression must either be null or a function, not '+typeof I);A.prototype=Object.create(I&&I.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),I&&(Object.setPrototypeOf?Object.setPrototypeOf(A,I):A.__proto__=I)}Object.defineProperty(k,'__esModule',{value:!0});var P=function(){function A(I,M){for(var W=0,U;W<M.length;W++)U=M[W],U.enumerable=U.enumerable||!1,U.configurable=!0,'value'in U&&(U.writable=!0),Object.defineProperty(I,U.key,U)}return function(I,M,W){return M&&A(I.prototype,M),W&&A(I,W),I}}(),R=_(0),T=_(13),z=C(T),N=_(60),O=C(N),B=function(A){function I(M){S(this,I);var W=E(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,M));return W.name='continuous',W.settings=(0,R.extend)(W.settings||{},{infinite:!0,overflow:void 0,axis:'vertical',offset:500,offsetDelta:250,width:void 0,height:void 0}),(0,R.extend)(W.settings,M.settings||{}),'undefined'!=M.settings.gap&&0===M.settings.gap&&(W.settings.gap=M.settings.gap),W.viewSettings={ignoreClass:W.settings.ignoreClass,axis:W.settings.axis,layout:W.layout,width:0,height:0},W.scrollTop=0,W.scrollLeft=0,W}return L(I,A),P(I,[{key:'display',value:function(W,U){return z.default.prototype.display.call(this,W,U).then(function(){return this.fill()}.bind(this))}},{key:'fill',value:function(W){var U=this,F=W||new R.defer;return this.q.enqueue(function(){return U.check()}).then(function(D){D?U.fill(F):F.resolve()}),F.promise}},{key:'moveTo',value:function(W){var U=0,F=0,D=0,H=0;'vertical'===this.settings.axis?(F=W.top,H=W.top+this.settings.offset):(U=Math.floor(W.left/this.layout.delta)*this.layout.delta,D=U+this.settings.offset),this.check(D,H),this.scrollBy(U,F,!0)}},{key:'onResized',value:function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.resize()}.bind(this),150)}},{key:'afterResized',value:function(W){this.emit('resize',W.section)}},{key:'removeShownListeners',value:function(W){W.onDisplayed=function(){}}},{key:'add',value:function(W){var U=this.createView(W);return this.views.append(U),U.on('resized',function(){U.expanded=!0}),U.onDisplayed=this.afterDisplayed.bind(this),U.onResize=this.afterResized.bind(this),U.display(this.request)}},{key:'append',value:function(W){var U=this.createView(W);return U.on('resized',function(){U.expanded=!0}),this.views.append(U),U.onDisplayed=this.afterDisplayed.bind(this),U}},{key:'prepend',value:function(W){var U=this,F=this.createView(W);return F.on('resized',function(D){U.counter(D),F.expanded=!0}),this.views.prepend(F),F.onDisplayed=this.afterDisplayed.bind(this),F}},{key:'counter',value:function(W){'vertical'===this.settings.axis?this.scrollBy(0,W.heightDelta,!0):this.scrollBy(W.widthDelta,0,!0)}},{key:'update',value:function(W){for(var U=this.bounds(),F=this.views.all(),D=F.length,H=[],V='undefined'==typeof W?this.settings.offset||0:W,J=new R.defer,Z=[],Q=0,X,Y;Q<D;Q++)Y=F[Q],X=this.isVisible(Y,V,V,U),!0===X?(Y.displayed?Y.show():Z.push(Y.display(this.request).then(function(K){K.show()})),H.push(Y)):(clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250));return Z.length?Promise.all(Z):(J.resolve(),J.promise)}},{key:'check',value:function(W,U){var F=this,Y=new R.defer,J=[],Z='horizontal'===this.settings.axis,Q=this.settings.offset||0,D,H,V,X;W&&Z&&(Q=W),U&&!Z&&(Q=U);var K=this._bounds,G=Z?this.scrollLeft:this.scrollTop,$=Z?K.width:K.height,ee=Z?this.container.scrollWidth:this.container.scrollHeight;G+$+Q>=ee&&(D=this.views.last(),V=D&&D.section.next(),V&&J.push(this.append(V))),0>G-Q&&(H=this.views.first(),X=H&&H.section.prev(),X&&J.push(this.prepend(X)));var te=J.map(function(ne){return ne.displayed});return J.length?Promise.all(te).then(function(){return F.update(Q)}):(this.q.enqueue(function(){this.update()}.bind(this)),Y.resolve(!1),Y.promise)}},{key:'trim',value:function(){for(var W=new R.defer,U=this.views.displayed(),F=U[0],D=U[U.length-1],H=this.views.indexOf(F),V=this.views.indexOf(D),X=this.views.slice(0,H),Y=this.views.slice(V+1),J=0;J<X.length-1;J++)this.erase(X[J],X);for(var Z=1;Z<Y.length;Z++)this.erase(Y[Z]);return W.resolve(),W.promise}},{key:'erase',value:function(W,U){var F,D;this.settings.height?(F=this.container.scrollTop,D=this.container.scrollLeft):(F=window.scrollY,D=window.scrollX);var H=W.bounds();W.destroy.bind(W),this.views.remove(W),U&&('vertical'===this.settings.axis?this.scrollTo(0,F-H.height,!0):this.scrollTo(D-H.width,0,!0))}},{key:'addEventListeners',value:function(){window.addEventListener('unload',function(){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners()}},{key:'addScrollListeners',value:function(){var W;this.tick=R.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.height?(W=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft):(W=window,this.scrollTop=window.scrollY,this.scrollLeft=window.scrollX),W.addEventListener('scroll',this.onScroll.bind(this)),this._scrolled=(0,O.default)(this.scrolled.bind(this),300),this.scrolled=!1}},{key:'removeEventListeners',value:function(){var W;W=this.settings.height?this.container:window,W.removeEventListener('scroll',this.onScroll.bind(this))}},{key:'onScroll',value:function(){var W,U;this.settings.height?(W=this.container.scrollTop,U=this.container.scrollLeft):(W=window.scrollY,U=window.scrollX),this.scrollTop=W,this.scrollLeft=U,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=Math.abs(W-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(U-this.prevScrollLeft),this.prevScrollTop=W,this.prevScrollLeft=U,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.scrolled=!1}},{key:'scrolled',value:function(){this.q.enqueue(function(){this.check()}.bind(this)),this.emit('scroll',{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit('scrolled',{top:this.scrollTop,left:this.scrollLeft})}.bind(this))}},{key:'next',value:function(){'horizontal'===this.settings.axis?(this.scrollLeft=this.container.scrollLeft,this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this))}},{key:'prev',value:function(){'horizontal'===this.settings.axis?this.scrollBy(-this.layout.delta,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this))}},{key:'updateFlow',value:function(W){var U='paginated'===W?'horizontal':'vertical';this.settings.axis=U,this.stage&&this.stage.axis(U),this.viewSettings.axis=U,this.overflow=this.settings.overflow?this.settings.overflow:'paginated'===W?'hidden':'auto',this.settings.infinite='vertical'===this.settings.axis,this.updateLayout()}}]),I}(z.default);k.default=B,v.exports=k['default']},function(v,k,_){'use strict';function C(A){return A&&A.__esModule?A:{default:A}}function S(A,I){if(!(A instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function A(I,M){for(var W=0,U;W<M.length;W++)U=M[W],U.enumerable=U.enumerable||!1,U.configurable=!0,'value'in U&&(U.writable=!0),Object.defineProperty(I,U.key,U)}return function(I,M,W){return M&&A(I.prototype,M),W&&A(I,W),I}}(),L=_(2),P=C(L),R=_(0),T=_(1),z=C(T),N=_(7),O=C(N),B=function(){function A(I,M){S(this,A),this.settings=(0,R.extend)({ignoreClass:'',axis:'vertical',width:0,height:0,layout:void 0,globalLayoutProperties:{}},M||{}),this.id='epubjs-view-'+(0,R.uuid)(),this.section=I,this.index=I.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new z.default,this.layout=this.settings.layout}return E(A,[{key:'container',value:function(M){var W=document.createElement('div');return W.classList.add('epub-view'),W.style.height='0px',W.style.width='0px',W.style.overflow='hidden',M&&'horizontal'==M?(W.style.display='block',W.style.flex='none'):W.style.display='block',W}},{key:'create',value:function(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement('iframe'),this.iframe.id=this.id,this.iframe.scrolling='no',this.iframe.style.overflow='hidden',this.iframe.seamless='seamless',this.iframe.style.border='none',this.resizing=!0,this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.iframe.style.width='0',this.iframe.style.height='0',this._width=0,this._height=0,this.element.setAttribute('ref',this.index),this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=(0,R.bounds)(this.element),this.supportsSrcdoc=!!('srcdoc'in this.iframe),this.iframe)}},{key:'render',value:function(M){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(M)),this.sectionRender.then(function(U){return this.load(U)}.bind(this)).then(function(){var U=this;return this.settings.layout.format(this.contents),this.addListeners(),new Promise(function(F){setTimeout(function(){U.expand(),F()},1)})}.bind(this)).then(function(){this.emit('rendered',this.section)}.bind(this)).catch(function(U){this.emit('loaderror',U)}.bind(this))}},{key:'reset',value:function(){this.iframe&&(this.iframe.style.width='0',this.iframe.style.height='0',this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}},{key:'size',value:function(M,W){var U=M||this.settings.width,F=W||this.settings.height;'pre-paginated'===this.layout.name?this.lock('both',U,F):'horizontal'===this.settings.axis?this.lock('height',U,F):this.lock('width',U,F)}},{key:'lock',value:function(M,W,U){var F=(0,R.borders)(this.element),D;D=this.iframe?(0,R.borders)(this.iframe):{width:0,height:0},'width'==M&&(0,R.isNumber)(W)&&(this.lockedWidth=W-F.width-D.width),'height'==M&&(0,R.isNumber)(U)&&(this.lockedHeight=U-F.height-D.height),'both'===M&&(0,R.isNumber)(W)&&(0,R.isNumber)(U)&&(this.lockedWidth=W-F.width-D.width,this.lockedHeight=U-F.height-D.height),this.displayed&&this.iframe&&this.expand()}},{key:'expand',value:function(){var W=this.lockedWidth,U=this.lockedHeight,D,H;!this.iframe||this._expanding||'pre-paginated'===this.layout.name||(this._expanding=!0,'horizontal'===this.settings.axis?(D=this.contents.textWidth(),W=this.contentWidth(D),W==this._width?W=this._contentWidth:(0<W%this.layout.width&&(W+=this.layout.gap/2),this._textWidth=D,this._contentWidth=W)):'vertical'===this.settings.axis&&(H=this.contents.textHeight(),H==this._textHeight?U=this._contentHeight:(U=this.contentHeight(H),this._textHeight=H,this._contentHeight=U)),(this._needsReframe||W!=this._width||U!=this._height)&&this.resize(W,U),this._expanding=!1)}},{key:'contentWidth',value:function(M){var W,U;return W=this.iframe.style.width,this.iframe.style.width=(M||0)+'px',U=this.contents.scrollWidth(),this.iframe.style.width=W,U}},{key:'contentHeight',value:function(M){var W,U;return W=this.iframe.style.height,this.iframe.style.height=(M||0)+'px',U=this.contents.scrollHeight(),this.iframe.style.height=W,U}},{key:'resize',value:function(M,W){this.iframe&&((0,R.isNumber)(M)&&(this.iframe.style.width=M+'px',this._width=M),(0,R.isNumber)(W)&&(this.iframe.style.height=W+'px',this._height=W),this.iframeBounds=(0,R.bounds)(this.iframe),this.reframe(this.iframeBounds.width,this.iframeBounds.height))}},{key:'reframe',value:function(M,W){var U;(0,R.isNumber)(M)&&(this.element.style.width=M+'px'),(0,R.isNumber)(W)&&(this.element.style.height=W+'px'),this.elementBounds=(0,R.bounds)(this.element);var F=this.prevBounds?this.elementBounds.width-this.prevBounds.width:this.elementBounds.width,D=this.prevBounds?this.elementBounds.height-this.prevBounds.height:this.elementBounds.height;U={width:this.elementBounds.width,height:this.elementBounds.height,widthDelta:F,heightDelta:D},this.onResize(this,U),this.contents&&this.settings.layout.format(this.contents),this.emit('resized',U),this.prevBounds=this.elementBounds}},{key:'load',value:function(M){var W=new R.defer,U=W.promise;if(!this.iframe)return W.reject(new Error('No Iframe Available')),U;if(this.iframe.onload=function(F){this.onLoad(F,W)}.bind(this),this.supportsSrcdoc)this.iframe.srcdoc=M;else{if(this.document=this.iframe.contentDocument,!this.document)return W.reject(new Error('No Document Available')),U;this.iframe.contentDocument.open(),this.iframe.contentDocument.write(M),this.iframe.contentDocument.close()}return U}},{key:'onLoad',value:function(M,W){var U=this;this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new O.default(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var F=this.document.querySelector('link[rel=\\'canonical\\']');F?F.setAttribute('href',this.section.url):(F=this.document.createElement('link'),F.setAttribute('rel','canonical'),F.setAttribute('href',this.section.url),this.document.querySelector('head').appendChild(F)),this.contents.on('expand',function(){U.displayed&&U.iframe&&U.expand()}),this.contents.on('resize',function(){U.displayed&&U.iframe&&U.expand()}),W.resolve(this.contents)}},{key:'setLayout',value:function(M){this.layout=M}},{key:'setAxis',value:function(M){this.settings.axis=M}},{key:'resizeListenters',value:function(){clearTimeout(this.expanding),this.expanding=setTimeout(this.expand.bind(this),350)}},{key:'addListeners',value:function(){}},{key:'removeListeners',value:function(){}},{key:'display',value:function(M){var W=new R.defer;return this.displayed?W.resolve(this):this.render(M).then(function(){this.emit('displayed',this),this.onDisplayed(this),this.displayed=!0,W.resolve(this)}.bind(this)),W.promise}},{key:'show',value:function(){this.element.style.visibility='visible',this.iframe&&(this.iframe.style.visibility='visible'),this.emit('shown',this)}},{key:'hide',value:function(){this.element.style.visibility='hidden',this.iframe.style.visibility='hidden',this.stopExpanding=!0,this.emit('hidden',this)}},{key:'offset',value:function(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}},{key:'width',value:function(){return this._width}},{key:'height',value:function(){return this._height}},{key:'position',value:function(){return this.element.getBoundingClientRect()}},{key:'locationOf',value:function(M){var W=this.iframe.getBoundingClientRect(),U=this.contents.locationOf(M,this.settings.ignoreClass);return{left:U.left,top:U.top}}},{key:'onDisplayed',value:function(){}},{key:'onResize',value:function(){}},{key:'bounds',value:function(){return this.elementBounds||(this.elementBounds=(0,R.bounds)(this.element)),this.elementBounds}},{key:'destroy',value:function(){this.displayed&&(this.displayed=!1,this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.displayed=!1,this.iframe=null,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}]),A}();(0,P.default)(B.prototype),k.default=B,v.exports=k['default']},function(v,k){'use strict';function C(L,P){function R(O){for(var B=P.length-1,A;0<=B;B--)if(A=P[B],!!E(A,O.clientX,O.clientY)){A.dispatchEvent(S(O));break}}for(var T=['mouseup','mousedown','click'],z=0,N;z<T.length;z++)N=T[z],L.addEventListener(N,function(O){return R(O)},!1)}function S(L){var P=Object.assign({},L,{bubbles:!1});try{return new MouseEvent(L.type,P)}catch(T){var R=document.createEvent('MouseEvents');return R.initMouseEvent(L.type,!1,P.cancelable,P.view,P.detail,P.screenX,P.screenY,P.clientX,P.clientY,P.ctrlKey,P.altKey,P.shiftKey,P.metaKey,P.button,P.relatedTarget),R}}function E(L,P,R){function T(A,I,M){var W=A.top+A.height,U=A.left+A.width;return A.top<=M&&A.left<=I&&W>M&&U>I}var z=L.getBoundingClientRect();if(!T(z,P,R))return!1;for(var N=L.getClientRects(),O=0,B=N.length;O<B;O++)if(T(N[O],P,R))return!0;return!1}Object.defineProperty(k,'__esModule',{value:!0}),k.proxyMouse=C,k.clone=S,k.default={proxyMouse:C}},function(v,k,_){'use strict';function C(D){return D&&D.__esModule?D:{default:D}}function S(D,H){if(!D)throw new ReferenceError('this hasn\\'t been initialised - super() hasn\\'t been called');return H&&('object'==typeof H||'function'==typeof H)?H:D}function E(D,H){if('function'!=typeof H&&null!==H)throw new TypeError('Super expression must either be null or a function, not '+typeof H);D.prototype=Object.create(H&&H.prototype,{constructor:{value:D,enumerable:!1,writable:!0,configurable:!0}}),H&&(Object.setPrototypeOf?Object.setPrototypeOf(D,H):D.__proto__=H)}function L(D,H){if(!(D instanceof H))throw new TypeError('Cannot call a class as a function')}function P(D){var H=D.getBoundingClientRect();return{top:H.top+D.ownerDocument.body.scrollTop,left:H.left+D.ownerDocument.body.scrollLeft,height:H.height+D.scrollHeight,width:H.width+D.scrollWidth}}function R(D,H){D.style.top=H.top+'px',D.style.left=H.left+'px',D.style.height='100%',D.style.width='100%'}function T(D,H){return H.right<=D.right&&H.left>=D.left&&H.top>=D.top&&H.bottom<=D.bottom}Object.defineProperty(k,'__esModule',{value:!0}),k.Underline=k.Highlight=k.Mark=k.Pane=void 0;var z=function D(H,V,X){null===H&&(H=Function.prototype);var Y=Object.getOwnPropertyDescriptor(H,V);if(Y===void 0){var J=Object.getPrototypeOf(H);return null===J?void 0:D(J,V,X)}if('value'in Y)return Y.value;var Z=Y.get;return void 0===Z?void 0:Z.call(X)},N=function(){function D(H,V){for(var X=0,Y;X<V.length;X++)Y=V[X],Y.enumerable=Y.enumerable||!1,Y.configurable=!0,'value'in Y&&(Y.writable=!0),Object.defineProperty(H,Y.key,Y)}return function(H,V,X){return V&&D(H.prototype,V),X&&D(H,X),H}}(),O=_(26),B=C(O),A=_(24),I=C(A),M=k.Pane=function(){function D(H){var V=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body;L(this,D),this.target=H,this.element=B.default.createElement('svg'),this.marks=[],this.element.style.position='absolute',this.element.setAttribute('pointer-events','none'),I.default.proxyMouse(this.target,this.marks),V.appendChild(this.element),this.render()}return N(D,[{key:'addMark',value:function(V){var X=B.default.createElement('g');return this.element.appendChild(X),V.bind(X),this.marks.push(V),V.render(),V}},{key:'removeMark',value:function(V){var X=this.marks.indexOf(V);if(-1!==X){var Y=V.unbind();this.element.removeChild(Y),this.marks.splice(X,1)}}},{key:'render',value:function(){R(this.element,P(this.target));var V=!0,X=!1,Y;try{for(var J=this.marks[Symbol.iterator](),Z,Q;!(V=(Z=J.next()).done);V=!0)Q=Z.value,Q.render()}catch(K){X=!0,Y=K}finally{try{!V&&J.return&&J.return()}finally{if(X)throw Y}}}}]),D}(),W=k.Mark=function(){function D(){L(this,D),this.element=null}return N(D,[{key:'bind',value:function(V){this.element=V}},{key:'unbind',value:function(){var V=this.element;return this.element=null,V}},{key:'render',value:function(){}},{key:'dispatchEvent',value:function(V){this.element&&this.element.dispatchEvent(V)}},{key:'getBoundingClientRect',value:function(){return this.element.getBoundingClientRect()}},{key:'getClientRects',value:function(){for(var V=[],X=this.element.firstChild;X;)V.push(X.getBoundingClientRect()),X=X.nextSibling;return V}},{key:'filteredRanges',value:function(){var V=Array.from(this.range.getClientRects());return V.filter(function(X){for(var Y=0;Y<V.length;Y++){if(V[Y]===X)return!0;var J=T(V[Y],X);if(J)return!1}return!0})}}]),D}(),U=k.Highlight=function(D){function H(V,X,Y,J){L(this,H);var Z=S(this,(H.__proto__||Object.getPrototypeOf(H)).call(this));return Z.range=V,Z.className=X,Z.data=Y||{},Z.attributes=J||{},Z}return E(H,D),N(H,[{key:'bind',value:function(X){for(var Y in z(H.prototype.__proto__||Object.getPrototypeOf(H.prototype),'bind',this).call(this,X),this.data)this.data.hasOwnProperty(Y)&&(this.element.dataset[Y]=this.data[Y]);for(var Y in this.attributes)this.attributes.hasOwnProperty(Y)&&this.element.setAttribute(Y,this.attributes[Y]);this.className&&this.element.classList.add(this.className)}},{key:'render',value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var X=this.element.ownerDocument.createDocumentFragment(),Y=this.filteredRanges(),J=this.element.getBoundingClientRect(),Z=0,Q=Y.length;Z<Q;Z++){var K=Y[Z],G=B.default.createElement('rect');G.setAttribute('x',K.left-J.left),G.setAttribute('y',K.top-J.top),G.setAttribute('height',K.height),G.setAttribute('width',K.width),X.appendChild(G)}this.element.appendChild(X)}}]),H}(W),F=k.Underline=function(D){function H(V,X,Y,J){return L(this,H),S(this,(H.__proto__||Object.getPrototypeOf(H)).call(this,V,X,Y,J))}return E(H,D),N(H,[{key:'render',value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var X=this.element.ownerDocument.createDocumentFragment(),Y=this.filteredRanges(),J=this.element.getBoundingClientRect(),Z=0,Q=Y.length;Z<Q;Z++){var K=Y[Z],G=B.default.createElement('rect');G.setAttribute('x',K.left-J.left),G.setAttribute('y',K.top-J.top),G.setAttribute('height',K.height),G.setAttribute('width',K.width),G.setAttribute('fill','none');var $=B.default.createElement('line');$.setAttribute('x1',K.left-J.left),$.setAttribute('x2',K.left-J.left+K.width),$.setAttribute('y1',K.top-J.top+K.height-1),$.setAttribute('y2',K.top-J.top+K.height-1),$.setAttribute('stroke-width',1),$.setAttribute('stroke','black'),$.setAttribute('stroke-linecap','square'),X.appendChild(G),X.appendChild($)}this.element.appendChild(X)}}]),H}(U)},function(v,k){'use strict';function C(S){return document.createElementNS('http://www.w3.org/2000/svg',S)}Object.defineProperty(k,'__esModule',{value:!0}),k.createElement=C,k.default={createElement:C}},function(v,k,_){'use strict';function C(O){return O&&O.__esModule?O:{default:O}}function S(O,B){if(!(O instanceof B))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function O(B,A){for(var I=0,M;I<A.length;I++)M=A[I],M.enumerable=M.enumerable||!1,M.configurable=!0,'value'in M&&(M.writable=!0),Object.defineProperty(B,M.key,M)}return function(B,A,I){return A&&O(B.prototype,A),I&&O(B,I),B}}(),L=_(2),P=C(L),R=_(1),T=C(R),z=function(){function O(B){S(this,O),this.rendition=B,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}return E(O,[{key:'add',value:function(A,I,M,W){var U=encodeURI(I),F=new T.default(I),D=F.spinePos,H=new N({type:A,cfiRange:I,data:M,sectionIndex:D,cb:W});this._annotations[U]=H,D in this._annotationsBySectionIndex?this._annotationsBySectionIndex[D].push(U):this._annotationsBySectionIndex[D]=[U];var V=this.rendition.getContents();return V.forEach(function(X){H.sectionIndex===X.sectionIndex&&H.attach(X)}),H}},{key:'remove',value:function(A){var M=encodeURI(A);if(M in this._annotations){var W=this._annotations[M],U=this.rendition.getContents();U.forEach(function(F){W.sectionIndex===F.sectionIndex&&W.detach(F)}),delete this._annotations[M]}}},{key:'highlight',value:function(A,I,M){this.add('highlight',A,I,M)}},{key:'underline',value:function(A,I,M){this.add('underline',A,I,M)}},{key:'mark',value:function(A,I,M){this.add('mark',A,I,M)}},{key:'each',value:function(){return this._annotations.forEach.apply(this._annotations,arguments)}},{key:'inject',value:function(A){var I=this,M=A.index;if(M in this._annotationsBySectionIndex){var W=this._annotationsBySectionIndex[M];W.forEach(function(U){var F=I._annotations[U];F.attach(A)})}}},{key:'clear',value:function(A){var I=this,M=A.index;if(M in this._annotationsBySectionIndex){var W=this._annotationsBySectionIndex[M];W.forEach(function(U){var F=I._annotations[U];F.detach(A)})}}},{key:'show',value:function(){}},{key:'hide',value:function(){}}]),O}(),N=function(){function O(B){var A=B.type,I=B.cfiRange,M=B.data,W=B.sectionIndex;S(this,O),this.type=A,this.cfiRange=I,this.data=M,this.sectionIndex=W,this.mark=void 0}return E(O,[{key:'update',value:function(A){this.data=A}},{key:'attach',value:function(A){var I=this.cfiRange,M=this.data,W=this.type,U=this.mark,F=this.cb,D;return'highlight'===W?D=A.highlight(I,M,F):'underline'===W?D=A.underline(I,M,F):'mark'===W&&(D=A.mark(I,M,F)),this.mark=D,D}},{key:'detach',value:function(A){var I=this.cfiRange,M=this.type,W;return A&&('highlight'===M?W=A.unhighlight(I):'underline'===M?W=A.ununderline(I):'mark'===M&&(W=A.unmark(I))),this.mark=void 0,W}},{key:'text',value:function(){}}]),O}();(0,P.default)(N.prototype),k.default=z,v.exports=k['default']},function(v,k,_){'use strict';function C(A){return A&&A.__esModule?A:{default:A}}function S(A,I){if(!(A instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function A(I,M){for(var W=0,U;W<M.length;W++)U=M[W],U.enumerable=U.enumerable||!1,U.configurable=!0,'value'in U&&(U.writable=!0),Object.defineProperty(I,U.key,U)}return function(I,M,W){return M&&A(I.prototype,M),W&&A(I,W),I}}(),L=_(0),P=_(12),R=C(P),T=_(15),z=C(T),N=_(3),O=C(N),B=function(){function A(){S(this,A),this.zip=void 0,this.urlCache={},this.checkRequirements()}return E(A,[{key:'checkRequirements',value:function(){try{if('undefined'==typeof JSZip){var M=_(66);this.zip=new M}else this.zip=new JSZip}catch(W){throw new Error('JSZip lib not loaded')}}},{key:'open',value:function(M,W){return this.zip.loadAsync(M,{base64:W})}},{key:'openUrl',value:function(M,W){return(0,R.default)(M,'binary').then(function(U){return this.zip.loadAsync(U,{base64:W})}.bind(this))}},{key:'request',value:function(M,W){var U=new L.defer,D=new O.default(M),F;return W||(W=D.extension),F='blob'==W?this.getBlob(M):this.getText(M),F?F.then(function(H){var V=this.handleResponse(H,W);U.resolve(V)}.bind(this)):U.reject({message:'File not found in the epub: '+M,stack:new Error().stack}),U.promise}},{key:'handleResponse',value:function(M,W){var U;return U='json'==W?JSON.parse(M):(0,L.isXml)(W)?(0,L.parse)(M,'text/xml'):'xhtml'==W?(0,L.parse)(M,'application/xhtml+xml'):'html'==W||'htm'==W?(0,L.parse)(M,'text/html'):M,U}},{key:'getBlob',value:function(M,W){var U=window.decodeURIComponent(M.substr(1)),F=this.zip.file(U);if(F)return W=W||z.default.lookup(F.name),F.async('uint8array').then(function(D){return new Blob([D],{type:W})})}},{key:'getText',value:function(M){var U=window.decodeURIComponent(M.substr(1)),F=this.zip.file(U);if(F)return F.async('string').then(function(D){return D})}},{key:'getBase64',value:function(M,W){var U=window.decodeURIComponent(M.substr(1)),F=this.zip.file(U);if(F)return W=W||z.default.lookup(F.name),F.async('base64').then(function(D){return'data:'+W+';base64,'+D})}},{key:'createUrl',value:function(M,W){var U=new L.defer,F=window.URL||window.webkitURL||window.mozURL,V=W&&W.base64,D,H;return M in this.urlCache?(U.resolve(this.urlCache[M]),U.promise):(V?(H=this.getBase64(M),H&&H.then(function(X){this.urlCache[M]=X,U.resolve(X)}.bind(this))):(H=this.getBlob(M),H&&H.then(function(X){D=F.createObjectURL(X),this.urlCache[M]=D,U.resolve(D)}.bind(this))),H||U.reject({message:'File not found in the epub: '+M,stack:new Error().stack}),U.promise)}},{key:'revokeUrl',value:function(M){var W=window.URL||window.webkitURL||window.mozURL,U=this.urlCache[M];U&&W.revokeObjectURL(U)}},{key:'destroy',value:function(){var M=window.URL||window.webkitURL||window.mozURL;for(var W in this.urlCache)M.revokeObjectURL(W);this.zip=void 0,this.urlCache={}}}]),A}();k.default=B,v.exports=k['default']},function(v,k,_){'use strict';function S(z,N){if(!(z instanceof N))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function z(N,O){for(var B=0,A;B<O.length;B++)A=O[B],A.enumerable=A.enumerable||!1,A.configurable=!0,'value'in A&&(A.writable=!0),Object.defineProperty(N,A.key,A)}return function(N,O,B){return O&&z(N.prototype,O),B&&z(N,B),N}}(),L=_(6),P=function(z){return z&&z.__esModule?z:{default:z}}(L),R=_(0),T=function(){function z(N){S(this,z),this.packagePath='',this.directory='',this.encoding='',N&&this.parse(N)}return E(z,[{key:'parse',value:function(O){var B;if(!O)throw new Error('Container File Not Found');if(B=(0,R.qs)(O,'rootfile'),!B)throw new Error('No RootFile Found');this.packagePath=B.getAttribute('full-path'),this.directory=P.default.dirname(this.packagePath),this.encoding=O.xmlEncoding}},{key:'destroy',value:function(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}]),z}();k.default=T,v.exports=k['default']},function(v,k,_){'use strict';(function(C){function E(W){return W&&W.__esModule?W:{default:W}}function L(W,U){return new R.default(W,U)}Object.defineProperty(k,'__esModule',{value:!0});var P=_(21),R=E(P),T=_(1),z=E(T),N=_(14),O=E(N),B=_(7),A=E(B),I=_(0),M=function(W){if(W&&W.__esModule)return W;var U={};if(null!=W)for(var F in W)Object.prototype.hasOwnProperty.call(W,F)&&(U[F]=W[F]);return U.default=W,U}(I);_(20),L.VERSION='0.3','undefined'!=typeof C&&(C.EPUBJS_VERSION=L.VERSION),L.CFI=z.default,L.Rendition=O.default,L.Contents=A.default,L.utils=M,L.ViewManagers={},L.Views={},L.register={manager:function(U,F){return L.ViewManagers[U]=F},view:function(U,F){return L.Views[U]=F}},L.register.view('iframe',_(23)),L.register.manager('default',_(13)),L.register.manager('continuous',_(22)),k.default=L,v.exports=k['default']}).call(k,_(8))},function(v,k){'use strict';function C(L,P){if(!(L instanceof P))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function L(P,R){for(var T=0,z;T<R.length;T++)z=R[T],z.enumerable=z.enumerable||!1,z.configurable=!0,'value'in z&&(z.writable=!0),Object.defineProperty(P,z.key,z)}return function(P,R,T){return R&&L(P.prototype,R),T&&L(P,T),P}}(),E=function(){function L(P){C(this,L),this.settings=P,this.name=P.layout||'reflowable',this._spread='none'!==P.spread,this._minSpreadWidth=P.minSpreadWidth||800,this._evenSpreads=P.evenSpreads||!1,this._flow='scrolled'===P.flow||'scrolled-continuous'===P.flow||'scrolled-doc'===P.flow?'scrolled':'paginated',this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}return S(L,[{key:'flow',value:function(R){return'undefined'!=typeof R&&(this._flow='scrolled'===R||'scrolled-continuous'===R||'scrolled-doc'===R?'scrolled':'paginated',this.props.flow=this._flow),this._flow}},{key:'spread',value:function(R,T){return R&&(this._spread='none'!==R,this.props.spread=this._spread),0<=T&&(this._minSpreadWidth=T),this._spread}},{key:'calculate',value:function(R,T,z){var N=1,O=z||0,B=R,A=Math.floor(B/12),I,M,W,U;N=this._spread&&B>=this._minSpreadWidth?2:1,'reflowable'!==this.name||'paginated'!==this._flow||0<=z||(O=0==A%2?A:A-1),'pre-paginated'===this.name&&(O=0),I=1<N?B/N-O:B,'pre-paginated'===this.name&&1<N&&(B=I),M=I*N+O,W=I+O/2,U=B,this.width=B,this.height=T,this.spreadWidth=M,this.pageWidth=W,this.delta=U,this.columnWidth=I,this.gap=O,this.divisor=N,this.props.width=B,this.props.height=T,this.props.spreadWidth=M,this.props.pageWidth=W,this.props.delta=U,this.props.columnWidth=I,this.props.gap=O,this.props.divisor=N}},{key:'format',value:function(R){var T;return T='pre-paginated'===this.name?R.fit(this.columnWidth,this.height):'paginated'===this._flow?R.columns(this.width,this.height,this.columnWidth,this.gap):R.size(this.width,null),T}},{key:'count',value:function(R,T){var z,N;return'pre-paginated'===this.name?(z=1,N=1):'paginated'===this._flow?(T=T||this.delta,z=Math.ceil(R/T),N=z*this.divisor):(T=T||this.height,z=Math.ceil(R/T),N=z),{spreads:z,pages:N}}}]),L}();k.default=E,v.exports=k['default']},function(v,k,_){'use strict';function C(A){return A&&A.__esModule?A:{default:A}}function S(A,I){if(!(A instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function A(I,M){for(var W=0,U;W<M.length;W++)U=M[W],U.enumerable=U.enumerable||!1,U.configurable=!0,'value'in U&&(U.writable=!0),Object.defineProperty(I,U.key,U)}return function(I,M,W){return M&&A(I.prototype,M),W&&A(I,W),I}}(),L=_(0),P=_(11),R=C(P),T=_(1),z=C(T),N=_(2),O=C(N),B=function(){function A(I,M,W){S(this,A),this.spine=I,this.request=M,this.pause=W||100,this.q=new R.default(this),this.epubcfi=new z.default,this._locations=[],this.total=0,this.break=150,this._current=0,this.currentLocation='',this._currentCfi='',this.processingTimeout=void 0}return E(A,[{key:'generate',value:function(M){return M&&(this.break=M),this.q.pause(),this.spine.each(function(W){W.linear&&this.q.enqueue(this.process.bind(this),W)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}},{key:'createRange',value:function(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}},{key:'process',value:function(M){return M.load(this.request).then(function(W){var U=new L.defer,F=this.parse(W,M.cfiBase);return this._locations=this._locations.concat(F),M.unload(),this.processingTimeout=setTimeout(function(){return U.resolve(F)},this.pause),U.promise}.bind(this))}},{key:'parse',value:function(M,W,U){var F=[],H=M.ownerDocument,V=(0,L.qs)(H,'body'),X=0,J=U||this.break,D,Y;if((0,L.sprint)(V,function(G){var $=G.length,te=0,ee;if(0===G.textContent.trim().length)return!1;for(0==X&&(D=this.createRange(),D.startContainer=G,D.startOffset=0),ee=J-X,ee>$&&(X+=$,te=$);te<$;)if(ee=J-X,0===X&&(te+=1,D=this.createRange(),D.startContainer=G,D.startOffset=te),te+ee>=$)X+=$-te,te=$;else{te+=ee,D.endContainer=G,D.endOffset=te;var ne=new z.default(D,W).toString();F.push(ne),X=0}Y=G}.bind(this)),D&&D.startContainer&&Y){D.endContainer=Y,D.endOffset=Y.length;var Q=new z.default(D,W).toString();F.push(Q),X=0}return F}},{key:'locationFromCfi',value:function(M){var W;return(z.default.prototype.isCfiString(M)&&(M=new z.default(M)),0===this._locations.length)?-1:(W=(0,L.locationOf)(M,this._locations,this.epubcfi.compare),W>this.total?this.total:W)}},{key:'percentageFromCfi',value:function(M){if(0===this._locations.length)return null;var W=this.locationFromCfi(M);return this.percentageFromLocation(W)}},{key:'percentageFromLocation',value:function(M){return M&&this.total?M/this.total:0}},{key:'cfiFromLocation',value:function(M){var W=-1;return'number'!=typeof M&&(M=parseInt(M)),0<=M&&M<this._locations.length&&(W=this._locations[M]),W}},{key:'cfiFromPercentage',value:function(M){var W;if(1<M&&console.warn('Normalize cfiFromPercentage value to between 0 - 1'),1<=M){var U=new z.default(this._locations[this.total]);return U.collapse(),U.toString()}return W=Math.ceil(this.total*M),this.cfiFromLocation(W)}},{key:'load',value:function(M){return this._locations='string'==typeof M?JSON.parse(M):M,this.total=this._locations.length-1,this._locations}},{key:'save',value:function(){return JSON.stringify(this._locations)}},{key:'getCurrent',value:function(){return this._current}},{key:'setCurrent',value:function(M){var W;if('string'==typeof M)this._currentCfi=M;else if('number'==typeof M)this._current=M;else return;0===this._locations.length||('string'==typeof M?(W=this.locationFromCfi(M),this._current=W):W=M,this.emit('changed',{percentage:this.percentageFromLocation(W)}))}},{key:'length',value:function(){return this._locations.length}},{key:'destroy',value:function(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}},{key:'currentLocation',get:function(){return this._current},set:function(M){this.setCurrent(M)}}]),A}();(0,O.default)(B.prototype),k.default=B,v.exports=k['default']},function(v,k,_){'use strict';function C(P,R){if(!(P instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function P(R,T){for(var z=0,N;z<T.length;z++)N=T[z],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(R,N.key,N)}return function(R,T,z){return T&&P(R.prototype,T),z&&P(R,z),R}}(),E=_(0),L=function(){function P(R){C(this,P),this.settings=R||{},this.id='epubjs-container-'+(0,E.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}return S(P,[{key:'create',value:function(T){var z=T.height,N=T.width,O=T.overflow||!1,B=T.axis||'vertical';T.height&&(0,E.isNumber)(T.height)&&(z=T.height+'px'),T.width&&(0,E.isNumber)(T.width)&&(N=T.width+'px');var A=document.createElement('div');return A.id=this.id,A.classList.add('epub-container'),A.style.wordSpacing='0',A.style.lineHeight='0',A.style.verticalAlign='top',A.style.position='relative','horizontal'===B&&(A.style.display='flex',A.style.flexDirection='row',A.style.flexWrap='nowrap'),N&&(A.style.width=N),z&&(A.style.height=z),O&&(A.style.overflow=O),A}},{key:'wrap',value:function(T){var z=document.createElement('div');return z.style.visibility='hidden',z.style.overflow='hidden',z.style.width='0',z.style.height='0',z.appendChild(T),z}},{key:'getElement',value:function(T){var z;if((0,E.isElement)(T)?z=T:'string'==typeof T&&(z=document.getElementById(T)),!z)throw new Error('Not an Element');return z}},{key:'attachTo',value:function(T){var z=this.getElement(T),N;if(z)return N=this.settings.hidden?this.wrapper:this.container,z.appendChild(N),this.element=z,z}},{key:'getContainer',value:function(){return this.container}},{key:'onResize',value:function(T){(0,E.isNumber)(this.settings.width)&&(0,E.isNumber)(this.settings.height)||(this.resizeFunc=T,window.addEventListener('resize',this.resizeFunc,!1))}},{key:'onOrientationChange',value:function(T){this.orientationChangeFunc=T,window.addEventListener('orientationChange',this.orientationChangeFunc,!1)}},{key:'size',value:function(T,z){var N;null===T&&(N=this.element.getBoundingClientRect(),N.width&&(T=N.width,this.container.style.width=N.width+'px')),null===z&&(N=N||this.element.getBoundingClientRect(),N.height&&(z=N.height,this.container.style.height=N.height+'px')),(0,E.isNumber)(T)||(N=this.container.getBoundingClientRect(),T=N.width),(0,E.isNumber)(z)||(N=N||this.container.getBoundingClientRect(),z=N.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles['padding-left'])||0,right:parseFloat(this.containerStyles['padding-right'])||0,top:parseFloat(this.containerStyles['padding-top'])||0,bottom:parseFloat(this.containerStyles['padding-bottom'])||0};var O=(0,E.windowBounds)();return T||(T=O.width),(this.settings.fullsize||!z)&&(z=O.height),{width:T-this.containerPadding.left-this.containerPadding.right,height:z-this.containerPadding.top-this.containerPadding.bottom}}},{key:'bounds',value:function(){var T;return'visible'!==this.container.style.overflow&&(T=this.container&&this.container.getBoundingClientRect()),T&&T.width&&T.height?T:(0,E.windowBounds)()}},{key:'getSheet',value:function(){var T=document.createElement('style');return T.appendChild(document.createTextNode('')),document.head.appendChild(T),T.sheet}},{key:'addStyleRules',value:function(T,z){var N='#'+this.id+' ',O='';this.sheet||(this.sheet=this.getSheet()),z.forEach(function(B){for(var A in B)B.hasOwnProperty(A)&&(O+=A+':'+B[A]+';')}),this.sheet.insertRule(N+T+' {'+O+'}',0)}},{key:'axis',value:function(T){'horizontal'===T?(this.container.style.display='flex',this.container.style.flexDirection='row',this.container.style.flexWrap='nowrap'):this.container.style.display='block'}},{key:'destroy',value:function(){var T;this.element&&(T=this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener('resize',this.resizeFunc),window.removeEventListener('orientationChange',this.orientationChangeFunc))}}]),P}();k.default=L,v.exports=k['default']},function(v,k){'use strict';function C(L,P){if(!(L instanceof P))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function L(P,R){for(var T=0,z;T<R.length;T++)z=R[T],z.enumerable=z.enumerable||!1,z.configurable=!0,'value'in z&&(z.writable=!0),Object.defineProperty(P,z.key,z)}return function(P,R,T){return R&&L(P.prototype,R),T&&L(P,T),P}}(),E=function(){function L(P){C(this,L),this.container=P,this._views=[],this.length=0,this.hidden=!1}return S(L,[{key:'all',value:function(){return this._views}},{key:'first',value:function(){return this._views[0]}},{key:'last',value:function(){return this._views[this._views.length-1]}},{key:'indexOf',value:function(R){return this._views.indexOf(R)}},{key:'slice',value:function(){return this._views.slice.apply(this._views,arguments)}},{key:'get',value:function(R){return this._views[R]}},{key:'append',value:function(R){return this._views.push(R),this.container&&this.container.appendChild(R.element),this.length++,R}},{key:'prepend',value:function(R){return this._views.unshift(R),this.container&&this.container.insertBefore(R.element,this.container.firstChild),this.length++,R}},{key:'insert',value:function(R,T){return this._views.splice(T,0,R),this.container&&(T<this.container.children.length?this.container.insertBefore(R.element,this.container.children[T]):this.container.appendChild(R.element)),this.length++,R}},{key:'remove',value:function(R){var T=this._views.indexOf(R);-1<T&&this._views.splice(T,1),this.destroy(R),this.length--}},{key:'destroy',value:function(R){R.displayed&&R.destroy(),this.container&&this.container.removeChild(R.element),R=null}},{key:'each',value:function(){return this._views.forEach.apply(this._views,arguments)}},{key:'clear',value:function(){var T=this.length,R;if(this.length){for(var z=0;z<T;z++)R=this._views[z],this.destroy(R);this._views=[],this.length=0}}},{key:'find',value:function(R){for(var z=this.length,N=0,T;N<z;N++)if(T=this._views[N],T.displayed&&T.section.index==R.index)return T}},{key:'displayed',value:function(){for(var P=[],T=this.length,z=0,R;z<T;z++)R=this._views[z],R.displayed&&P.push(R);return P}},{key:'show',value:function(){for(var T=this.length,z=0,R;z<T;z++)R=this._views[z],R.displayed&&R.show();this.hidden=!1}},{key:'hide',value:function(){for(var T=this.length,z=0,R;z<T;z++)R=this._views[z],R.displayed&&R.hide();this.hidden=!0}}]),L}();k.default=E,v.exports=k['default']},function(v,k,_){'use strict';function C(P,R){if(!(P instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function P(R,T){for(var z=0,N;z<T.length;z++)N=T[z],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(R,N.key,N)}return function(R,T,z){return T&&P(R.prototype,T),z&&P(R,z),R}}(),E=_(0),L=function(){function P(R){C(this,P),this.toc=[],this.tocByHref={},this.tocById={},R&&this.parse(R)}return S(P,[{key:'parse',value:function(T){var z=T.nodeType,N,O;z&&(N=(0,E.qs)(T,'html'),O=(0,E.qs)(T,'ncx')),z?N?this.toc=this.parseNav(T):O&&(this.toc=this.parseNcx(T)):this.toc=this.load(T),this.unpack(this.toc)}},{key:'unpack',value:function(T){for(var N=0,z;N<T.length;N++)z=T[N],this.tocByHref[z.href]=N,this.tocById[z.id]=N}},{key:'get',value:function(T){var z;return T?(0===T.indexOf('#')?z=this.tocById[T.substring(1)]:T in this.tocByHref&&(z=this.tocByHref[T]),this.toc[z]):this.toc}},{key:'createTocItem',value:function(T,z){var N=this,O=[],B=T.childNodes,A=Array.prototype.slice.call(B),I=z?z:0;return A.forEach(function(M){if('li'===M.nodeName.toLowerCase()){var W=(0,E.qs)(M,'a'),U={id:-1,href:W.getAttribute('href'),label:W.textContent,parent:null},F=(0,E.qs)(M,'ol');if(I++,U.id=I,z&&(U.parent=z),O.push(U),F){var D=N.createTocItem(F,I);D&&0<D.length&&(I+=D.length,O=O.concat(D))}}}),O}},{key:'parseNav',value:function(T){var z=(0,E.querySelectorByType)(T,'nav','toc'),N=(0,E.qs)(z,'ol');return this.createTocItem(N)}},{key:'navItem',value:function(T){var z=T.getAttribute('id')||!1,N=(0,E.qs)(T,'a'),O=N.getAttribute('href')||'',B=N.textContent||'',I=T.parentNode,M;return I&&'navPoint'===I.nodeName&&(M=I.getAttribute('id')),{id:z,href:O,label:B,subitems:[],parent:M}}},{key:'parseNcx',value:function(T){var z=(0,E.qsa)(T,'navPoint'),N=z.length,B={},A=[],O,I,M;if(!z||0===N)return A;for(O=0;O<N;++O)I=this.ncxItem(z[O]),B[I.id]=I,I.parent?(M=B[I.parent],M.subitems.push(I)):A.push(I);return A}},{key:'ncxItem',value:function(T){var z=T.getAttribute('id')||!1,N=(0,E.qs)(T,'content'),O=N.getAttribute('src'),B=(0,E.qs)(T,'navLabel'),A=B.textContent?B.textContent:'',M=T.parentNode,W;return M&&'navPoint'===M.nodeName&&(W=M.getAttribute('id')),{id:z,href:O,label:A,subitems:[],parent:W}}},{key:'load',value:function(T){var z=this;return T.map(function(N){return N.label=N.title,N.children&&(N.subitems=z.load(N.children)),N})}},{key:'forEach',value:function(T){return this.toc.forEach(T)}}]),P}();k.default=L,v.exports=k['default']},function(v,k,_){'use strict';function C(P,R){if(!(P instanceof R))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var S=function(){function P(R,T){for(var z=0,N;z<T.length;z++)N=T[z],N.enumerable=N.enumerable||!1,N.configurable=!0,'value'in N&&(N.writable=!0),Object.defineProperty(R,N.key,N)}return function(R,T,z){return T&&P(R.prototype,T),z&&P(R,z),R}}(),E=_(0),L=function(){function P(R){C(this,P),this.manifest={},this.navPath='',this.ncxPath='',this.coverPath='',this.spineNodeIndex=0,this.spine=[],this.metadata={},R&&this.parse(R)}return S(P,[{key:'parse',value:function(T){var z,N,O;if(!T)throw new Error('Package File Not Found');if(z=(0,E.qs)(T,'metadata'),!z)throw new Error('No Metadata Found');if(N=(0,E.qs)(T,'manifest'),!N)throw new Error('No Manifest Found');if(O=(0,E.qs)(T,'spine'),!O)throw new Error('No Spine Found');return this.manifest=this.parseManifest(N),this.navPath=this.findNavPath(N),this.ncxPath=this.findNcxPath(N,O),this.coverPath=this.findCoverPath(T),this.spineNodeIndex=(0,E.indexOfElementNode)(O),this.spine=this.parseSpine(O,this.manifest),this.metadata=this.parseMetadata(z),this.metadata.direction=O.getAttribute('page-progression-direction'),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}},{key:'parseMetadata',value:function(T){var z={title:this.getElementText(T,'title'),creator:this.getElementText(T,'creator'),description:this.getElementText(T,'description'),pubdate:this.getElementText(T,'date'),publisher:this.getElementText(T,'publisher'),identifier:this.getElementText(T,'identifier'),language:this.getElementText(T,'language'),rights:this.getElementText(T,'rights'),modified_date:this.getPropertyText(T,'dcterms:modified'),layout:this.getPropertyText(T,'rendition:layout'),orientation:this.getPropertyText(T,'rendition:orientation'),flow:this.getPropertyText(T,'rendition:flow'),viewport:this.getPropertyText(T,'rendition:viewport')};return z}},{key:'parseManifest',value:function(T){var z={},N=(0,E.qsa)(T,'item'),O=Array.prototype.slice.call(N);return O.forEach(function(B){var A=B.getAttribute('id'),I=B.getAttribute('href')||'',M=B.getAttribute('media-type')||'',W=B.getAttribute('properties')||'';z[A]={href:I,type:M,properties:W.length?W.split(' '):[]}}),z}},{key:'parseSpine',value:function(T){var N=[],O=T.getElementsByTagName('itemref'),B=Array.prototype.slice.call(O);return B.forEach(function(A,I){var M=A.getAttribute('idref'),W=A.getAttribute('properties')||'',U=W.length?W.split(' '):[],F={idref:M,linear:A.getAttribute('linear')||'yes',properties:U,index:I};N.push(F)}),N}},{key:'findNavPath',value:function(T){var z=(0,E.qsp)(T,'item',{properties:'nav'});return!!z&&z.getAttribute('href')}},{key:'findNcxPath',value:function(T,z){var N=(0,E.qsp)(T,'item',{\"media-type\":'application/x-dtbncx+xml'}),O;return N||(O=z.getAttribute('toc'),O&&(N=T.getElementById(O))),!!N&&N.getAttribute('href')}},{key:'findCoverPath',value:function(T){var z=(0,E.qs)(T,'package'),N=z.getAttribute('version');if('2.0'===N){var O=(0,E.qsp)(T,'meta',{name:'cover'});if(O){var B=O.getAttribute('content'),A=T.getElementById(B);return A?A.getAttribute('href'):''}return!1}var I=(0,E.qsp)(T,'item',{properties:'cover-image'});return I?I.getAttribute('href'):''}},{key:'getElementText',value:function(T,z){var N=T.getElementsByTagNameNS('http://purl.org/dc/elements/1.1/',z),O;return N&&0!==N.length?(O=N[0],O.childNodes.length?O.childNodes[0].nodeValue:''):''}},{key:'getPropertyText',value:function(T,z){var N=(0,E.qsp)(T,'meta',{property:z});return N&&N.childNodes.length?N.childNodes[0].nodeValue:''}},{key:'load',value:function(T){var z=this;return this.metadata=T.metadata,this.spine=T.spine.map(function(N,O){return N.index=O,N}),T.resources.forEach(function(N,O){z.manifest[O]=N,N.rel&&'cover'===N.rel[0]&&(z.coverPath=N.href)}),this.spineNodeIndex=0,this.toc=T.toc.map(function(N){return N.label=N.title,N}),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}},{key:'destroy',value:function(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}]),P}();k.default=L,v.exports=k['default']},function(v,k,_){'use strict';function S(z,N){if(!(z instanceof N))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function z(N,O){for(var B=0,A;B<O.length;B++)A=O[B],A.enumerable=A.enumerable||!1,A.configurable=!0,'value'in A&&(A.writable=!0),Object.defineProperty(N,A.key,A)}return function(N,O,B){return O&&z(N.prototype,O),B&&z(N,B),N}}(),L=_(1),P=function(z){return z&&z.__esModule?z:{default:z}}(L),R=_(0),T=function(){function z(N){S(this,z),this.pages=[],this.locations=[],this.epubcfi=new P.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,this.lastPage,N&&(this.pageList=this.parse(N)),this.pageList&&this.pageList.length&&this.process(this.pageList)}return E(z,[{key:'parse',value:function(O){var B=(0,R.qs)(O,'html'),A=(0,R.qs)(O,'ncx');if(B)this.toc=this.parseNav(O);else if(A)return}},{key:'parseNav',value:function(O){var B=(0,R.querySelectorByType)(O,'nav','page-list'),A=B?(0,R.qsa)(B,'li'):[],I=A.length,W=[],M,U;if(!A||0===I)return W;for(M=0;M<I;++M)U=this.item(A[M]),W.push(U);return W}},{key:'item',value:function(O){var B=(0,R.qs)(O,'a'),A=B.getAttribute('href')||'',I=B.textContent||'',M=parseInt(I),W=A.indexOf('epubcfi'),U,F,D;return-1==W?{href:A,page:M}:(U=A.split('#'),F=U[0],D=!!(1<U.length)&&U[1],{cfi:D,href:A,packageUrl:F,page:M})}},{key:'process',value:function(O){O.forEach(function(B){this.pages.push(B.page),B.cfi&&this.locations.push(B.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}},{key:'addCFIs',value:function(){this.pageList.forEach(function(O){!O.cfi})}},{key:'pageFromCfi',value:function(O){var B=-1;if(0===this.locations.length)return-1;var A=(0,R.indexOfSorted)(O,this.locations,this.epubcfi.compare);return-1==A?(A=(0,R.locationOf)(O,this.locations,this.epubcfi.compare),B=0<=A-1?this.pages[A-1]:this.pages[0],void 0!==B||(B=-1)):B=this.pages[A],B}},{key:'cfiFromPage',value:function(O){var B=-1;'number'!=typeof O&&(O=parseInt(O));var A=this.pages.indexOf(O);return-1!=A&&(B=this.locations[A]),B}},{key:'pageFromPercentage',value:function(O){var B=Math.round(this.totalPages*O);return B}},{key:'percentageFromPage',value:function(O){var B=(O-this.firstPage)/this.totalPages;return Math.round(1e3*B)/1e3}},{key:'percentageFromCfi',value:function(O){var B=this.pageFromCfi(O),A=this.percentageFromPage(B);return A}},{key:'destroy',value:function(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}]),z}();k.default=T,v.exports=k['default']},function(v,k,_){'use strict';function C(W){return W&&W.__esModule?W:{default:W}}function S(W,U){if(!(W instanceof U))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function W(U,F){for(var D=0,H;D<F.length;D++)H=F[D],H.enumerable=H.enumerable||!1,H.configurable=!0,'value'in H&&(H.writable=!0),Object.defineProperty(U,H.key,H)}return function(U,F,D){return F&&W(U.prototype,F),D&&W(U,D),U}}(),L=_(4),P=_(0),R=_(5),T=C(R),z=_(15),N=C(z),O=_(3),B=C(O),A=_(6),I=C(A),M=function(){function W(U,F){S(this,W),this.settings={replacements:F&&F.replacements||'base64',archive:F&&F.archive,resolver:F&&F.resolver,request:F&&F.request},this.manifest=U,this.resources=Object.keys(U).map(function(D){return U[D]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}return E(W,[{key:'split',value:function(){this.html=this.resources.filter(function(F){if('application/xhtml+xml'===F.type||'text/html'===F.type)return!0}),this.assets=this.resources.filter(function(F){if('application/xhtml+xml'!==F.type&&'text/html'!==F.type)return!0}),this.css=this.resources.filter(function(F){if('text/css'===F.type)return!0})}},{key:'splitUrls',value:function(){this.urls=this.assets.map(function(F){return F.href}.bind(this)),this.cssUrls=this.css.map(function(F){return F.href})}},{key:'createUrl',value:function(F){var D=new T.default(F),H=N.default.lookup(D.filename);return this.settings.archive?this.settings.archive.createUrl(F,{base64:'base64'===this.settings.replacements}):'base64'===this.settings.replacements?this.settings.request(F,'blob').then(function(V){return(0,P.blob2base64)(V)}).then(function(V){return(0,P.createBase64Url)(V,H)}):this.settings.request(F,'blob').then(function(V){return(0,P.createBlobUrl)(V,H)})}},{key:'replacements',value:function(){var F=this;if('none'===this.settings.replacements)return new Promise(function(D){D(this.urls)}.bind(this));var U=this.urls.map(function(D){var H=F.settings.resolver(D);return F.createUrl(H).catch(function(V){return console.error(V),null})});return Promise.all(U).then(function(D){return F.replacementUrls=D.filter(function(H){return'string'==typeof H}),D})}},{key:'replaceCss',value:function(F,D){var H=[];return F=F||this.settings.archive,D=D||this.settings.resolver,this.cssUrls.forEach(function(V){var X=this.createCssFile(V,F,D).then(function(Y){var J=this.urls.indexOf(V);-1<J&&(this.replacementUrls[J]=Y)}.bind(this));H.push(X)}.bind(this)),Promise.all(H)}},{key:'createCssFile',value:function(F){var D=this,H;if(I.default.isAbsolute(F))return new Promise(function(J){J()});var V=this.settings.resolver(F),X;X=this.settings.archive?this.settings.archive.getText(V):this.settings.request(V,'text');var Y=this.urls.map(function(J){var Z=D.settings.resolver(J),Q=new B.default(V).relative(Z);return Q});return X?X.then(function(J){return J=(0,L.substitute)(J,Y,D.replacementUrls),H='base64'===D.settings.replacements?(0,P.createBase64Url)(J,'text/css'):(0,P.createBlobUrl)(J,'text/css'),H},function(){return new Promise(function(Z){Z()})}):new Promise(function(J){J()})}},{key:'relativeTo',value:function(F,D){return D=D||this.settings.resolver,this.urls.map(function(H){var V=D(H),X=new B.default(F).relative(V);return X}.bind(this))}},{key:'get',value:function(F){var D=this.urls.indexOf(F);return-1===D?void 0:this.replacementUrls.length?new Promise(function(H){H(this.replacementUrls[D])}.bind(this)):this.createUrl(F)}},{key:'substitute',value:function(F,D){var H;return H=D?this.relativeTo(D):this.urls,(0,L.substitute)(F,H,this.replacementUrls)}},{key:'destroy',value:function(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}]),W}();k.default=M,v.exports=k['default']},function(v,k,_){'use strict';function C(B){return B&&B.__esModule?B:{default:B}}function S(B,A){if(!(B instanceof A))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function B(A,I){for(var M=0,W;M<I.length;M++)W=I[M],W.enumerable=W.enumerable||!1,W.configurable=!0,'value'in W&&(W.writable=!0),Object.defineProperty(A,W.key,W)}return function(A,I,M){return I&&B(A.prototype,I),M&&B(A,M),A}}(),L=_(0),P=_(1),R=C(P),T=_(10),z=C(T),N=_(4),O=function(){function B(A,I){S(this,B),this.idref=A.idref,this.linear='yes'===A.linear,this.properties=A.properties,this.index=A.index,this.href=A.href,this.url=A.url,this.next=A.next,this.prev=A.prev,this.cfiBase=A.cfiBase,I?this.hooks=I:(this.hooks={},this.hooks.serialize=new z.default(this),this.hooks.content=new z.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}return E(B,[{key:'load',value:function(I){var M=I||this.request||_(12),W=new L.defer,U=W.promise;return this.contents?W.resolve(this.contents):M(this.url).then(function(F){return this.document=F,this.contents=F.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){W.resolve(this.contents)}.bind(this)).catch(function(F){W.reject(F)}),U}},{key:'base',value:function(){return(0,N.replaceBase)(this.document,this)}},{key:'render',value:function(I){var M=new L.defer,W=M.promise;return this.output,this.load(I).then(function(U){var F='undefined'!=typeof navigator&&navigator.userAgent||'',D=0<=F.indexOf('Trident'),H;H='undefined'==typeof XMLSerializer||D?_(19).XMLSerializer:XMLSerializer;var V=new H;return this.output=V.serializeToString(U),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){M.resolve(this.output)}.bind(this)).catch(function(U){M.reject(U)}),W}},{key:'find',value:function(I){var M=this,W=[],U=I.toLowerCase(),A=function(D){for(var H=D.textContent.toLowerCase(),V=M.document.createRange(),J=-1,Q=150,X,Y,Z;-1!=Y;)Y=H.indexOf(U,J+1),-1!=Y&&(V=M.document.createRange(),V.setStart(D,Y),V.setEnd(D,Y+U.length),X=M.cfiFromRange(V),D.textContent.length<Q?Z=D.textContent:(Z=D.textContent.substring(Y-Q/2,Y+Q/2),Z='...'+Z+'...'),W.push({cfi:X,excerpt:Z})),J=Y};return(0,L.sprint)(M.document,function(F){A(F)}),W}},{key:'reconcileLayoutSettings',value:function(I){var M={layout:I.layout,spread:I.spread,orientation:I.orientation};return this.properties.forEach(function(W){var U=W.replace('rendition:',''),F=U.indexOf('-'),D,H;-1!=F&&(D=U.slice(0,F),H=U.slice(F+1),M[D]=H)}),M}},{key:'cfiFromRange',value:function(I){return new R.default(I,this.cfiBase).toString()}},{key:'cfiFromElement',value:function(I){return new R.default(I,this.cfiBase).toString()}},{key:'unload',value:function(){this.document=void 0,this.contents=void 0,this.output=void 0}},{key:'destroy',value:function(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}]),B}();k.default=O,v.exports=k['default']},function(v,k,_){'use strict';function C(A){return A&&A.__esModule?A:{default:A}}function S(A,I){if(!(A instanceof I))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E=function(){function A(I,M){for(var W=0,U;W<M.length;W++)U=M[W],U.enumerable=U.enumerable||!1,U.configurable=!0,'value'in U&&(U.writable=!0),Object.defineProperty(I,U.key,U)}return function(I,M,W){return M&&A(I.prototype,M),W&&A(I,W),I}}(),L=_(1),P=C(L),R=_(10),T=C(R),z=_(39),N=C(z),O=_(4),B=function(){function A(){S(this,A),this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new T.default,this.hooks.content=new T.default,this.hooks.content.register(O.replaceBase),this.hooks.content.register(O.replaceCanonical),this.hooks.content.register(O.replaceMeta),this.epubcfi=new P.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}return E(A,[{key:'unpack',value:function(M,W){var U=this;this.items=M.spine,this.manifest=M.manifest,this.spineNodeIndex=M.spineNodeIndex,this.baseUrl=M.baseUrl||M.basePath||'',this.length=this.items.length,this.items.forEach(function(F,D){var H=U.manifest[F.idref],V;F.index=D,F.cfiBase=U.epubcfi.generateChapterComponent(U.spineNodeIndex,F.index,F.idref),F.href&&(F.url=W(F.href,!0)),H&&(F.href=H.href,F.url=W(F.href,!0),H.properties.length&&F.properties.push.apply(F.properties,H.properties)),'yes'===F.linear?(F.prev=function(){for(var X=F.index,Y;0<X;){if(Y=this.get(X-1),Y&&Y.linear)return Y;X-=1}}.bind(U),F.next=function(){for(var X=F.index,Y;X<this.spineItems.length-1;){if(Y=this.get(X+1),Y&&Y.linear)return Y;X+=1}}.bind(U)):(F.prev=function(){},F.next=function(){}),V=new N.default(F,U.hooks),U.append(V)}),this.loaded=!0}},{key:'get',value:function(M){var W=0;if('undefined'==typeof M)for(;W<this.spineItems.length;){var U=this.spineItems[W];if(U&&U.linear)break;W+=1}else if(this.epubcfi.isCfiString(M)){var F=new P.default(M);W=F.spinePos}else'number'==typeof M||!1===isNaN(M)?W=M:'string'==typeof M&&0===M.indexOf('#')?W=this.spineById[M.substring(1)]:'string'==typeof M&&(M=M.split('#')[0],W=this.spineByHref[M]);return this.spineItems[W]||null}},{key:'append',value:function(M){var W=this.spineItems.length;return M.index=W,this.spineItems.push(M),this.spineByHref[M.href]=W,this.spineById[M.idref]=W,W}},{key:'prepend',value:function(M){return this.spineByHref[M.href]=0,this.spineById[M.idref]=0,this.spineItems.forEach(function(W,U){W.index=U}),0}},{key:'remove',value:function(M){var W=this.spineItems.indexOf(M);if(-1<W)return delete this.spineByHref[M.href],delete this.spineById[M.idref],this.spineItems.splice(W,1)}},{key:'each',value:function(){return this.spineItems.forEach.apply(this.spineItems,arguments)}},{key:'first',value:function(){for(var M=0,W;M<this.spineItems.length-1;){if(W=this.get(M),W&&W.linear)return W;M+=1}}},{key:'last',value:function(){for(var M=this.spineItems.length-1,W;0<M;){if(W=this.get(M),W&&W.linear)return W;M-=1}}},{key:'destroy',value:function(){this.each(function(M){return M.destroy()}),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}]),A}();k.default=B,v.exports=k['default']},function(v,k,_){'use strict';function S(z,N){if(!(z instanceof N))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(k,'__esModule',{value:!0});var E='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(z){return typeof z}:function(z){return z&&'function'==typeof Symbol&&z.constructor===Symbol&&z!==Symbol.prototype?'symbol':typeof z},L=function(){function z(N,O){for(var B=0,A;B<O.length;B++)A=O[B],A.enumerable=A.enumerable||!1,A.configurable=!0,'value'in A&&(A.writable=!0),Object.defineProperty(N,A.key,A)}return function(N,O,B){return O&&z(N.prototype,O),B&&z(N,B),N}}(),P=_(5),R=function(z){return z&&z.__esModule?z:{default:z}}(P),T=function(){function z(N){S(this,z),this.rendition=N,this._themes={default:{rules:{},url:'',serialized:''}},this._overrides={},this._current='default',this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}return L(z,[{key:'register',value:function(){return 0===arguments.length?void 0:1===arguments.length&&'object'===E(arguments[0])?this.registerThemes(arguments[0]):1===arguments.length&&'string'==typeof arguments[0]?this.default(arguments[0]):2===arguments.length&&'string'==typeof arguments[1]?this.registerUrl(arguments[0],arguments[1]):2===arguments.length&&'object'===E(arguments[1])?this.registerRules(arguments[0],arguments[1]):void 0}},{key:'default',value:function(O){return O?'string'==typeof O?this.registerUrl('default',O):'object'===('undefined'==typeof O?'undefined':E(O))?this.registerRules('default',O):void 0:void 0}},{key:'registerThemes',value:function(O){for(var B in O)O.hasOwnProperty(B)&&('string'==typeof O[B]?this.registerUrl(B,O[B]):this.registerRules(B,O[B]))}},{key:'registerUrl',value:function(O,B){var A=new R.default(B);this._themes[O]={url:A.toString()},this._injected[O]&&this.update(O)}},{key:'registerRules',value:function(O,B){this._themes[O]={rules:B},this._injected[O]&&this.update(O)}},{key:'select',value:function(O){var B=this._current,A;this._current=O,this.update(O),A=this.rendition.getContents(),A.forEach(function(I){I.removeClass(B),I.addClass(O)})}},{key:'update',value:function(O){var B=this,A=this.rendition.getContents();A.forEach(function(I){B.add(O,I)})}},{key:'inject',value:function(O){var B=[],A=this._themes,I;for(var M in A)A.hasOwnProperty(M)&&(M===this._current||'default'==M)&&(I=A[M],(I.rules&&0<Object.keys(I.rules).length||I.url&&-1===B.indexOf(I.url))&&this.add(M,O),this._injected.push(M));'default'!=this._current&&O.addClass(this._current)}},{key:'add',value:function(O,B){var A=this._themes[O];A&&B&&(A.url?B.addStylesheet(A.url):A.serialized||A.rules&&(B.addStylesheetRules(A.rules),A.injected=!0))}},{key:'override',value:function(O,B){var A=this,I=this.rendition.getContents();this._overrides[O]=B,I.forEach(function(M){M.css(O,A._overrides[O])})}},{key:'overrides',value:function(O){var N=this._overrides;for(var B in N)N.hasOwnProperty(B)&&O.css(B,N[B])}},{key:'fontSize',value:function(O){this.override('font-size',O)}},{key:'font',value:function(O){this.override('font-family',O)}},{key:'destroy',value:function(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}]),z}();k.default=T,v.exports=k['default']},function(v,k,_){'use strict';var C=_(43),S=_(50),E=_(46),L=_(53),P;P=v.exports=function(R,T){var z,N,O,B,A;return 2>arguments.length||'string'!=typeof R?(B=T,T=R,R=null):B=arguments[2],null==R?(z=O=!0,N=!1):(z=L.call(R,'c'),N=L.call(R,'e'),O=L.call(R,'w')),A={value:T,configurable:z,enumerable:N,writable:O},B?C(S(B),A):A},P.gs=function(R,T,z){var N,O,B,A;return'string'==typeof R?B=arguments[3]:(B=z,z=T,T=R,R=null),null==T?T=void 0:E(T)?null==z?z=void 0:!E(z)&&(B=z,z=void 0):(B=T,T=z=void 0),null==R?(N=!0,O=!1):(N=L.call(R,'c'),O=L.call(R,'e')),A={get:T,set:z,configurable:N,enumerable:O},B?C(S(B),A):A}},function(v,k,_){'use strict';v.exports=_(44)()?Object.assign:_(45)},function(v){'use strict';v.exports=function(){var C=Object.assign,S;return!('function'!=typeof C)&&(S={foo:'raz'},C(S,{bar:'dwa'},{trzy:'trzy'}),'razdwatrzy'===S.foo+S.bar+S.trzy)}},function(v,k,_){'use strict';var C=_(47),S=_(52),E=Math.max;v.exports=function(L,P){var z=E(arguments.length,2),R,T,N;for(L=Object(S(L)),N=function(O){try{L[O]=P[O]}catch(B){R||(R=B)}},T=1;T<z;++T)P=arguments[T],C(P).forEach(N);if(R!==void 0)throw R;return L}},function(v){'use strict';v.exports=function(C){return'function'==typeof C}},function(v,k,_){'use strict';v.exports=_(48)()?Object.keys:_(49)},function(v){'use strict';v.exports=function(){try{return Object.keys('primitive'),!0}catch(C){return!1}}},function(v){'use strict';var C=Object.keys;v.exports=function(S){return C(null==S?S:Object(S))}},function(v){'use strict';var C=Array.prototype.forEach,S=Object.create,E=function(L,P){for(var R in L)P[R]=L[R]};v.exports=function(){var P=S(null);return C.call(arguments,function(R){null==R||E(Object(R),P)}),P}},function(v){'use strict';v.exports=function(C){if('function'!=typeof C)throw new TypeError(C+' is not a function');return C}},function(v){'use strict';v.exports=function(C){if(null==C)throw new TypeError('Cannot use null or undefined');return C}},function(v,k,_){'use strict';v.exports=_(54)()?String.prototype.contains:_(55)},function(v){'use strict';var C='razdwatrzy';v.exports=function(){return!('function'!=typeof C.contains)&&!0===C.contains('dwa')&&!1===C.contains('foo')}},function(v){'use strict';var C=String.prototype.indexOf;v.exports=function(S){return-1<C.call(this,S,arguments[1])}},function(v,k,_){var S=_(16),E=_(58),L=_(59),T=S?S.toStringTag:void 0;v.exports=function(z){return null==z?void 0===z?'[object Undefined]':'[object Null]':T&&T in Object(z)?E(z):L(z)}},function(v,k,_){(function(C){var S='object'==typeof C&&C&&C.Object===Object&&C;v.exports=S}).call(k,_(8))},function(v,k,_){var S=_(16),E=Object.prototype,L=E.hasOwnProperty,P=E.toString,R=S?S.toStringTag:void 0;v.exports=function(T){var z=L.call(T,R),N=T[R];try{T[R]=void 0}catch(A){}var B=P.call(T);return z?T[R]=N:delete T[R],B}},function(v){var C=Object.prototype,S=C.toString;v.exports=function(E){return S.call(E)}},function(v,k,_){var S=_(18),E=_(63),L=_(64),R=Math.max,T=Math.min;v.exports=function(z,N,O){function B(te){var ne=V,ae=X;return V=X=void 0,K=te,J=z.apply(ae,ne),J}function A(te){return K=te,Z=setTimeout(W,N),G?B(te):J}function I(te){var ne=te-Q,ae=te-K,ie=N-ne;return $?T(ie,Y-ae):ie}function M(te){var ne=te-Q,ae=te-K;return void 0==Q||ne>=N||0>ne||$&&ae>=Y}function W(){var te=E();return M(te)?U(te):void(Z=setTimeout(W,I(te)))}function U(te){return(Z=void 0,ee&&V)?B(te):(V=X=void 0,J)}function H(){var te=E(),ne=M(te);if(V=arguments,X=this,Q=te,ne){if(void 0===Z)return A(Q);if($)return Z=setTimeout(W,N),B(Q)}return void 0===Z&&(Z=setTimeout(W,N)),J}var K=0,G=!1,$=!1,ee=!0,V,X,Y,J,Z,Q;if('function'!=typeof z)throw new TypeError('Expected a function');return N=L(N)||0,S(O)&&(G=!!O.leading,$='maxWait'in O,Y=$?R(L(O.maxWait)||0,N):Y,ee='trailing'in O?!!O.trailing:ee),H.cancel=function(){void 0!==Z&&clearTimeout(Z),K=0,V=Q=X=Z=void 0},H.flush=function(){return void 0===Z?J:U(E())},H}},function(v){v.exports=function(C){return null!=C&&'object'==typeof C}},function(v,k,_){var S=_(56),E=_(61);v.exports=function(P){return'symbol'==typeof P||E(P)&&S(P)=='[object Symbol]'}},function(v,k,_){var C=_(17);v.exports=function(){return C.Date.now()}},function(v,k,_){var S=_(18),E=_(62),L=0/0,P=/^\\s+|\\s+$/g,R=/^[-+]0x[0-9a-f]+$/i,T=/^0b[01]+$/i,z=/^0o[0-7]+$/i,N=parseInt;v.exports=function(O){if('number'==typeof O)return O;if(E(O))return L;if(S(O)){var B='function'==typeof O.valueOf?O.valueOf():O;O=S(B)?B+'':B}if('string'!=typeof O)return 0===O?O:+O;O=O.replace(P,'');var A=T.test(O);return A||z.test(O)?N(O.slice(2),A?2:8):R.test(O)?L:+O}},function(v){v.exports=function(_){return _.webpackPolyfill||(_.deprecate=function(){},_.paths=[],!_.children&&(_.children=[]),Object.defineProperty(_,'loaded',{enumerable:!0,get:function(){return _.l}}),Object.defineProperty(_,'id',{enumerable:!0,get:function(){return _.i}}),_.webpackPolyfill=1),_}},function(v){if('undefined'==typeof p){var _=new Error('Cannot find module \"JSZip\"');throw _.code='MODULE_NOT_FOUND',_}v.exports=p}])});";
var BRIDGE="// window.onerror = function (message, file, line, col, error) {\n//   var msg = JSON.stringify({method:\"error\", value: message});\n//   window.postMessage(msg, \"*\");\n// };\n\n(function() {\n  var waitForReactNativePostMessageReady;\n\n  function _ready() {\n    var contents;\n    var targetOrigin = \"*\";\n    var sendMessage = function(obj) {\n      window.postMessage(JSON.stringify(obj), targetOrigin);\n    };\n\n    var preventTap = false;\n    var q = [];\n    var _isReady = false;\n\n    var book;\n    var rendition;\n\n    var minSpreadWidth = 800;\n    var axis = \"horizontal\";\n\n    var isChrome = /Chrome/.test(navigator.userAgent);\n    var isWebkit = !isChrome && /AppleWebKit/.test(navigator.userAgent);\n\n    var snapWidth = window.innerWidth;\n    var last_known_scroll_position = 0;\n    var ticking = false;\n    var touchCanceler = false;\n    var resizeCanceler = false;\n    var animating = false;\n    var lastRenditionEvent = null;\n\n    // debug\n    console.log = function() {\n      sendMessage({ method: \"log\", value: Array.from(arguments) });\n    };\n\n    console.error = function() {\n      sendMessage({ method: \"error\", value: Array.from(arguments) });\n    };\n\n    var isReactNativePostMessageReady = !!window.originalPostMessage;\n    clearTimeout(waitForReactNativePostMessageReady);\n    if (!isReactNativePostMessageReady) {\n      waitForReactNativePostMessageReady = setTimeout(_ready, 1);\n      return;\n    }\n\n    function onMessage(e) {\n      var message = e.data;\n      handleMessage(message);\n    }\n\n    function handleMessage(message) {\n      var decoded = typeof message == \"object\" ? message : JSON.parse(message);\n      var response;\n      var result;\n\n      switch (decoded.method) {\n        case \"nextPage\": {\n          if (rendition) {\n            rendition.next();\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"prevPage\": {\n          if (rendition) {\n            rendition.prev();\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"open\": {\n          var url = decoded.args[0];\n          var options = decoded.args.length > 1 && decoded.args[1];\n          openEpub(url, options);\n          break;\n        }\n        case \"display\": {\n          var args = decoded.args && decoded.args.length && decoded.args[0];\n          var target;\n\n          if (!args) {\n            target = undefined;\n          } else if (args.target) {\n            target = args.target.toString();\n          } else if (args.spine) {\n            target = parseInt(args.spine);\n          } else if (args.percentage) {\n            target = parseFloat(args.percentage);\n          }\n\n          if (rendition) {\n            rendition.display(target);\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"flow\": {\n          var direction = decoded.args.length && decoded.args[0];\n          axis = direction === \"paginated\" ? \"horizontal\" : \"vertical\";\n\n          if (rendition) {\n            rendition.flow(direction);\n          } else {\n            q.push(message);\n          }\n\n          break;\n        }\n        case \"setLocations\": {\n          var locations = decoded.args[0];\n          if (book) {\n            book.locations.load(locations);\n          } else {\n            q.push(message);\n          }\n\n          if (rendition) {\n            rendition.reportLocation();\n          }\n          break;\n        }\n        case \"reportLocation\": {\n          if (rendition) {\n            rendition.reportLocation();\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"minSpreadWidth\": {\n          minSpreadWidth = decoded.args;\n          break;\n        }\n        case \"mark\": {\n          if (rendition) {\n            rendition.annotations.mark.apply(\n              rendition.annotations,\n              decoded.args\n            );\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"underline\": {\n          if (rendition) {\n            rendition.annotations.underline.apply(\n              rendition.annotations,\n              decoded.args\n            );\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"highlight\": {\n          if (rendition) {\n            rendition.annotations.highlight.apply(\n              rendition.annotations,\n              decoded.args\n            );\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"removeAnnotation\": {\n          if (rendition) {\n            rendition.annotations.remove.apply(\n              rendition.annotations,\n              decoded.args\n            );\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"themes\": {\n          var themes = decoded.args[0];\n          if (rendition) {\n            rendition.themes.register(themes);\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"theme\": {\n          var theme = decoded.args[0];\n          if (rendition) {\n            rendition.themes.select(theme);\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"fontSize\": {\n          var fontSize = decoded.args[0];\n          if (rendition) {\n            rendition.themes.fontSize(fontSize);\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n        case \"font\": {\n          var font = decoded.args[0];\n          if (rendition) {\n            rendition.themes.font(font);\n          } else {\n            q.push(message);\n          }\n          break;\n        }\n      }\n    }\n\n    function openEpub(url, options) {\n      var settings = Object.assign(\n        {\n          manager: \"continuous\",\n          overflow: \"visible\"\n        },\n        options\n      );\n\n      window.book = book = ePub(url);\n\n      window.rendition = rendition = book.renderTo(document.body, settings);\n\n      rendition.hooks.content.register(\n        function(contents, rendition) {\n          var doc = contents.document;\n          var startPosition = { x: -1, y: -1 };\n          var currentPosition = { x: -1, y: -1 };\n          var isLongPress = false;\n          var longPressTimer;\n          var touchduration = 300;\n          var $body = doc.getElementsByTagName(\"body\")[0];\n\n          function touchStartHandler(e) {\n            var f, target;\n            startPosition.x = e.targetTouches[0].pageX;\n            startPosition.y = e.targetTouches[0].pageY;\n            currentPosition.x = e.targetTouches[0].pageX;\n            currentPosition.y = e.targetTouches[0].pageY;\n            isLongPress = false;\n\n            for (var i = 0; i < e.targetTouches.length; i++) {\n              f = e.changedTouches[i].force;\n              if (f >= 0.8 && !preventTap) {\n                target = e.changedTouches[i].target;\n\n                if (target.getAttribute(\"ref\") === \"epubjs-mk\") {\n                  return;\n                }\n\n                clearTimeout(longPressTimer);\n\n                cfi = contents.cfiFromNode(target).toString();\n\n                sendMessage({\n                  method: \"longpress\",\n                  position: currentPosition,\n                  cfi: cfi\n                });\n                isLongPress = false;\n                preventTap = true;\n              }\n            }\n\n            longPressTimer = setTimeout(function() {\n              target = e.targetTouches[0].target;\n\n              if (target.getAttribute(\"ref\") === \"epubjs-mk\") {\n                return;\n              }\n\n              cfi = contents.cfiFromNode(target).toString();\n\n              sendMessage({\n                method: \"longpress\",\n                position: currentPosition,\n                cfi: cfi\n              });\n              preventTap = true;\n            }, touchduration);\n          }\n\n          function touchMoveHandler(e) {\n            currentPosition.x = e.targetTouches[0].pageX;\n            currentPosition.y = e.targetTouches[0].pageY;\n            clearTimeout(longPressTimer);\n          }\n\n          function touchEndHandler(e) {\n            var cfi;\n            clearTimeout(longPressTimer);\n\n            if (preventTap) {\n              preventTap = false;\n              return;\n            }\n\n            if (\n              Math.abs(startPosition.x - currentPosition.x) < 2 &&\n              Math.abs(startPosition.y - currentPosition.y) < 2\n            ) {\n              var target = e.changedTouches[0].target;\n\n              if (target.getAttribute(\"ref\") === \"epubjs-mk\") {\n                return;\n              }\n\n              cfi = contents.cfiFromNode(target).toString();\n\n              if (isLongPress) {\n                sendMessage({\n                  method: \"longpress\",\n                  position: currentPosition,\n                  cfi: cfi\n                });\n                isLongPress = false;\n              } else {\n                setTimeout(function() {\n                  if (preventTap) {\n                    preventTap = false;\n                    isLongPress = false;\n                    return;\n                  }\n                  sendMessage({\n                    method: \"press\",\n                    position: currentPosition,\n                    cfi: cfi\n                  });\n                }, 10);\n              }\n            }\n          }\n\n          function touchForceHandler(e) {\n            var f = e.changedTouches[0].force;\n            if (f >= 0.8 && !preventTap) {\n              var target = e.changedTouches[0].target;\n\n              if (target.getAttribute(\"ref\") === \"epubjs-mk\") {\n                return;\n              }\n\n              clearTimeout(longPressTimer);\n\n              cfi = contents.cfiFromNode(target).toString();\n\n              sendMessage({\n                method: \"longpress\",\n                position: currentPosition,\n                cfi: cfi\n              });\n              isLongPress = false;\n              preventTap = true;\n            }\n          }\n\n          if (!isWebkit) {\n\n            var prevX;\n            var flick = 0;\n            var pan = false;\n\n            doc.addEventListener(\n              \"touchmove\",\n              function(e) {\n                var screenX = e.touches[0].screenX;\n                var delta = prevX - screenX;\n\n                touchMoveHandler(e);\n\n                if (axis !== \"horizontal\") {\n                  return;\n                }\n\n                if (Math.abs(delta) > 0.5) {\n                  pan = true;\n                }\n\n                if (delta > 20) {\n                  flick = 1;\n                }\n\n                if (delta < -20) {\n                  flick = -1;\n                }\n\n                if (!animating) {\n                  if (delta) {\n                    window.scrollBy(delta, 0);\n                  }\n                }\n\n                prevX = screenX;\n\n                e.preventDefault();\n              },\n              { capture: true, passive: false }\n            );\n\n            doc.addEventListener(\n              \"touchstart\",\n              function(e) {\n                touchStartHandler(e);\n\n                if (axis !== \"horizontal\") {\n                  return;\n                }\n\n                resizeCanceler = false;\n\n                e.stopPropagation();\n              },\n              { capture: true, passive: false }\n            );\n\n            doc.addEventListener(\n              \"touchend\",\n              function(e) {\n                touchEndHandler(e);\n\n                if (axis !== \"horizontal\") {\n                  return;\n                }\n\n                if (!animating) {\n                  if (flick === 1) {\n                    snap(last_known_scroll_position + snapWidth + 10);\n                  } else if (flick === -1) {\n                    snap(last_known_scroll_position - snapWidth + 10);\n                  } else if (pan) {\n                    snap(last_known_scroll_position);\n                  }\n                }\n\n                prevX = undefined;\n                flick = 0;\n                pan = false;\n                // e.preventDefault();\n              },\n              { capture: true, passive: false }\n            );\n          } else {\n            doc.addEventListener(\"touchstart\", touchStartHandler, false);\n\n            doc.addEventListener(\"touchmove\", touchMoveHandler, false);\n\n            doc.addEventListener(\"touchend\", touchEndHandler, false);\n\n            doc.addEventListener(\"touchforcechange\", touchForceHandler, false);\n          }\n        }.bind(this)\n      );\n\n      rendition.on(\"relocated\", function(location) {\n        if (lastRenditionEvent === 'resized') {\n          sendMessage({ method: 'relocatedAfterResize', location: location});\n          lastRenditionEvent = \"relocatedAfterResize\";\n          return;\n        }\n\n        if (lastRenditionEvent === 'relocatedAfterResize') {\n          lastRenditionEvent = '';\n          sendMessage({ method: 'relocatedAfterResizeFinished' });          \n          return;\n        }\n\n        sendMessage({ method: \"relocated\", location: location });\n        lastRenditionEvent = \"relocated\";\n      });\n\n      rendition.on(\"selected\", function(cfiRange) {\n        lastRenditionEvent = \"selected\";\n        preventTap = true;\n        sendMessage({ method: \"selected\", cfiRange: cfiRange });\n      });\n\n      rendition.on(\"markClicked\", function(cfiRange, data) {\n        lastRenditionEvent = \"markClicked\";\n        sendMessage({ method: \"markClicked\", cfiRange: cfiRange, data: data });\n      });\n\n      rendition.on(\"rendered\", function(section) {\n        sendMessage({ method: \"rendered\", sectionIndex: section.index });\n      });\n\n      rendition.on(\"added\", function(section) {\n        lastRenditionEvent = \"added\";\n        sendMessage({ method: \"added\", sectionIndex: section.index });\n      });\n\n      rendition.on(\"removed\", function(section) {\n        lastRenditionEvent = \"removed\";\n        sendMessage({ method: \"removed\", sectionIndex: section.index });\n      });\n\n      rendition.on(\"resized\", function(size) {\n        lastRenditionEvent = \"resized\";\n        sendMessage({ method: \"resized\", size: size });\n      });\n\n      // replay messages\n      rendition.started.then(function() {\n        let msg;\n        for (var i = 0; i < q.length; i++) {\n          msg = q.shift();\n          handleMessage(msg);\n        }\n      });\n\n      book.ready.then(function() {\n        _isReady = true;\n\n        sendMessage({ method: \"ready\" });\n      });\n\n      window.addEventListener(\"unload\", function() {\n        book && book.destroy();\n      });\n    }\n\n    window.addEventListener(\"message\", onMessage);\n    // React native uses document for postMessages\n    document.addEventListener(\"message\", onMessage);\n\n    sendMessage({ method: \"loaded\", value: true });\n\n    // Snap scrolling\n    if (!isWebkit) {\n      window.addEventListener(\"scroll\", function(e) {\n        last_known_scroll_position = window.scrollX;\n      });\n\n      window.addEventListener(\"resize\", function(e) {\n        resizeCanceler = true;\n        snapWidth = window.innerWidth;\n        animating = false;\n      });\n    }\n\n    function snap(scroll_pos) {\n      var snapTo = Math.round(scroll_pos / snapWidth) * snapWidth;\n      if (scroll_pos % snapWidth > 0) {\n        scrollToX(snapTo, 25000);\n      }\n    }\n\n    function scrollToX(scrollTargetX, speed, easing) {\n      var scrollX = window.scrollX,\n        scrollTargetX = scrollTargetX || 0,\n        speed = speed || 2000,\n        easing = easing || \"easeOutSine\",\n        currentTime = 0;\n\n      animating = true;\n\n      // min time .1, max time .8 seconds\n      var time = Math.max(\n        0.1,\n        Math.min(Math.abs(scrollX - scrollTargetX) / speed, 0.8)\n      );\n\n      // easing equations from https://github.com/danro/easing-js/blob/master/easing.js\n      var PI_D2 = Math.PI / 2,\n        easingEquations = {\n          easeOutSine: function(pos) {\n            return Math.sin(pos * (Math.PI / 2));\n          },\n          easeInOutSine: function(pos) {\n            return -0.5 * (Math.cos(Math.PI * pos) - 1);\n          },\n          easeInOutQuint: function(pos) {\n            if ((pos /= 0.5) < 1) {\n              return 0.5 * Math.pow(pos, 5);\n            }\n            return 0.5 * (Math.pow(pos - 2, 5) + 2);\n          }\n        };\n\n      // add animation loop\n      function tick() {\n        currentTime += 1 / 60;\n\n        var p = currentTime / time;\n        var t = easingEquations[easing](p);\n\n        if (touchCanceler) {\n          return;\n        }\n\n        if (resizeCanceler) {\n          resizeCanceler = false;\n          return;\n        }\n\n        if (p < 1) {\n          window.requestAnimationFrame(tick);\n\n          window.scrollTo(scrollX + (scrollTargetX - scrollX) * t, 0);\n        } else {\n          window.scrollTo(scrollTargetX, 0);\n          animating = false;\n        }\n      }\n\n      tick();\n    }\n  }\n\n  if (document.readyState === \"complete\") {\n    _ready();\n  } else {\n    window.addEventListener(\"load\", _ready, false);\n  }\n})();\n";


var EMBEDDED_HTML="\n<!DOCTYPE html>\n<html><head>\n  <meta charset=\"utf-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no\">\n  <title></title>\n  <script>"+





EPUBJS+"</script>\n  <script>"+
BRIDGE+"</script>\n  <style>\n    body {\n      margin: 0;\n      -webkit-tap-highlight-color: rgba(0,0,0,0);\n      -webkit-tap-highlight-color: transparent; /* For some Androids */\n    }\n  </style>\n</head><body></body></html>\n";var










Rendition=function(_Component){_inherits(Rendition,_Component);

function Rendition(props){_classCallCheck(this,Rendition);var _this=_possibleConstructorReturn(this,(Rendition.__proto__||Object.getPrototypeOf(Rendition)).call(this,
props));

_this.state={
loaded:false,
relocateAfterResizeLoading:false};


_this.nextPage=_this.nextPage.bind(_this);
_this.prevPage=_this.prevPage.bind(_this);return _this;
}_createClass(Rendition,[{key:"componentDidMount",value:function componentDidMount()

{
this._isMounted=true;

if(this.props.url){
this.load(this.props.url);
}
}},{key:"componentWillUnmount",value:function componentWillUnmount()

{
this._isMounted=false;
this.destroy();
}},{key:"componentDidUpdate",value:function componentDidUpdate(

prevProps){
if(prevProps.url!==this.props.url){
this.load(this.props.url);
}

if(prevProps.display!==this.props.display){

this.display(this.props.display);
}

if(prevProps.orientation!==this.props.orientation){

}

if(prevProps.flow!==this.props.flow){
this.flow(this.props.flow||"paginated");
}

if(prevProps.themes!==this.props.themes){
this.themes(this.props.themes);
}

if(prevProps.themes!==this.props.theme){
this.theme(this.props.theme);
}

if(prevProps.fontSize!==this.props.fontSize){
this.fontSize(this.props.fontSize);
}

if(prevProps.font!==this.props.font){
this.font(this.props.font);
}
}},{key:"load",value:function load(

bookUrl){
if(!this._webviewLoaded)return;

__DEV__&&console.log("loading book: ",bookUrl);

var config={
"minSpreadWidth":this.props.minSpreadWidth||800,
"flow":this.props.flow||"paginated"};


if(this.props.stylesheet){
config.stylesheet=this.props.stylesheet;
}

if(this.props.script){
config.script=this.props.script;
}

this.sendToBridge("open",[bookUrl,config]);

this.display(this.props.display);

if(this.props.themes){
this.themes(this.props.themes);
}

if(this.props.theme){
this.theme(this.props.theme);
}

if(this.props.fontSize){
this.fontSize(this.props.fontSize);
}

if(this.props.font){
this.font(this.props.font);
}
}},{key:"display",value:function display(

target){
var spine=Number.isInteger(target)&&target;
var percentage=!spine&&typeof target==='number'&&target;

if(!this._webviewLoaded)return;

if(spine){
this.sendToBridge("display",[{"spine":spine}]);
}else if(percentage){
this.sendToBridge("display",[{"percentage":target}]);
}else if(target){
this.sendToBridge("display",[{"target":target}]);
}else{
this.sendToBridge("display");
}
}},{key:"flow",value:function flow(

f){
this.sendToBridge("flow",[f]);
}},{key:"themes",value:function themes(

t){
this.sendToBridge("themes",[t]);
}},{key:"theme",value:function theme(

t){
this.sendToBridge("theme",[t]);
}},{key:"font",value:function font(

f){
this.sendToBridge("font",[f]);
}},{key:"fontSize",value:function fontSize(

f){
this.sendToBridge("fontSize",[f]);
}},{key:"setLocations",value:function setLocations(

locations){
this.locations=locations;
if(this._ready){
this.sendToBridge("setLocations",[this.locations]);
}
}},{key:"reportLocation",value:function reportLocation()

{
if(this._ready){
this.sendToBridge("reportLocation");
}
}},{key:"highlight",value:function highlight(

cfiRange,data){
this.sendToBridge("highlight",[cfiRange,data]);
}},{key:"underline",value:function underline(

cfiRange,data){
this.sendToBridge("underline",[cfiRange,data]);
}},{key:"mark",value:function mark(

cfiRange,data){
this.sendToBridge("mark",[cfiRange,data]);
}},{key:"unhighlight",value:function unhighlight(

cfiRange,data){
this.sendToBridge("removeAnnotation",[cfiRange,data]);
}},{key:"ununderline",value:function ununderline(

cfiRange,data){
this.sendToBridge("removeAnnotation",[cfiRange,data]);
}},{key:"unmark",value:function unmark(

cfiRange,data){
this.sendToBridge("removeAnnotation",[cfiRange,data]);
}},{key:"nextPage",value:function nextPage()

{
this.sendToBridge("nextPage");
}},{key:"prevPage",value:function prevPage()

{
this.sendToBridge("prevPage");
}},{key:"destroy",value:function destroy()

{

}},{key:"postMessage",value:function postMessage(

str){
if(this.refs.webviewbridge){
return this.refs.webviewbridge.postMessage(str);
}
}},{key:"sendToBridge",value:function sendToBridge(

method,args,promiseId){
var str=JSON.stringify({
method:method,
args:args,
promise:promiseId});


if(!this.refs.webviewbridge){
return;
}

this.refs.webviewbridge.postMessage(str);
}},{key:"_onWebViewLoaded",value:function _onWebViewLoaded()

{
this._webviewLoaded=true;
if(this.props.url){
this.load(this.props.url);
}
}},{key:"_onBridgeMessage",value:function _onBridgeMessage(

e){
var msg=e.nativeEvent.data;
var decoded;
if(typeof msg==="string"){
decoded=JSON.parse(msg);
}else{
decoded=msg;
}
var p;

switch(decoded.method){
case"log":{
console.log.apply(console.log,decoded.value);
break;
}
case"error":{
console.error.apply(console.error,decoded.value);
break;
}
case"loaded":{
this._onWebViewLoaded();
break;
}
case"rendered":{
this.setState({loaded:true});
break;
}
case"relocated":{var _decoded=
decoded,location=_decoded.location;
this._relocated(location);
break;
}
case"press":{
this.props.onPress&&this.props.onPress(decoded.cfi,decoded.position,this);
break;
}
case"longpress":{
this.props.onLongPress&&this.props.onLongPress(decoded.cfi,decoded.position,this);
break;
}
case"selected":{var _decoded2=
decoded,cfiRange=_decoded2.cfiRange;
this._selected(cfiRange);
break;
}
case"markClicked":{var _decoded3=
decoded,_cfiRange=_decoded3.cfiRange,data=_decoded3.data;
this._markClicked(_cfiRange,data);
break;
}
case"added":{var _decoded4=
decoded,sectionIndex=_decoded4.sectionIndex;
this.props.onViewAdded&&this.props.onViewAdded(sectionIndex);
break;
}
case"removed":{var _decoded5=
decoded,_sectionIndex=_decoded5.sectionIndex;
this.props.beforeViewRemoved&&this.props.beforeViewRemoved(_sectionIndex);
break;
}
case"ready":{
this._ready();
break;
}
case'relocatedAfterResize':{var _decoded6=
decoded,_location=_decoded6.location;
this._relocatedAfterResize(_location);
break;
}
case'relocatedAfterResizeFinished':{
this.setState({relocateAfterResizeLoading:false});
break;
}
case'resized':{
this.setState({relocateAfterResizeLoading:true});
break;
}
default:{
console.log("msg",decoded);
}}

}},{key:"_relocated",value:function _relocated(

visibleLocation){
this._visibleLocation=visibleLocation;

if(this.props.onRelocated){
this.props.onRelocated(visibleLocation,this);
}
}},{key:"_selected",value:function _selected(

cfiRange){
if(this.props.onSelected){
this.props.onSelected(cfiRange,this);
}
}},{key:"_markClicked",value:function _markClicked(

cfiRange,data){
if(this.props.onMarkClicked){
this.props.onMarkClicked(cfiRange,data,this);
}
}},{key:"_ready",value:function _ready()

{
if(this.locations){
this.sendToBridge("setLocations",[this.locations]);
}
}},{key:"_relocatedAfterResize",value:function _relocatedAfterResize(

location){
this.display(this._visibleLocation.start.percentage);

if(this.props.onRelocated){
this.props.onRelocated(this._visibleLocation);
}
}},{key:"render",value:function render()

{var _this2=this;
var WebViewer=_reactNative.Platform.OS==='ios'?_reactNativeWkwebviewRebornFchasen2.default:_reactNative.WebView;

var loader=
_react2.default.createElement(_reactNative.View,{style:[styles.loadScreen,{
backgroundColor:this.props.backgroundColor||"#FFFFFF"}],__source:{fileName:_jsxFileName,lineNumber:380}},

_react2.default.createElement(_reactNative.TouchableOpacity,{onPress:function onPress(){return _this2.props.onPress('');},style:styles.manager,__source:{fileName:_jsxFileName,lineNumber:383}},
_react2.default.createElement(_reactNative.ActivityIndicator,{
color:this.props.color||"black",
size:this.props.size||"large",
style:{flex:1},__source:{fileName:_jsxFileName,lineNumber:384}})));





if(!this.props.url||this.props.isLoading){
return loader;
}

return(
_react2.default.createElement(_reactNative.View,{ref:"framer",style:styles.container,__source:{fileName:_jsxFileName,lineNumber:398}},
_react2.default.createElement(WebViewer,{
ref:"webviewbridge",
source:{html:EMBEDDED_HTML,baseUrl:this.props.url},
style:[styles.manager,{
backgroundColor:this.props.backgroundColor||"#FFFFFF"}],

scalesPageToFit:false,
bounces:false,
javaScriptEnabled:true,
scrollEnabled:true,
javaScriptEnabled:true,
pagingEnabled:this.props.flow==="paginated",

onMessage:this._onBridgeMessage.bind(this),__source:{fileName:_jsxFileName,lineNumber:399}}),

!this.state.loaded||this.state.relocateAfterResizeLoading?loader:null));


}}]);return Rendition;}(_react.Component);


var styles=_reactNative.StyleSheet.create({
container:{
flex:1,
flexDirection:"column"},

manager:{
flex:1},

scrollContainer:{
flex:1,
marginTop:0,
flexDirection:"row",
flexWrap:"nowrap",
backgroundColor:"#F8F8F8"},

rowContainer:{
flex:1},

loadScreen:{
position:"absolute",
top:0,
bottom:0,
left:0,
right:0,
backgroundColor:"#fff",
justifyContent:"center",
alignItems:"center"}});



(0,_eventEmitter2.default)(Rendition.prototype);

module.exports=Rendition;